# üß∞ Microsoft Entra ID Custom Role ‚Äì JSON Anatomy

> Entra ID custom roles are used to **control access to Entra ID directory features** like users, groups, devices, apps, etc., **not Azure resources like VMs or Storage** (that‚Äôs Azure RBAC).

---

<div align="center">
  <img src="images/entra-custom-role.png" alt="Entra ID Custom Role" style="width: 80%; border-radius: 10px;">
</div>

---

> üìí Note: Entra ID Custom Roles require Entra ID P1 licensing at least.  
> üí° Note: Using Powershell or MS Graph API provides more control over the role definition.

---

## üß¨ Full JSON Skeleton

```json
{
  "description": "Manage only security groups and read user info",
  "displayName": "Group Manager (Custom)",
  "isEnabled": true,
  "rolePermissions": [
    {
      "allowedResourceActions": ["microsoft.directory/groups.readWrite.all", "microsoft.directory/users.read.all"],
      "condition": null,
      "excludedResourceActions": []
    }
  ],
  "scope": "/"
}
```

---

## üß± JSON Components Explained

| Property                    | Type      | Description                                                                |
| --------------------------- | --------- | -------------------------------------------------------------------------- |
| `displayName`               | `string`  | The human-readable name of your role                                       |
| `description`               | `string`  | A summary of what this role allows                                         |
| `isEnabled`                 | `boolean` | Whether the role is enabled (true/false)                                   |
| `scope`                     | `string`  | Scope where the role applies ‚Äî `/` = full tenant, or a specific Admin Unit |
| `rolePermissions`           | `array`   | List of permission sets (like AWS policy statements)                       |
| ‚îó `allowedResourceActions`  | `array`   | Graph API permissions you want to allow (required)                         |
| ‚îó `excludedResourceActions` | `array`   | Optional ‚Äî Graph permissions to explicitly **deny**                        |
| ‚îó `condition`               | `object`  | Reserved for future ‚Äî leave null                                           |

---

## üß™ Example 1: User Viewer Role (Read-only Access to Users)

```json
{
  "displayName": "User Viewer",
  "description": "Can view all user profiles",
  "isEnabled": true,
  "scope": "/",
  "rolePermissions": [
    {
      "allowedResourceActions": ["microsoft.directory/users.read.all"],
      "excludedResourceActions": [],
      "condition": null
    }
  ]
}
```

üëÄ **Use Case:** Assign this to HR or auditors who need to **view user data**, but not modify it.

---

## üß™ Example 2: Password Reset Operator

```json
{
  "displayName": "Password Reset Operator",
  "description": "Can reset passwords for non-admin users",
  "isEnabled": true,
  "scope": "/",
  "rolePermissions": [
    {
      "allowedResourceActions": ["microsoft.directory/users/authenticationMethods/update"],
      "excludedResourceActions": [],
      "condition": null
    }
  ]
}
```

üîë **Use Case:** Helpdesk team with ability to reset passwords but **not full user edit rights**.

---

## üß™ Example 3: Group Admin + App Reader Combo Role

```json
{
  "displayName": "Group Manager with App Read Access",
  "description": "Can manage groups and view application details",
  "isEnabled": true,
  "scope": "/",
  "rolePermissions": [
    {
      "allowedResourceActions": ["microsoft.directory/groups/*", "microsoft.directory/applications/basic/read"],
      "excludedResourceActions": [],
      "condition": null
    }
  ]
}
```

üë• **Use Case:** Assign to someone managing Microsoft 365 or Entra security groups and needs to **view app registrations**.

---

## ‚ö†Ô∏è Important: Scope = `/` vs Admin Unit

| Scope Value                 | Meaning                            |
| --------------------------- | ---------------------------------- |
| `/`                         | Applies to **entire Entra tenant** |
| `/administrativeUnits/{id}` | Applies only to that specific unit |

üîê Administrative Units are like **Active Directory OUs** ‚Äî you can limit visibility of a custom role to a single department like `Sales` or `Engineering`.

---

## üö´ What You _Can't_ Do (Differences from Azure RBAC)

| Feature                   | Azure RBAC (Yes) | Entra ID Custom Role (No)           |
| ------------------------- | ---------------- | ----------------------------------- |
| Use wildcards like `*`    | ‚úÖ Yes           | ‚ùå No (must list each permission)   |
| Target resource groups    | ‚úÖ Yes           | ‚ùå No (Entra doesn‚Äôt use RGs)       |
| Allow/deny network access | ‚úÖ Yes           | ‚ùå Not applicable                   |
| Define complex conditions | ‚úÖ (in preview)  | ‚ùå Only `condition: null` supported |
| Custom DataActions        | ‚úÖ Yes           | ‚ùå No DataActions in Entra          |

---

## üß† Where to Find All Permissions?

You can use:

- [Microsoft Graph Permission Reference](https://learn.microsoft.com/en-us/graph/permissions-reference)
- Search for: `Directory.Read.All`, `Group.ReadWrite.All`, `Application.Read.All`, etc.

These Graph permissions are what you'll use in `allowedResourceActions`.

---

## üß™ Bonus Example 4: Audit Role (Read Logs + View Users)

```json
{
  "displayName": "Audit Inspector",
  "description": "View sign-ins, logs, and users",
  "isEnabled": true,
  "scope": "/",
  "rolePermissions": [
    {
      "allowedResourceActions": [
        "microsoft.directory/signIns.read.all",
        "microsoft.directory/auditLogs.read.all",
        "microsoft.directory/users.read.all"
      ],
      "excludedResourceActions": [],
      "condition": null
    }
  ]
}
```

üßæ Useful for compliance or security audit teams needing **read-only** visibility into logs and users.

---

## üì¶ Wrap-Up Summary

| Component                 | Description                                           |
| ------------------------- | ----------------------------------------------------- |
| `allowedResourceActions`  | List of Graph API permissions (must be exact)         |
| `excludedResourceActions` | Optional deny list (very rare in practice)            |
| `scope`                   | Entire tenant `/` or limited via Administrative Units |
| `displayName`             | Friendly name shown in the portal                     |
| `condition`               | Reserved (always set to null)                         |
