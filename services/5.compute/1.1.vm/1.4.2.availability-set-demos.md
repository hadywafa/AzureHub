# ğŸ¥‘ **Availability Set (AS)**

**Definition (Microsoft official):**
An _Availability Set_ is a logical grouping of VMs that ensures your application remains available during planned and unplanned maintenance events.

ğŸ‘‰ Think of it like a **chessboard grid**:

- **Rows = Update Domains (UDs)** â†’ protect against **planned updates**.
- **Columns = Fault Domains (FDs)** â†’ protect against **unplanned hardware failures**.

Azure automatically spreads your VMs across this grid when you place them inside an availability set.

---

## âš¡ **Fault Domains (FDs)**

- **What it is:** A **rack of servers** with independent **power + network switch**.
- **Unplanned protection:** If a rack loses power or network â†’ all VMs in that rack (FD) go down.
- Azure ensures your VMs are split across **2 or 3 FDs** (depends on region).

### Example â€“ 2 Fault Domains, 4 VMs

```ini
FD1 (Rack1): VM1, VM3
FD2 (Rack2): VM2, VM4
```

If FD1 rack dies â†’ only VM1 & VM3 go offline. VM2 & VM4 are still alive.

---

## ğŸ”„ **Update Domains (UDs)**

- **What it is:** A group of VMs that Azure can reboot at the same time during **planned maintenance**.
- **Planned protection:** Azure updates one UD at a time.
- By default, **5 UDs**, configurable up to **20**.

### Example â€“ 5 Update Domains, 10 VMs

```ini
UD1: VM1, VM6
UD2: VM2, VM7
UD3: VM3, VM8
UD4: VM4, VM9
UD5: VM5, VM10
```

If Azure patches UD3 â†’ only VM3 and VM8 reboot. Others remain online.

---

## ğŸ§© **How FD + UD Work Together**

â‰ï¸ Questions:

You have an Azure Subscription and an availability set Prod-AS-01 that has 5 update domain. You deploy 27 virtual machines to Prod-AS-01.
After a planned update, what is the minimum number of virtual machines that are available?

âœ… Answer:

### **ğŸ“Œ If FD = 3**

| UD â†“ / FD â†’  | **FD1**   | **FD2**   | **FD3**   | UD Total |
| ------------ | --------- | --------- | --------- | -------- |
| **UD1**      | VM1,VM2   | VM3,VM4   | VM5,VM6   | 6        |
| **UD2**      | VM7,VM8   | VM9,VM10  | VM11,VM12 | 6        |
| **UD3**      | VM13,VM14 | VM15,VM16 | VM17      | 5        |
| **UD4**      | VM18,VM19 | VM20      | VM21,VM22 | 5        |
| **UD5**      | VM23      | VM24,VM25 | VM26,VM27 | 5        |
| **FD Total** | 9         | 9         | 9         | 27       |

#### ğŸŸ¢ Case 1: Planned Maintenance (Update Domains)

- Azure updates **one UD at a time**.
- Worst case = a UD with **6 VMs** goes offline.

ğŸ‘‰ **Available VMs = 27 â€“ 6 = 21**

#### ğŸ”´ Case 2: Unplanned Failure (Fault Domains)

- If FD2 rack loses power/network:

  - All **9 VMs in FD2** are down.
  - Remaining = **18 VMs still available**.

ğŸ‘‰ **Available VMs = 27 â€“ 9 = 18**

### **ğŸ“Œ If FD = 1**

| UD â†“ / FD â†’  | **FD1**                    | UD Total |
| ------------ | -------------------------- | -------- |
| **UD1**      | VM1,VM2,VM3,VM4,VM5,VM6    | 6        |
| **UD2**      | VM7,VM8,VM9,VM10,VM11,VM12 | 6        |
| **UD3**      | VM13,VM14,VM15,VM16,VM17   | 5        |
| **UD4**      | VM18,VM19,VM20,VM21,VM22   | 5        |
| **UD5**      | VM23,VM24,VM25,VM26,VM27   | 5        |
| **FD Total** | 27                         | 27       |

#### ğŸŸ¢ Case 1: Planned Maintenance (Update Domains)

- Azure updates **one UD at a time**.
- Worst case = a UD with **6 VMs** goes offline.

ğŸ‘‰ **Available VMs = 27 â€“ 6 = 21**

#### ğŸ”´ Case 2: Unplanned Failure (Fault Domains)

- If FD1 rack loses power/network:

  - All **27 VMs in FD2** are down.

ğŸ‘‰ **Available VMs = 27 â€“ 27 = 0**

---

## ğŸ” **Exam Case Examples**

### Case 1 â€“ Planned Maintenance (UDs matter)

- Only **1 UD reboots at a time**.
- Largest UD has 6 VMs.
- Out of 27 â†’ 6 offline â†’ **21 available** âœ…

### Case 2 â€“ Unplanned Rack Failure (FDs matter)

- If FD2 rack dies, all 9 VMs in FD2 are offline.
- Out of 27 â†’ 9 offline â†’ **18 available** âœ…

---

## ğŸ§  **Analogies to Remember**

- **Fault Domain (FD) = Different Rooms**  
  Each room has separate power/network. If one roomâ€™s power trips â†’ only those servers die.

- **Update Domain (UD) = Maintenance Shifts**  
  IT says: â€œIâ€™ll patch/reboot one shift (UD) at a time.â€

- **Availability Set = Chessboard Grid**  
  Azure places your VMs across rows (UDs) and columns (FDs) so not all your eggs are in one basket.

---

## ğŸ“ **Key Notes to Memorize**

- **FD = Unplanned protection** (rack/power/network).
- **UD = Planned protection** (maintenance/patching).
- **Availability Set** = group VMs â†’ Azure auto-spreads them across FDs + UDs.
- Default = **2â€“3 FDs, 5 UDs**.
- Planned update â†’ only 1 UD offline â†’ worst-case = largest UD size.
- Unplanned failure â†’ 1 FD offline â†’ worst-case = total VMs in that FD.
- For **99.95% SLA** you need **2+ VMs in an availability set**.
