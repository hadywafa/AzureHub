# ğŸš€ **Azure Virtual Machine Lifecycle â€“ Visual, Simple, and Complete**

> _Mastering the Azure VM lifecycle helps you avoid surprises with billing, state transitions, and resource behavior like resizing, shutdown, or deallocation._

---

<div align="center">
  <img src="images/azure-vm-lifecycle.png" alt="Azure VM Lifecycle" style="border-radius: 10px; width: 85%;">
</div>

---

## ğŸ”„ **1. Starting (Provisioning)**

ğŸŸ¡ **State**: `Creating` / `Starting`
Azure is provisioning the VM resources â€” disks, NICs, storage, networking, metadata.

- â³ VM is being initialized
- ğŸ’¸ **Billing**: _Not charged during this stage_

---

## ğŸŸ¢ **2. Running (Allocated)**

ğŸŸ¢ **State**: `Running` (a.k.a. "allocated")
Your VM is now active, and you're charged for compute. You can SSH (Linux) or RDP (Windows) into it.

- âœ… Ready to accept workloads
- ğŸ’¸ **Billing**:

  - âœ… **Compute charges** (based on VM size/hour)
  - âœ… **Disk/network charges**

---

## ğŸ” **3. Restarting (Reboot)**

ğŸ” **State**: `Running`
This is a **soft reboot** (either from OS or portal/CLI). It **does not deallocate the VM**.

- ğŸ”§ OS reboot, patch install, config update
- ğŸ’¸ **Billing continues**, same as running

---

## ğŸ›‘ **4. Stopped vs Stopped (Deallocated)**

| **State**                  | âš ï¸ Behavior                                            | ğŸ’¸ **Billing**                           |
| -------------------------- | ------------------------------------------------------ | ---------------------------------------- |
| ğŸŸ¥ `Stopped`               | OS shutdown (via OS poweroff), **but still allocated** | âœ… Billed for compute                    |
| ğŸŸ¡ `Stopped (Deallocated)` | VM is **fully deallocated**, compute resources freed   | âŒ No compute charge <br> âœ… Disk charge |

---

### ğŸ“Œ **Deallocated = AWS Stopped**

> Azure charges **only for storage** when VMs are in **Stopped (Deallocated)** state.
> To stop billing, you must **explicitly deallocate** via portal or CLI.

---

## âŒ **5. Deleted (Terminated)**

âŒ **State**: `Deleted`
The VM and its attached resources (if not retained) are removed.

- ğŸª“ Compute and memory gone
- ğŸ§¹ Managed disks may **persist** (youâ€™re still billed)
- ğŸ’¸ **Billing**:

  - âŒ No VM compute charge
  - âš ï¸ **Disk/network charges may continue** if not cleaned up

---

## ğŸ§Š **6. Azure Hibernate (Preview)**

Azure now supports **VM Hibernate** (in preview for specific VM series).

- ğŸ§  Saves RAM content to OS disk (like AWS Hibernate)
- ğŸ’¾ Resume without full OS reboot
- ğŸ”’ **OS disk must be encrypted**
- ğŸ’¸ **Billing**:

  - âŒ No compute charge
  - âœ… Disk charge for memory snapshot

---

## âš¡ **7. Resizing Azure VM**

> Azure supports vertical scaling of VMs, but you must **deallocate** first (no live resize yet).

### ğŸ”„ Resize Flow:

1. ğŸŸ¡ **Deallocate the VM** (stopped, not just shut down)
2. ğŸ› ï¸ Choose a new size from the allowed SKUs
3. ğŸŸ¢ Start VM with new size

### ğŸ”¥ Resize Notes:

- Resize works only **within the same region**
- VM must be compatible with:

  - Current hardware cluster
  - Available quota

- Some SKUs may require a new placement on different hardware

---

## ğŸ§¯ **Shutdown Behavior in Azure**

### ğŸ“Š **Shutdown from inside OS**

When you run:

```bash
sudo shutdown now
```

Azure shuts down the OS, but **keeps the VM in `Stopped` (Allocated)\`** unless you check:

> ğŸ”˜ **"Deallocate this virtual machine when shutting down from inside"**

âœ… You can configure this from:

- Azure Portal â†’ VM â†’ Auto-shutdown
- Azure CLI:

  ```bash
  az vm deallocate --name MyVM --resource-group MyRG
  ```

---

## ğŸ” **Enable Delete Protection**

To avoid accidental deletion:

- Go to **VM â†’ Settings â†’ Configuration**
- Toggle **â€œEnable delete protectionâ€**
- Prevents deletion via CLI or Portal

---

## ğŸ” **VM Lifecycle Flow Summary**

| Stage                        | Description                                     | Billed for Compute? |
| ---------------------------- | ----------------------------------------------- | ------------------- |
| âœ… **Running**               | VM is active and ready                          | âœ… Yes              |
| ğŸ” **Restarting (Reboot)**   | OS reboot or restart VM                         | âœ… Yes              |
| ğŸŸ¥ **Stopped (Allocated)**   | OS-level shutdown, but still occupies resources | âœ… Yes              |
| ğŸŸ¡ **Stopped (Deallocated)** | VM is fully stopped and compute released        | âŒ No               |
| âŒ **Deleted**               | VM and config removed (unless disks retained)   | âŒ No               |

---

## ğŸ’¸ **Billing Cheat Sheet**

| **VM State**              | **Compute Charges** | **Storage Charges (Disk)** |
| ------------------------- | ------------------- | -------------------------- |
| **Running**               | âœ… Yes              | âœ… Yes                     |
| **Rebooting**             | âœ… Yes              | âœ… Yes                     |
| **Stopped (Allocated)**   | âœ… Yes              | âœ… Yes                     |
| **Stopped (Deallocated)** | âŒ No               | âœ… Yes                     |
| **Deleted**               | âŒ No               | âš ï¸ Only if disks retained  |

---

## ğŸ§  Summary â€“ Azure VM Lifecycle vs AWS EC2

| Concept                       | AWS EC2               | Azure VM                                 |
| ----------------------------- | --------------------- | ---------------------------------------- |
| **Stopped = Billed?**         | âŒ No (if EBS-backed) | âœ… Yes (unless deallocated)              |
| **Deallocate = Stop Billing** | No such concept       | âœ… Yes â€” stops compute billing           |
| **Hibernate**                 | Supported             | âœ… Supported (Preview)                   |
| **Resize**                    | Requires stop         | âœ… Requires deallocation                 |
| **Shutdown from OS**          | Can stop/terminate    | Stops, may still bill unless deallocated |
| **Termination Protection**    | âœ… Yes                | âœ… Delete protection                     |
