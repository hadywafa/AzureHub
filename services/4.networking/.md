# 🌐 Azure Virtual Network (VNet) – Explained for AWS Experts

<div align="center">
  <img src="images/az-vnet-before.png" alt="Azure VNet - Before Setup" style="width: 80%; border-radius: 10px;">
</div>

An **Azure Virtual Network (VNet)** is a **logically isolated** private network in Azure, comparable to **Amazon VPC**. It enables Azure resources—like VMs, containers, and services—to securely communicate with:

- 🧑‍🤝‍🧑 Each other (within the same network)
- 🌍 The internet (public access with controls)
- 🏢 Your on-premises network (via VPN or ExpressRoute)

This is your **networking foundation** in Azure—used for routing, DNS, traffic control, segmentation, and security.

---

# 🧱 Azure VNet vs AWS VPC – Concept Mapping

| 🔹 Purpose                     | 🟦 Azure Term                   | 🟨 AWS Term                     |
| ------------------------------ | ------------------------------- | ------------------------------- |
| Private cloud network boundary | Virtual Network (VNet)          | VPC                             |
| Subnet definition              | Subnet                          | Subnet                          |
| Instance network attachment    | NIC (Network Interface)         | ENI (Elastic Network Interface) |
| Traffic control rules          | NSG (Network Security Group)    | Security Group (SG)             |
| Custom traffic routes          | Route Table                     | Route Table                     |
| Cross-network connectivity     | VNet Peering                    | VPC Peering                     |
| Internet access                | Public IP / NAT Gateway         | Internet Gateway / NAT          |
| DNS resolution                 | Azure-provided DNS / Custom     | AmazonProvidedDNS / Route 53    |
| Private service access         | Private Link / Service Endpoint | Interface / Gateway Endpoints   |

---

# 🧭 Core Concepts of VNet

<div align="center">
  <img src="images/az-vnet-after.png" alt="Azure VNet - After Setup" style="width: 80%; border-radius: 10px;">
</div>

## 1️⃣ Virtual Network

A **VNet** is your private, isolated IP space in the cloud. You define:

- **Address space** (e.g., `10.0.0.0/16`)
- **Subnets**
- **Routing and security**
- **DNS behavior**
- **Connectivity to on-prem or other VNets**

Just like in AWS, VNets can span **multiple AZs**, but **subnets** are defined **once per VNet** and are **zone-agnostic** (Azure picks zone per VM, not per subnet).

---

## 2️⃣ Subnets

Subnets are used to **logically segment your VNet**.

- You define **subnet CIDR ranges** inside the VNet address space.
- Each subnet is used to isolate workloads or tiered applications.
- Resources (like VMs) are **deployed into subnets**, not directly into VNets.

🧠 **Subnets do not belong to a specific Availability Zone** in Azure. You specify the AZ **when deploying the VM**, not when defining the subnet.

---

## 3️⃣ Network Interfaces (NICs)

Every VM or compute resource is assigned at least one **NIC**:

- Contains the **private IP** address of the VM
- Can optionally have a **Public IP**
- Has **NSG** rules attached (if needed)
- Like **ENIs** in AWS

---

# 🔐 Network Security Groups (NSGs)

<div align="center">
  <img src="images/az-vnet-component.png" alt="Azure NSG and NIC Interaction" style="width: 80%; border-radius: 10px;">
</div>

An NSG is like an AWS **Security Group**:

| Feature            | Azure NSG                | AWS SG                    |
| ------------------ | ------------------------ | ------------------------- |
| Direction          | Inbound & Outbound rules | Same                      |
| Scope              | Subnet or NIC level      | Only ENI (instance level) |
| IP-based rules     | Yes                      | Yes                       |
| SG-to-SG reference | ❌ Not supported         | ✅ Yes                    |
| Default deny all?  | ✅ Yes                   | ✅ Yes                    |

🧠 You can attach **different NSGs** to different NICs **in the same subnet**, offering finer-grained control.

---

# 📡 Default VNet Connectivity

<div align="center">
  <img src="images/az-vnet-default-connectivity.png" alt="Azure VNet Connectivity Behavior" style="width: 80%; border-radius: 10px;">
</div>

| Connectivity Type           | Azure Behavior                                   |
| --------------------------- | ------------------------------------------------ |
| Subnet ↔ Subnet (Same VNet) | ✅ Allowed by default, no extra routing required |
| Subnet ↔ Internet           | ✅ Allowed with Public IP or NAT Gateway         |
| Subnet ↔ On-premises        | ❌ Requires VPN Gateway or ExpressRoute          |
| VNet ↔ Another VNet         | ❌ Requires VNet Peering                         |
| Azure Service (PaaS) Access | ✅ Via Service Endpoints or Private Link         |

---

# 🔄 Implementation Considerations

<div align="center">
  <img src="images/az-vnet-considrations.png" alt="Azure VNet Implementation Considerations" style="width: 80%; border-radius: 10px;">
</div>

### 1. 📦 Address Space

- Define using **CIDR** (e.g., `10.1.0.0/16`)
- Subnets must not overlap
- Maximum subnet mask:

  - IPv4: `/29`
  - IPv6: `/64` only

- **No automatic expansion** like AWS; plan upfront

---

### 2. 🌐 DNS Options

| Azure Option       | AWS Equivalent         | Purpose                                              |
| ------------------ | ---------------------- | ---------------------------------------------------- |
| Azure-provided DNS | AmazonProvidedDNS      | Internal resolution like `vm1.internal.cloudapp.net` |
| Custom DNS server  | Custom DHCP Option Set | On-premises DNS, AD integration                      |
| Private DNS Zones  | Route 53 Private Zones | DNS zones scoped to VNets                            |

---

### 3. 📥 Protocols and Ports

Define **protocol-level access** in NSGs:

- TCP/UDP/ICMP rules
- Custom ports
- Application-level control with **Azure Firewall** or **NVA**

---

# 🔀 Routing in VNet

- By default, Azure provides **System Routes** (like AWS default route table).
- For custom routing, create a **User-Defined Route (UDR)** and associate it with a subnet.
- Needed for:

  - Traffic to on-prem
  - Force tunneling via NVA
  - Internet routing through a firewall

---

# 🔗 VNet Peering

- Enables **private connectivity** between two VNets
- Works within region and across regions (Global VNet Peering)
- Like AWS, **no transitive routing**:

```plaintext
VNet A ↔ VNet B ✅
VNet A ↔ VNet B ↔ VNet C ❌ (A cannot see C)
```

---

# 🔐 Azure Firewall vs NSGs

| Feature         | NSG                     | Azure Firewall               |
| --------------- | ----------------------- | ---------------------------- |
| Layer           | Network layer (TCP/UDP) | L3 + L7 (App rules)          |
| Scope           | Subnet / NIC            | Centralized, per VNet        |
| Logging         | Minimal                 | Full diagnostic logs, alerts |
| NAT/Translation | ❌                      | ✅ Yes                       |
| Use Case        | Light access control    | Deep inspection + logging    |

Use **both** for layered defense!

---

# 📦 Sample VNet Configuration (Terraform Style)

```hcl
resource "azurerm_virtual_network" "main" {
  name                = "my-vnet"
  address_space       = ["10.0.0.0/16"]
  location            = "East US"
  resource_group_name = "my-rg"
}

resource "azurerm_subnet" "web" {
  name                 = "web-subnet"
  virtual_network_name = azurerm_virtual_network.main.name
  address_prefixes     = ["10.0.1.0/24"]
}

resource "azurerm_network_interface" "vmnic" {
  name                = "vm1-nic"
  location            = "East US"
  resource_group_name = "my-rg"

  ip_configuration {
    name                          = "internal"
    subnet_id                     = azurerm_subnet.web.id
    private_ip_address_allocation = "Dynamic"
    public_ip_address_id          = azurerm_public_ip.vm.id
  }
}
```

---

# 🧠 AWS Differences to Note

| Azure VNet                         | AWS VPC                              |
| ---------------------------------- | ------------------------------------ |
| No Internet Gateway required       | Requires Internet Gateway            |
| Subnets not tied to AZs            | Subnets are AZ-specific              |
| NSGs can attach to NIC or subnet   | SGs attach only to ENIs              |
| No NSG-to-NSG references           | SG-to-SG referencing supported       |
| Private Link = cleaner integration | Interface/Gateway Endpoints separate |
| Private DNS Zones per VNet         | Route 53 Private Zones per VPC       |

---

# ✅ Summary – What You Should Know

- Azure VNet is nearly 1:1 with AWS VPC—but with different defaults.
- No IGW required; internet access just needs a Public IP or NAT Gateway.
- NSGs act like security groups but are more flexible in placement (subnet/NIC).
- You **don’t define subnets per AZ**—Azure picks AZ when deploying resources.
- Azure’s Private Link and Service Endpoints are smoother for integrating PaaS services.
