# 📘 Variables in ARM Templates

## 🔹 What Are Variables?

In ARM (Azure Resource Manager) templates, **variables** are _helper values_ that simplify and optimize template design.
They:

- Store **intermediate values** (instead of repeating logic).
- Support **dynamic construction** of names, IDs, and configurations.
- Enhance **readability, maintainability, and reusability** of templates.

👉 **Analogy**:

- **Parameters** = external input (what user provides).
- **Variables** = internal helpers (calculated inside template).

---

## 🔹 Types of Variables

### 1. **User-defined Variables**

Defined in the `variables` block of the template by the author.

```json
"variables": {
  "storagePrefix": "mystg",
  "fullName": "[concat(variables('storagePrefix'), uniqueString(resourceGroup().id))]"
}
```

- Created **explicitly** by you.
- Can be **string, integer, boolean, array, or object**.
- Reused throughout the template.

---

### 2. **Built-in (Expression-based) Variables**

Not directly declared, but **created dynamically using ARM functions** like:

- `resourceGroup()` → Info about current resource group.
- `subscription()` → Subscription metadata.
- `deployment()` → Deployment-specific details.

Example:

```json
"variables": {
  "rgLocation": "[resourceGroup().location]",
  "uniqueSuffix": "[uniqueString(subscription().id, resourceGroup().id)]"
}
```

➡️ Uses **built-in context functions** to generate values at runtime.

---

### 3. **Complex Variables (Arrays & Objects)**

Used for storing structured data instead of plain strings.

#### Array Variable

```json
"variables": {
  "vmSizes": ["Standard_B2s", "Standard_B4ms", "Standard_D2s_v3"]
}
```

Usage:

```json
"size": "[variables('vmSizes')[1]]"
```

#### Object Variable

```json
"variables": {
  "storageSku": {
    "name": "Standard_LRS",
    "tier": "Standard"
  }
}
```

Usage:

```json
"sku": "[variables('storageSku')]"
```

---

## 🔹 Variables vs Parameters

| **Aspect**         | **Parameters**                            | **Variables**                            |
| ------------------ | ----------------------------------------- | ---------------------------------------- |
| **Input source**   | Supplied by user, automation, or defaults | Defined inside template                  |
| **Purpose**        | Accept external configuration             | Build internal helper values             |
| **When to change** | Changes between deployments               | Stays consistent unless template changes |
| **Examples**       | VM size, region, admin username           | Resource names, IDs, calculated values   |

👉 **Rule of Thumb**:

- Use **parameters** for external, user-driven changes.
- Use **variables** for internal, calculated, or repeated values.

---

## 🔹 Common ARM Functions with Variables

Variables often combine with **ARM template functions**:

- `concat()` → build strings
- `uniqueString()` → create unique suffixes
- `toLower() / toUpper()` → enforce casing
- `substring()` → trim values
- `if()` → conditional logic

Example:

```json
"variables": {
  "env": "[parameters('environment')]",
  "storageName": "[toLower(concat('stg', uniqueString(resourceGroup().id, parameters('environment'))))]"
}
```

---

## 🔹 Examples of Variable Use

### 1. Generate Unique Resource Names

```json
"variables": {
  "storageAccountName": "[concat('stg', uniqueString(resourceGroup().id))]"
}
```

### 2. Conditional Resource Selection

```json
"variables": {
  "vmSize": "[if(equals(parameters('environment'), 'prod'), 'Standard_D2s_v3', 'Standard_B2s')]"
}
```

### 3. Nested Object Lookup

```json
"variables": {
  "skuMap": {
    "dev": "Standard_LRS",
    "prod": "Premium_LRS"
  }
}
```

Usage:

```json
"sku": "[variables('skuMap')[parameters('environment')]]"
```

---

## 🔹 Best Practices

1. **Use variables for dynamic, reusable values** (resource names, IDs, connection strings).
2. **Keep parameters minimal** → only request what must change.
3. **Avoid repeating complex functions** → put them in variables.
4. **Use objects/arrays** for structured configuration.
5. **Don’t hardcode secrets** → always use **Azure Key Vault**.

---

## 🔹 Authentication vs Authorization Context (Important)

When variables are used in identity-sensitive resources:

- **Authentication** → Verifying _who_ the user/app is (via Entra ID, previously Azure AD).
- **Authorization** → Determining _what actions_ they can perform (via RBAC, ACLs).

👉 Variables can help construct **resource IDs, principal IDs, or role assignment names** dynamically, but access is still enforced by Azure RBAC or policies.

---

## ✅ Summary

- **Variables in ARM templates** are internal helpers to simplify and streamline deployments.
- They come in **user-defined**, **built-in (function-based)**, and **complex (arrays/objects)** forms.
- Use **parameters for external input**, and **variables for internal logic**.
- Combine variables with **ARM functions** to generate dynamic, unique, and conditional values.
