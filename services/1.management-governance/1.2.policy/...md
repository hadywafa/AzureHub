# 🌍 Azure Policy — Explained the Simple Way

Azure Policy is like the **rules engine** for your Azure environment.
It makes sure people don’t go wild creating resources in the wrong place, without tags, or without security controls.
You set the rules once → Azure checks **every resource** (new or old) → and either **blocks, fixes, or just warns**.

---

## 🧱 The Main Pieces (Who does what?)

- **Policy Definition** → the _actual rule_. Example: “All resources must have a `costCenter` tag.”
- **Initiative (Policy Set)** → a _bundle of rules_. Example: “Our production baseline” with 15 rules.
- **Assignment** → _where you apply it_. At subscription, resource group, or management group.
- **Exemption** → “okay, this resource is special — don’t apply the rule here.” (with a reason).
- **Remediation Task** → “fix the old mess.” Runs Modify or DeployIfNotExists to bring existing stuff into compliance.

---

## 🎯 Where & How Rules Apply

- **Scope**: You can assign at management group → subscription → resource group → resource.
- **Inheritance**: Rules flow downward. Assign at subscription, and RGs/resources under it inherit.
- **Exclusions**: Carve out specific RGs or resources when you need exceptions.

---

## 🔍 How a Rule Looks (Logic)

Each policy is basically:

👉 **If** a condition is true (like “resource type is VM”)
👉 **Then** do something (deny, audit, modify, deploy, etc.)

Conditions are built using **fields** (aka aliases).

- Example alias: `location`, `tags['costCenter']`, `Microsoft.Compute/virtualMachines/sku.name`.

---

## ⚡ The Effects (What actually happens)

- **Deny** → Block it right away.
- **Audit** → Just flag it (resource still gets created).
- **AuditIfNotExists** → Flag if something related is missing.
- **Append** → Add fields to the request (like extra tags).
- **Modify** → Change the request to make it compliant (needs identity & role).
- **DeployIfNotExists (DINE)** → If something’s missing, deploy it (e.g., diagnostics).
- **Disabled** → Temporarily turn off a rule.

---

## 🛠️ Enforcement Mode

- **Default** → Normal behavior (deny really denies).
- **DoNotEnforce** → Only evaluate → no blocking or changing. Perfect for “test run” or gradual rollout.

---

## 🧑‍⚖️ Exemptions (Formal exceptions)

Sometimes you can’t follow the rule. That’s where **Exemptions** come in:

- **Waiver** → We accept the risk, don’t enforce here.
- **Mitigated** → The requirement is met another way (like a third-party tool).
- **Time-bound** → With an expiry date and justification.

Exempt resources show up as “Exempt” in compliance reports.

---

## 🧩 Special Areas Azure Policy Can Control

- **Kubernetes (AKS)** → Validates manifests (via OPA/Gatekeeper). Blocks bad pod configs.
- **Guest Configuration** → Checks inside VMs (password policy, encryption, services running).
- **Control plane focus** → Mostly affects ARM (create/update/delete). Data plane enforcement is limited.

---

## 🔁 Compliance & Fixing Old Stuff

- New resources are checked **at creation/update time**.
- Old resources → need **remediation tasks** to bring them into compliance.
- Compliance states: **Compliant / Non-compliant / Exempt / Not started / Unknown**.

---

## 🛡️ Why Identity & RBAC Matter

For **Modify** or **DINE**:

- The assignment needs a **managed identity**.
- That identity must have **roleDefinitionIds** (permissions) to actually fix or deploy stuff.
  Otherwise → remediation fails.

---

## 🛠️ Everyday Examples

1. **Tag enforcement**

   - Deny any resource without a `costCenter` tag.

2. **Allowed regions**

   - Only let resources deploy in `EastUS` or `WestEurope`.

3. **Diagnostics**

   - If a Key Vault doesn’t have logs → automatically deploy diagnostic settings.

4. **VM settings**

   - Inside VM, check password length policy with Guest Configuration.

---

## 📊 Best Practices (human checklist)

- Start **with Audit/DoNotEnforce** → then flip to Deny once you’re confident.
- Use **Initiatives** instead of 50 separate policies. Easier to manage & report.
- Always **assign with identity** if using Modify/DINE.
- Document **Exemptions** with expiry & reason (auditors love this).
- Regularly check the **Compliance blade** in Azure Portal.
- Use **Management Groups** to push rules at scale.

---

## 🚀 Quick Mental Model

Azure Policy = 🛡️ Security guard at the door:

- Checks ID (conditions/aliases).
- Lets you in, blocks you, or tells you “you can come in, but we’ll report you.”
- If you already got in with bad shoes → remediation comes and swaps them out.
