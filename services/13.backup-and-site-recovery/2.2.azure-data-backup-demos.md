# â˜ï¸ Azure Data Backup Demos (Hands-On Edition)

Backups are like parachutes ğŸª‚â€”you hope youâ€™ll never need them, but when you do, youâ€™re glad theyâ€™re there. Letâ€™s go through real demos step by step with CLI + portal + PowerShell.

---

## âœğŸ» **Demo 1.** Backup & Restore Azure VMs

### 1ï¸âƒ£ Step 1: Create a Recovery Services Vault

**What:** A secure "cloud safe" to hold your backups.  
**Why:** Without it, Azure has nowhere to store your VM backups.

**How (Portal):**

1. Go to **Azure Portal** â†’ _Create Resource_.
2. Search for **Recovery Services Vault** â†’ Click _Create_.
3. Fill details:

   - Name: `MyRecoveryVault`
   - RG: `MyResourceGroup`
   - Location: `East US`

âœ… Hit **Review + Create** â†’ _Create_.

**How (Azure CLI):**

```bash
# Create a resource group (if not exists)
az group create --name MyResourceGroup --location eastus

# Create Recovery Services Vault
az backup vault create \
  --resource-group MyResourceGroup \
  --name MyRecoveryVault \
  --location eastus
```

---

### 2ï¸âƒ£ Step 2: Configure Backup for a VM

**What:** Tell Azure which VMs to protect.  
**Why:** Backups = restore points against crashes, corruption, or accidental deletes.

**How (Portal):**

1. Open **Recovery Services Vault** â†’ _Backup_.
2. Choose **Azure â†’ Virtual Machine**.
3. Select your VM(s).
4. Pick/Create a **Backup Policy** (daily, weekly, retention).
5. Click **Enable Backup**.

**How (PowerShell):**

```powershell
# Register backup container
Register-AzRecoveryServicesBackupContainer `
   -VaultId (Get-AzRecoveryServicesVault -Name "MyRecoveryVault").ID `
   -ResourceGroupName "MyResourceGroup" `
   -Name "MyVMName" `
   -Type "AzureVM"

# Apply default backup policy
Enable-AzRecoveryServicesBackupProtection `
   -Policy (Get-AzRecoveryServicesBackupProtectionPolicy -Name "DefaultPolicy") `
   -Name "MyVMName"
```

---

### 3ï¸âƒ£ Step 3: Run Backup

**What:** Trigger the backup manually (or wait for schedule).  
**Why:** First backup = first restore point.

**How (CLI):**

```bash
az backup protection backup-now \
  --resource-group MyResourceGroup \
  --vault-name MyRecoveryVault \
  --container-name MyVMName \
  --item-name MyVMName \
  --retain-until 2025-12-31
```

---

### 4ï¸âƒ£ Step 4: Restore VM

**Option A â€“ Full VM Restore (Portal):**

1. Vault â†’ _Backup Items_ â†’ _Azure VM_.
2. Pick VM â†’ _Restore VM_.
3. Choose restore point â†’ Configure â†’ Restore.

**Option B â€“ File Recovery:**

1. Vault â†’ _Backup Items_ â†’ _VM_ â†’ _File Recovery_.
2. Select restore point â†’ Download **MARS Agent Script**.
3. Run script â†’ mount recovery point â†’ copy needed files.

---

## âœğŸ» **Demo 2.** Backup & Restore On-Premises VMs (MARS Agent)

### 1ï¸âƒ£ Step 1: Register On-Prem VM

- Vault â†’ _Backup_ â†’ _On-Premises_.
- Choose **Files/Folders** or **System State**.

### 2ï¸âƒ£ Step 2: Install MARS Agent

1. Download MARS agent from vault.
2. Install on on-prem server.
3. Import **Vault Credentials** file.

### 3ï¸âƒ£ Step 3: Schedule Backups

- Open MARS UI â†’ Select folders â†’ Set schedule (daily 2 AM) â†’ Define retention.

**Pro Tip (Notifications):**
Configure Alerts â†’ Action Group â†’ Email = instant notifications on failures.

### 4ï¸âƒ£ Restore

- MARS UI â†’ _Restore_ â†’ Pick restore point â†’ Choose original or new location â†’ Restore.

---

## âœğŸ» **Demo 3.** Backup & Restore Azure File Shares

### 1ï¸âƒ£ Step 1: Enable Backup

1. Vault â†’ _Backup_ â†’ _Azure â†’ Azure File Share_.
2. Select Storage Account â†’ File Share.
3. Apply/Create Backup Policy.

**Azure CLI:**

```bash
# Enable backup for file share
az backup protection enable-for-azurefileshare \
  --resource-group MyResourceGroup \
  --vault-name MyFileShareVault \
  --storage-account MyStorageAccount \
  --name MyFileShare \
  --policy-name DefaultPolicy
```

### 2ï¸âƒ£ Step 2: Backup

Vault â†’ _Backup Jobs_ â†’ _Backup Now_ â†’ Pick file share â†’ Start.

### 3ï¸âƒ£ Step 3: Restore

Vault â†’ _Backup Items_ â†’ _Azure File Share_ â†’ _Restore Files_ â†’ Pick restore point â†’ Restore.

---

## âœğŸ» **Demo 4.** Delete Recovery Services Vault

âš ï¸ Rule: Vaults **cannot** be deleted while backups exist.

### 1ï¸âƒ£ Step 1: Clean Up

- Remove backup items from vault.

**CLI:**

```bash
az backup item delete \
  --vault-name MyRecoveryVault \
  --resource-group MyResourceGroup \
  --container-name MyVMName \
  --name MyVMName \
  --delete-backup-data true
```

### 2ï¸âƒ£ Step 2: Delete Vault

```bash
az backup vault delete \
  --name MyRecoveryVault \
  --resource-group MyResourceGroup
```

Confirm in portal â†’ itâ€™s gone.

---

## ğŸ **Summary**

- **VMs** â†’ Full VM + File recovery.
- **On-Prem** â†’ Needs MARS agent.
- **File Shares** â†’ Easy point-in-time recovery.
- **Vault Deletion** â†’ Clean backups first!

Backups arenâ€™t sexy ğŸ˜…, but when disaster strikes, they save the day.
