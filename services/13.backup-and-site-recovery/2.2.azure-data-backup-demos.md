# ☁️ Azure Data Backup Demos (Hands-On Edition)

Backups are like parachutes 🪂—you hope you’ll never need them, but when you do, you’re glad they’re there. Let’s go through real demos step by step with CLI + portal + PowerShell.

---

## ✍🏻 **Demo 1.** Backup & Restore Azure VMs

### 1️⃣ Step 1: Create a Recovery Services Vault

**What:** A secure "cloud safe" to hold your backups.  
**Why:** Without it, Azure has nowhere to store your VM backups.

**How (Portal):**

1. Go to **Azure Portal** → _Create Resource_.
2. Search for **Recovery Services Vault** → Click _Create_.
3. Fill details:

   - Name: `MyRecoveryVault`
   - RG: `MyResourceGroup`
   - Location: `East US`

✅ Hit **Review + Create** → _Create_.

**How (Azure CLI):**

```bash
# Create a resource group (if not exists)
az group create --name MyResourceGroup --location eastus

# Create Recovery Services Vault
az backup vault create \
  --resource-group MyResourceGroup \
  --name MyRecoveryVault \
  --location eastus
```

---

### 2️⃣ Step 2: Configure Backup for a VM

**What:** Tell Azure which VMs to protect.  
**Why:** Backups = restore points against crashes, corruption, or accidental deletes.

**How (Portal):**

1. Open **Recovery Services Vault** → _Backup_.
2. Choose **Azure → Virtual Machine**.
3. Select your VM(s).
4. Pick/Create a **Backup Policy** (daily, weekly, retention).
5. Click **Enable Backup**.

**How (PowerShell):**

```powershell
# Register backup container
Register-AzRecoveryServicesBackupContainer `
   -VaultId (Get-AzRecoveryServicesVault -Name "MyRecoveryVault").ID `
   -ResourceGroupName "MyResourceGroup" `
   -Name "MyVMName" `
   -Type "AzureVM"

# Apply default backup policy
Enable-AzRecoveryServicesBackupProtection `
   -Policy (Get-AzRecoveryServicesBackupProtectionPolicy -Name "DefaultPolicy") `
   -Name "MyVMName"
```

---

### 3️⃣ Step 3: Run Backup

**What:** Trigger the backup manually (or wait for schedule).  
**Why:** First backup = first restore point.

**How (CLI):**

```bash
az backup protection backup-now \
  --resource-group MyResourceGroup \
  --vault-name MyRecoveryVault \
  --container-name MyVMName \
  --item-name MyVMName \
  --retain-until 2025-12-31
```

---

### 4️⃣ Step 4: Restore VM

**Option A – Full VM Restore (Portal):**

1. Vault → _Backup Items_ → _Azure VM_.
2. Pick VM → _Restore VM_.
3. Choose restore point → Configure → Restore.

**Option B – File Recovery:**

1. Vault → _Backup Items_ → _VM_ → _File Recovery_.
2. Select restore point → Download **MARS Agent Script**.
3. Run script → mount recovery point → copy needed files.

---

## ✍🏻 **Demo 2.** Backup & Restore On-Premises VMs (MARS Agent)

### 1️⃣ Step 1: Register On-Prem VM

- Vault → _Backup_ → _On-Premises_.
- Choose **Files/Folders** or **System State**.

### 2️⃣ Step 2: Install MARS Agent

1. Download MARS agent from vault.
2. Install on on-prem server.
3. Import **Vault Credentials** file.

### 3️⃣ Step 3: Schedule Backups

- Open MARS UI → Select folders → Set schedule (daily 2 AM) → Define retention.

**Pro Tip (Notifications):**
Configure Alerts → Action Group → Email = instant notifications on failures.

### 4️⃣ Restore

- MARS UI → _Restore_ → Pick restore point → Choose original or new location → Restore.

---

## ✍🏻 **Demo 3.** Backup & Restore Azure File Shares

### 1️⃣ Step 1: Enable Backup

1. Vault → _Backup_ → _Azure → Azure File Share_.
2. Select Storage Account → File Share.
3. Apply/Create Backup Policy.

**Azure CLI:**

```bash
# Enable backup for file share
az backup protection enable-for-azurefileshare \
  --resource-group MyResourceGroup \
  --vault-name MyFileShareVault \
  --storage-account MyStorageAccount \
  --name MyFileShare \
  --policy-name DefaultPolicy
```

### 2️⃣ Step 2: Backup

Vault → _Backup Jobs_ → _Backup Now_ → Pick file share → Start.

### 3️⃣ Step 3: Restore

Vault → _Backup Items_ → _Azure File Share_ → _Restore Files_ → Pick restore point → Restore.

---

## ✍🏻 **Demo 4.** Delete Recovery Services Vault

⚠️ Rule: Vaults **cannot** be deleted while backups exist.

### 1️⃣ Step 1: Clean Up

- Remove backup items from vault.

**CLI:**

```bash
az backup item delete \
  --vault-name MyRecoveryVault \
  --resource-group MyResourceGroup \
  --container-name MyVMName \
  --name MyVMName \
  --delete-backup-data true
```

### 2️⃣ Step 2: Delete Vault

```bash
az backup vault delete \
  --name MyRecoveryVault \
  --resource-group MyResourceGroup
```

Confirm in portal → it’s gone.

---

## 🏁 **Summary**

- **VMs** → Full VM + File recovery.
- **On-Prem** → Needs MARS agent.
- **File Shares** → Easy point-in-time recovery.
- **Vault Deletion** → Clean backups first!

Backups aren’t sexy 😅, but when disaster strikes, they save the day.
