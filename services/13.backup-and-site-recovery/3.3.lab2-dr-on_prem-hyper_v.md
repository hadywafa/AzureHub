# ğŸ§ª Lab 2 â€“ Disaster Recovery for Hyper-V to Azure

This is the **classic on-prem â†’ Azure DR scenario**, where you replicate Hyper-V VMs to Azure.

---

## âš™ï¸ Step 1 â€“ Prepare Azure

1. **Create Recovery Services Vault** (same as Lab 1).
2. In Vault â†’ **Site Recovery** â†’ _Prepare Infrastructure_.

   - **Protection goal**: Replicate _On-Premises to Azure_.
   - **Workload type**: Hyper-V.
   - **Deployment**: _Without VMM_ (if using standalone Hyper-V) or _With VMM_ (if using System Center Virtual Machine Manager).

---

## âš™ï¸ Step 2 â€“ Install Hyper-V Replication Provider

1. From Vault â†’ _Site Recovery Infrastructure â†’ Hyper-V Sites_.
2. Create new **Hyper-V Site** (`MyHyperVSite`).
3. Add **Hyper-V server** â†’ Download **Azure Site Recovery Provider + Vault registration key**.
4. On Hyper-V host:

   - Install Provider MSI.
   - Register using downloaded Vault key.

---

## âš™ï¸ Step 3 â€“ Configure Replication for Hyper-V VMs

**Portal:**

1. Vault â†’ _Replicate Application_.
2. Source: `MyHyperVSite`.
3. Target: Azure Region (e.g., _East US_).
4. Choose Storage Account & VNet for replicas.
5. Select VMs â†’ Define replication settings (frequency, RPO, retention).

**PowerShell (on Hyper-V host):**

```powershell
# Register Hyper-V with ASR
Register-AzRecoveryServicesAsrProvider `
   -VaultId (Get-AzRecoveryServicesVault -Name "MyRecoveryVault").ID `
   -Path "C:\ASRProvider"

# Enable protection for VM
Start-AzRecoveryServicesAsrProtection `
   -Name "MyOnPremVM" `
   -ProtectionContainerId "MyHyperVContainer" `
   -PolicyId "DefaultPolicy"
```

---

## âš™ï¸ Step 4 â€“ Test Failover

1. Vault â†’ _Replicated Items_ â†’ Select VM â†’ _Test Failover_.
2. Choose Recovery Point.
3. VM spins up in Azure test VNet.
4. Validate connectivity & functionality.

---

## âš™ï¸ Step 5 â€“ Planned Failover

1. In real disaster â†’ Trigger **Failover**.
2. VM is started in Azure.
3. End users switch to DR VM.

---

## âš™ï¸ Step 6 â€“ Failback (After On-Prem is Healthy)

1. Once Hyper-V site is restored â†’ Choose _Failback_.
2. Sync changes back to on-prem VMs.
3. Replication resumes from Azure â†’ Hyper-V.

---

### ğŸ” Visual Workflow

```mermaid
flowchart TD
    A[Hyper-V On-Premises VM] -->|Replication| B[(Recovery Services Vault)]
    B --> C[Replica in Azure VM]
    C -->|Failover| D[VM Running in Azure]
    D -->|Failback| A
```

---

## ğŸ“ Final Summary

- **Lab 2 (Hyper-V â†’ Azure)**:

  - Install ASR Provider â†’ Register Hyper-V â†’ Replicate VMs â†’ Test Failover â†’ Failover â†’ Failback.
  - Ideal for hybrid workloads & migration scenarios.
