# ğŸŒ _Backup_ - **Azure App Service** _(for Web Apps hosted on App Service)_

> ğŸ“– It is a built-in feature to back up and restore your **App Serviceâ€“hosted web apps** with just a few clicks.

---

> ğŸ¤” When you host a website or API using **Azure App Service**, you donâ€™t want to lose your code, configurations, or linked databases because of a failed deployment, human error, or corruption.
> This is where **App Service Backup** comes in.  
> **Azure App Service Backup** lets you protect your web apps (and linked databases) with **automatic** or **manual** backups, giving you restore points against bugs, corruption, or "oops-I-deleted-it" moments.

<div align="center">
  <img src="images/az-app-service-backup.png" alt="Azure App Service Backup" style="border-radius: 10px; width: 100%; border: 2px solid white;">
</div>

---

## ğŸ”‘ Key Features

1. **Automated Backups** â€“ Azure schedules backups (daily, weekly).
2. **On-Demand Backups** â€“ Trigger backups anytime before risky deployments.
3. **Backup Scope** â€“ App config + file system + connected DBs (SQL, MySQL, PostgreSQL).
4. **Retention Policies** â€“ Keep backups only as long as needed â†’ save storage ğŸ’°.
5. **Encrypted by Default** â€“ Secure at rest and in transit ğŸ”.
6. **Flexible Restores** â€“ Overwrite existing app or restore to a new app/slot.

---

## ğŸ’¡ Use Cases

- **ğŸ›¡ï¸ Data Protection** â†’ accidental deletes, corruption, or ransomware.
- **ğŸ§ª Dev/Test** â†’ create restore points before deploying risky updates.
- **ğŸš¨ Disaster Recovery** â†’ fast rollback in case prod burns ğŸ”¥.

---

## âš–ï¸ Automatic vs Manual Backups

<div align="center">
  <img src="images/az-app-service-backup-options.png" alt="Backup Options" style="border-radius: 10px; width: 100%; border: 2px solid white;">

---

| Feature              | ğŸ¤– Automatic Backups | ğŸ‘¨ğŸ»â€ğŸ’» Manual Backups           |
| -------------------- | -------------------- | --------------------------- |
| **Initiation**       | Azure scheduled      | User initiated              |
| **Frequency**        | Regular (e.g. daily) | On-demand                   |
| **Retention Policy** | Predefined           | User-defined                |
| **Backup Size**      | 30 GB                | 10 GB (4 GB for DBs)        |
| **Linked Database**  | âŒ Not included      | âœ… SQL, MySQL, PostgreSQL   |
| **Storage Account**  | âŒ Not required      | âœ… Required                 |
| **Downloadable**     | âŒ No                | âœ… Yes (blobs)              |
| **Partial Backups**  | âŒ No                | âœ… Yes via `_backup.filter` |
| **VNet Support**     | âŒ No                | âœ… Yes                      |

</div>

> ğŸ‘‰ **Translation:**  
> **ğŸ¤– Automatic = set-and-forget**.  
> **ğŸ‘¨ğŸ»â€ğŸ’» Manual = flexible + powerful (with storage + filters).**

---

## âš™ï¸ How It Works

1. **Configure Backups (Portal)**

   - App Service â†’ _Backups_ â†’ Configure.
   - Select **Storage Account** + **Container**.
   - Include linked DBs if needed.

2. **Run Backups**

   - Automatic (Azure schedule)
   - Manual (_Backup Now_ button).

3. **Restore Backups**

   - Restore to existing app, new app, or staging slot.
   - Validate functionality â†’ swap slots if needed.

---

## ğŸ¯ Using `_backup.filter` for Selective Backups

The `_backup.filter` file = your "exclude list" during **manual** backups.
It helps skip logs, temp files, or other junk to keep backups lean.

### Steps:

1. Create a text file â†’ name it `_backup.filter`.
2. Add exclusions (one per line).
3. Place it in your app root (`wwwroot`).
4. Run **manual backup** â†’ Azure excludes listed items.

### Example `_backup.filter`

```text
# Exclude temp folder
/temp

# Exclude all logs
/logs/*

# Exclude secrets file
/secrets.txt
```

---

## ğŸš€ Hands-On (CLI + PowerShell)

### ğŸ”¹ Configure Manual Backup (Azure CLI)

```bash
# Set variables
RESOURCE_GROUP="MyRG"
WEBAPP_NAME="MyApp"
STORAGE_ACCOUNT="mystorageacct"
CONTAINER_NAME="appbackups"

# Configure backup
az webapp config backup create \
  --resource-group $RESOURCE_GROUP \
  --webapp-name $WEBAPP_NAME \
  --storage-account-url https://$STORAGE_ACCOUNT.blob.core.windows.net/$CONTAINER_NAME \
  --frequency 1d \
  --retention 7d \
  --db-type SQLAzure \
  --db-connection-string "Server=tcp:mydb.database.windows.net;Database=mydb;User Id=user;Password=secret!;"
```

### ğŸ”¹ Trigger Manual Backup

```bash
az webapp config backup create \
  --resource-group $RESOURCE_GROUP \
  --webapp-name $WEBAPP_NAME \
  --storage-account-url https://$STORAGE_ACCOUNT.blob.core.windows.net/$CONTAINER_NAME
```

### ğŸ”¹ Restore App from Backup

```bash
az webapp config backup restore \
  --resource-group $RESOURCE_GROUP \
  --webapp-name $WEBAPP_NAME \
  --backup-name MyAppBackup \
  --container-url https://$STORAGE_ACCOUNT.blob.core.windows.net/$CONTAINER_NAME \
  --overwrite
```

### ğŸ”¹ PowerShell Example

```powershell
# Trigger backup
New-AzWebAppBackup `
   -ResourceGroupName "MyRG" `
   -Name "MyApp" `
   -StorageAccountUrl "https://mystorageacct.blob.core.windows.net/appbackups" `
   -FrequencyInterval 1 `
   -FrequencyUnit Day `
   -RetentionPeriodInDays 7 `
   -Databases @(@{ConnectionString="Server=tcp:mydb.database.windows.net;Database=mydb;User Id=user;Password=secret!"; Name="MyDb"; Type="SQLAzure"})
```

---

## ğŸ”— Integration with Other Azure Services

- **Azure Site Recovery (ASR)** â†’ full workload replication for DR.
- **Azure Monitor** â†’ alerts when backups fail.
- **Key Vault** â†’ securely store DB connection strings used in backups.

---

## ğŸ“ Summary

- **Automatic** â†’ easy, but limited.
- **Manual** â†’ more control (filters, DBs, storage).
- **\_backup.filter** â†’ exclude junk.
- **CLI/PowerShell** â†’ automate everything.

> ğŸ‘‰ Best practice: Use **Automatic** for daily safety + **Manual (with filters)** before major deployments.
