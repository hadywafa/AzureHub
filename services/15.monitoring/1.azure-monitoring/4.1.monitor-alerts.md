# ğŸš¨ **Azure Monitor Alerts**

## ğŸ—ï¸ **1. What Are Azure Monitor Alerts?**

**Definition (official-ish):**
Azure Monitor Alerts are **automated notifications** or **actions** triggered when a condition is met based on metrics, logs, or activity in Azure.

Think of it as your **watchdog** ğŸ•:

- If CPU > 90% for 10 minutes â†’ Bark (email/SMS/Teams).
- If too many failed logins â†’ Growl (send to SOC / block user).
- If storage account nearing 100% capacity â†’ Scream (open ServiceNow ticket).

---

<div align="center">
  <img src="images/azure-monitor-alerts-components.png" alt="Key Components" style="width: 100%; border-radius: 10px; border: 2px solid white;">
</div>

---

## ğŸ› ï¸ **2. Alert Building Blocks**

### 1ï¸âƒ£ **Signal Source (What to Watch?)**

- **Metrics** (near real-time, fast, numeric)
- **Logs (KQL-based)** (rich, detailed, but slight delay \~2-5 min)
- **Activity Logs** (control plane events, e.g., VM deleted, NSG modified)
- **Prometheus Metrics** (AKS + Container Insights)

### 2ï¸âƒ£ **Condition (When to Bark?)**

- For Metrics â†’ â€œIf CPU > 80% for 5 minutesâ€
- For Logs â†’ â€œIf failed logins > 50 in 10 minutesâ€
- For Activity Logs â†’ â€œIf someone disabled a firewall ruleâ€

### 3ï¸âƒ£ **Action Groups (Who to Tell? & What to Do?)**

- Email ğŸ“§
- SMS ğŸ“±
- Push notifications
- Teams/Slack webhook ğŸ’¬
- Runbook automation âš™ï¸
- Logic App (custom workflows)
- ITSM integration (ServiceNow, etc.)

---

## ğŸ“Š **3. Alert Types in Azure Monitor**

### ğŸ”¹ **Metric Alerts**

- Near real-time (1-min granularity).
- Example: â€œCPU > 85% on VM for 10 mins.â€

### ğŸ”¹ **Log Alerts**

- Run on **KQL queries** against Log Analytics.
- Example: â€œIf >10 sign-in failures from same IP in 5 mins.â€

### ğŸ”¹ **Activity Log Alerts**

- Triggered by **Azure Resource Manager (ARM) operations**.
- Example: â€œIf VM is deleted OR NSG changed.â€

### ğŸ”¹ **Smart Alerts (Preview/AI-enhanced)**

- Azure uses ML to detect anomalies (like unusual spikes in traffic).

---

## ğŸ“ **4. How Alerts Work (Behind the Scenes)**

**Hereâ€™s the pipeline ğŸ”½:**

---

```mermaid
---
config:
  layout: elk
  elk:
    mergeEdges: false
    nodePlacementStrategy: LINEAR_SEGMENTS
---
flowchart LR
  A[Data Sources] -->|Metrics/Logs/Activity| B[Azure Monitor]
  B --> C[Alert Rules]
  C --> D{Condition Met?}
  D -- Yes --> E[Action Group Triggered]
  E --> F[Notify via Email/SMS/Teams]
  E --> G[Automation Runbook / Logic App]
  D -- No --> H[Do Nothing]
```

---

**So:**

- Signals flow in â†’
- Rule checks condition â†’
- If TRUE â†’ **Action Group** fires.

---

## ğŸ§© **5. Examples**

### Example 1: VM CPU High

- Signal: Metric = CPU %
- Condition: >80% for 10 mins
- Action: Email [ops@company.com](mailto:ops@company.com)

### Example 2: Security Alert

- Signal: Logs from `SigninLogs`
- KQL:

  ```kql
  SigninLogs
  | where ResultType != "0"
  | summarize FailedAttempts = count() by IPAddress, bin(TimeGenerated, 5m)
  | where FailedAttempts > 10
  ```

- Action: Trigger Logic App â†’ disable account.

### Example 3: Resource Deleted

- Signal: Activity Log
- Condition: When "Delete VM" event occurs
- Action: PagerDuty call ğŸ””

---

## âš™ï¸ **6. Lab: Create an Alert Rule**

### ğŸ”¹ Step 1: Go to Azure Monitor â†’ Alerts â†’ + Create Alert Rule

### ğŸ”¹ Step 2: Select **Scope**

- Choose the resource (VM, Storage, Subscription).

### ğŸ”¹ Step 3: Add **Condition**

- Pick signal: Metric, Log, Activity.
- Example: CPU > 80% for 5 mins.

### ğŸ”¹ Step 4: Define **Action Group**

- Create or reuse (with notifications + automation).
- Example: Email + Teams webhook.

### ğŸ”¹ Step 5: Review + Create ğŸš€

---

## ğŸ•µï¸ **7. Alert Lifecycle Management**

Alerts have states:

- **Fired** â†’ condition met.
- **Acknowledged** â†’ operator saw it.
- **Resolved** â†’ condition cleared.

This helps avoid â€œalert stormsâ€ ğŸŒªï¸.

---

## ğŸ’¡ **8. Best Practices**

1. **Avoid Alert Fatigue**:

   - Donâ€™t alert on _every_ CPU spike.
   - Use sustained thresholds (e.g., >80% for 15 mins).

2. **Group Alerts**:

   - Use **Dynamic Thresholds** (AI auto-adjusts baseline).

3. **Route Smartly**:

   - Critical â†’ PagerDuty.
   - Medium â†’ Email.
   - Low â†’ Log-only.

4. **Always Test Your Alerts**:

   - Trigger them on purpose (e.g., CPU stress test).

---

## ğŸ“’ **Notes**

- Alert are throttled (1 SMS/Call every 5 minutes and 100 email per hour).

## ğŸ **in short:**

- **Metrics Alerts** = fast & numeric.
- **Log Alerts** = deep, flexible (KQL).
- **Activity Alerts** = control-plane watchdog.
- **Action Groups** = the â€œdo somethingâ€ layer.
