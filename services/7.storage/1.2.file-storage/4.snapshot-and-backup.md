# ğŸ›¡ï¸ Azure Files â€” Snapshots & Backup

Azure Files offers **two levels of data protection**:

1. **Snapshots** â†’ Point-in-time copies of a file share (within the same storage account).
2. **Backup (Azure Backup)** â†’ A managed, policy-driven protection solution that stores file share backups in a separate vault with additional security and retention.

Both can be used together depending on your **business continuity and disaster recovery (BCDR)** needs.

---

## ğŸ“¸ **1. Snapshots**

A **snapshot** is a **read-only, point-in-time copy** of a file share.

### ğŸ”‘ Characteristics

- **Incremental** â†’ only changed blocks are stored, making snapshots space-efficient.
- **Instant** â†’ created in seconds, regardless of share size.
- **Same account** â†’ snapshots live in the same storage account as the file share.
- **Granular recovery** â†’ restore a single file, folder, or entire share.
- **Billing** â†’ only changed data consumes additional capacity.

### ğŸ“‚ How Snapshots Work

- Every time you take a snapshot â†’ Azure stores metadata + differences from previous snapshot.
- Files that havenâ€™t changed donâ€™t consume extra space.
- You can **browse snapshots** via:

  - Azure portal.
  - Windows Explorer (if SMB-mounted).
  - REST API.

### âš¡ Use Cases

- Quick **point-in-time protection**.
- Protect against **accidental deletions or modifications**.
- **Short-term retention** (hours/days).

### âš ï¸ Limitations

- Stored **in the same storage account** (not geo-redundant).
- Vulnerable to accidental/malicious deletion of the storage account.
- Retention management must be **manual**.

---

## â™»ï¸ **2. Azure Backup for Azure Files**

Azure Backup provides **centralized, automated protection** for Azure Files with **policy-based backup and long-term retention**.

### ğŸ”‘ Characteristics

- **Independent backups** â†’ stored in a **Recovery Services Vault (RSV)** separate from the storage account.
- **Policy-driven** â†’ define schedules (daily/hourly) and retention (days/months/years).
- **Secure** â†’ soft delete protection, vault-level security, and role-based access.
- **Application-consistent** â†’ ensures backups integrate smoothly with workloads.
- **Granular restore** â†’ recover a file, folder, or full share.

### âš¡ Benefits

- **Protection against accidental deletion** â†’ even if file share/storage account is deleted, backups remain safe in RSV.
- **Compliance** â†’ long-term retention policies (up to 10 years).
- **Centralized monitoring** â†’ across multiple subscriptions/accounts.
- **Zero infrastructure** â†’ fully managed by Azure.

### ğŸ”’ Security Features

- **Soft Delete for Backups** â†’ keeps backups for 14 days even after deletion requests.
- **MFA (Multi-Factor Auth) protection** for critical operations (e.g., stopping protection, deleting backups).
- **Immutable backups** â†’ cannot be altered or deleted by ransomware or malicious insiders.

---

## âš¡ **Snapshots vs Azure Backup**

| Feature                              | Snapshots             | Azure Backup                   |
| ------------------------------------ | --------------------- | ------------------------------ |
| **Location**                         | Same storage account  | Recovery Services Vault        |
| **Retention**                        | Manual, short-term    | Policy-based, long-term        |
| **Granularity**                      | File, folder, share   | File, folder, share            |
| **Protection from account deletion** | âŒ No                 | âœ… Yes                         |
| **Management**                       | Manual scripts/portal | Centralized policies           |
| **Use Case**                         | Quick, local rollback | Enterprise backup & compliance |

---

## ğŸ”„ **Recovery Scenarios**

### 1. **File-Level Restore**

- Accidentally deleted/modified a file.
- Browse snapshots/backups â†’ restore single file.

### 2. **Folder Restore**

- Ransomware encrypts a folder.
- Restore from snapshot (fast) or backup (more secure).

### 3. **Full Share Restore**

- Corruption spreads across share.
- Use Azure Backup â†’ restore entire share to a new one.

### 4. **Disaster Recovery**

- Storage account deleted or region outage.
- Azure Backup ensures data exists in **vault**, independent of account.

---

## ğŸ› ï¸ Implementation Steps (Azure Backup for Azure Files)

1. **Create a Recovery Services Vault (RSV)** in the Azure portal.
2. **Register the storage account** hosting the file share.
3. **Configure backup policy**:

   - Frequency: Daily/Hourly.
   - Retention: Days â†’ Months â†’ Years.

4. **Enable Backup** â†’ Azure starts protecting the file share.
5. **Monitor & Restore** via:

   - Azure portal.
   - PowerShell/CLI.
   - REST API.

---

## âœ… Best Practices

- Use **snapshots** for **short-term operational recovery**.
- Use **Azure Backup** for **long-term compliance & DR**.
- Enable **Soft Delete** for file shares (14-day grace period).
- Combine with **Azure RBAC** & **Entra ID-based access control** for layered security.
- Regularly test **restore scenarios** â†’ donâ€™t wait for real incidents.

---

ğŸ’¡ **Quick Recap:**

- **Snapshots = quick & cheap rollback inside same storage account.**
- **Azure Backup = enterprise-grade, policy-driven, secure, long-term protection.**
- Best practice: **Use both together** â€” snapshots for fast restores + backups for compliance and DR.

## ğŸ—‘ï¸ **3. Soft Delete**

Azure Files offers soft delete for file shares. Soft delete lets you recover deleted files and file shares.

<div style="text-align: center; border-radius: 10px; width: 80%; display: block; margin: 0 auto;">
  <img src="images/soft-delete.png" alt="Soft Delete" style="border-radius: 10px; width: 100%;">
</div>

---

### ğŸŒŸ **Characteristics**

- Soft delete for file shares is enabled at the file share level.

- Soft delete transitions content to a soft deleted state instead of being permanently erased.

- Soft delete lets you configure the retention period. The retention period is the amount of time that soft deleted file shares are stored and available for recovery.

- Soft delete provides a retention period between 1 and 365 days.

- Soft delete can be enabled on either new or existing file shares.
