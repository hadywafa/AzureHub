# 🔐 **Azure Storage Encryption**

> 📖 Official Definition  
> Azure Storage Encryption is **Microsoft’s built-in mechanism** to protect your data **at rest** and sometimes **in transit**, using strong encryption standards like **AES-256**, so even if someone gets physical access to the underlying storage media, all they’ll see is encrypted gibberish.

---

## 🧩 **The Two Main Stages of Encryption**

### 1️⃣ **Encryption at Rest**

- Happens **before** data is stored on disk.
- Uses **AES-256-bit** encryption.
- **Automatic by default** — you can’t turn it off (and you shouldn’t want to).
- Protects:

  - Blob storage (block, append, page blobs)
  - File shares
  - Queues
  - Tables

📌 **Fun fact:** Even if you upload an already-encrypted file, Azure still encrypts it again. Double armor!

---

### 2️⃣ **Encryption in Transit**

- Protects data while **traveling over the network**.
- Uses **HTTPS/TLS**.
- Applies to:

  - Client → Azure Storage communication
  - Storage replication between data centers

---

## 🎭 **Encryption Models**

Azure lets you choose **who holds the keys**.

### 🔑 **1. Microsoft-Managed Keys (MMK)**

- Default — Azure generates and rotates them automatically.
- You literally don’t have to lift a finger.
- Great for 99% of cases.

---

### 🤵🏻 **2. Customer-Managed Keys (CMK)**

- You store keys in **Azure Key Vault**.
- You manage:

  - Rotation
  - Revocation
  - Access control

- Required for certain compliance standards (ISO, HIPAA, etc.).
- Useful when security teams love the phrase: _"We need to own our encryption keys!"_

---

### 🪙 **3. Customer-Provided Keys (CPK)**

- You send your encryption key **with each request**.
- Azure uses it to encrypt/decrypt the blob **on the fly**.
- Keys are never stored by Azure.
- Best for **per-request encryption control**.

---

## 📦 **Per-Blob Encryption** (Optional Feature)

You can override encryption settings **per individual blob** using:

- A different key in Key Vault
- CPK for a one-time operation

---

## 📋 **Encryption & Key Management Table**

| Feature              | MMK (Microsoft Managed) | CMK (Customer Managed) | CPK (Customer Provided) |
| -------------------- | ----------------------- | ---------------------- | ----------------------- |
| Key storage          | Azure internal          | Azure Key Vault        | Client-side             |
| Rotation             | Automatic by Azure      | Managed by you         | Each request            |
| Compliance control   | Low                     | High                   | High                    |
| Per-request control  | ❌                      | ❌                     | ✅                      |
| Operational overhead | Minimal                 | Medium                 | High                    |

---

## ✅ **Best Practices**

- **Enable HTTPS only** for storage accounts.
- For CMK:

  - Store in **Key Vault Premium** (supports HSM-backed keys).
  - Automate key rotation.

- Monitor **Key Vault access logs** for suspicious activity.
- Avoid using CPK unless you _really_ need per-request control — it’s a management headache.
- If compliance says "Bring your own keys" → use CMK.
