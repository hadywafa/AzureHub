# üßëüèª‚Äçüíª **Implementation of Azure Storage Access Control ‚Äì Hands-On Demos**

Securing Azure Blob Storage isn‚Äôt just a _best practice_ ‚Äî it‚Äôs a **necessity**.
Azure gives you three main tools to control access:

1. **üîë Access Keys** ‚Äì All-or-nothing master keys.
2. **üßë‚Äçüíº Azure Role-Based Access Control (RBAC)** ‚Äì Assign fine-grained permissions.
3. **üéü Shared Access Signatures (SAS)** ‚Äì Temporary, scoped guest passes.

Here‚Äôs a **step-by-step** guide for each, with **portal** and **CLI** instructions, plus **real-life scenarios**.

---

## 1Ô∏è‚É£ **Azure Role-Based Access Control (RBAC)** ‚Äì _Fine-Grained Control_

RBAC lets you decide:

- **Who** can access your resource
- **What** actions they can perform
- **Where** they can do it (scope: subscription, RG, resource)

### **A. Using Azure Portal**

1. Go to [Azure Portal](https://portal.azure.com/) ‚Üí **Storage Accounts** ‚Üí Select your storage account.
2. **Access Control (IAM)** ‚Üí **Add role assignment**.
3. Pick a role (e.g., **Storage Blob Data Contributor**).
4. Assign to a **user/group/service principal**.
5. **Save**.

---

### **B. Using Azure CLI**

```bash
az login

az role assignment create \
  --assignee johndoe@example.com \
  --role "Storage Blob Data Contributor" \
  --scope "/subscriptions/<sub-id>/resourceGroups/MyRG/providers/Microsoft.Storage/storageAccounts/MyStorageAccount"
```

---

### **C. Use Case: Managed Identity for Azure App Service**

Your web app needs to read/write blobs **without storing credentials**.

**Implementation Steps:**

1. Enable **Managed Identity** on the App Service.
2. Assign **Storage Blob Data Contributor** to that identity.

**.NET Example:**

```csharp
var credential = new DefaultAzureCredential();
var blobServiceClient = new BlobServiceClient(
    new Uri("https://MyStorageAccount.blob.core.windows.net"),
    credential);

await foreach (var container in blobServiceClient.GetBlobContainersAsync())
{
    Console.WriteLine(container.Name);
}
```

**Why it‚Äôs great:** No keys to manage, no secrets leaked.

---

## 2Ô∏è‚É£ **Shared Access Signatures (SAS)** ‚Äì _Time-Limited Guest Passes_

A SAS token is like giving someone **limited-time backstage access** to specific storage resources.

### **A. Using Azure Portal**

1. In your storage account ‚Üí **Shared access signature**.
2. Configure:

   - **Allowed services**: Blob
   - **Allowed resource types**: Container, Object
   - **Permissions**: Read, Write, Delete, List
   - **Time range**: Start & expiry
   - **Protocol**: HTTPS only

3. Click **Generate SAS** ‚Üí Copy **token** or **URL**.

---

### **B. Using Azure CLI**

```bash
az storage blob generate-sas \
  --account-name MyStorageAccount \
  --container-name mycontainer \
  --name myblob.txt \
  --permissions rwdl \
  --expiry $(date -u -d "1 hour" '+%Y-%m-%dT%H:%MZ') \
  --output tsv
```

---

### **C. Use Case: Client-Side File Upload**

Let users upload files **directly** to Blob Storage from their browser.

**JavaScript Example:**

```javascript
const sasUrl = "https://MyStorageAccount.blob.core.windows.net/mycontainer/myblob.txt?<SASToken>";

async function uploadFile(file) {
  const response = await fetch(sasUrl, {
    method: "PUT",
    headers: {
      "x-ms-blob-type": "BlockBlob",
      "Content-Type": file.type,
    },
    body: file,
  });
  console.log(response.ok ? "Upload successful" : "Upload failed");
}
```

**Why it‚Äôs great:** Saves server bandwidth, limits token lifespan.

---

## 3Ô∏è‚É£ **Access Keys** ‚Äì _The Master Keys_

Access Keys = Full control over the storage account. Use sparingly.

---

### **A. Using Azure Portal**

1. Go to your storage account ‚Üí **Access keys**.
2. Copy **Key1** or **Key2**.
3. Rotate keys as needed.

---

### **B. Using Azure CLI**

```bash
# View keys
az storage account keys list \
  --resource-group MyResourceGroup \
  --account-name MyStorageAccount \
  --output table

# Regenerate Key1
az storage account keys renew \
  --resource-group MyResourceGroup \
  --account-name MyStorageAccount \
  --key key1
```

---

### **C. Use Case: Backend Services**

Services needing **full CRUD** on Blob, Queue, File, or Table storage.

**.NET Example:**

```csharp
string connectionString = "DefaultEndpointsProtocol=https;AccountName=MyStorageAccount;AccountKey=YourAccessKey;EndpointSuffix=core.windows.net";
var blobServiceClient = new BlobServiceClient(connectionString);

await foreach (var container in blobServiceClient.GetBlobContainersAsync())
{
    Console.WriteLine(container.Name);
}
```

**Security Tip:** Store in **Azure Key Vault**, rotate regularly.

---

## üìä **Quick Comparison**

| Feature      | RBAC (Roles)        | SAS (Tokens)              | Access Keys      |
| ------------ | ------------------- | ------------------------- | ---------------- |
| **Scope**    | Fine-grained        | Narrow, time-limited      | Full account     |
| **Best for** | Internal users/apps | Temporary external access | Admin/automation |
| **Security** | High                | Medium                    | Low              |
