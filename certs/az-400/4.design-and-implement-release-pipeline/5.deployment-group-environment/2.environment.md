# ðŸŒ Azure DevOps **Environments** (Hands-On)

## ðŸ“Œ 1. What is an Environment?

ðŸ‘‰ In Azure DevOps, an **Environment** is a **named collection of resources** (VMs, Kubernetes clusters, Azure Web Apps, etc.) where you **deploy applications** in YAML pipelines.

But itâ€™s **more powerful** than Deployment Groups:

- Adds **approvals** (manager sign-off before Prod deploy).
- Adds **checks** (quality gates, branch policies, work item linking).
- Supports **resource types** (VMs, K8s, Azure resources).
- Provides **auditing & traceability** (who approved, what deployed).

ðŸ’¡ Think: **Deployment Group 2.0** ðŸš€ with governance built in.

---

## ðŸ“Œ 2. Why Use Environments?

- ðŸ›¡ï¸ **Compliance & governance** â†’ approvals + checks.
- ðŸ§‘â€ðŸ’¼ **Team workflows** â†’ dev deploys to Staging, manager approves Prod.
- ðŸ”„ **Modern YAML pipelines** â†’ full CI/CD in one pipeline file.
- â˜ï¸ **Supports hybrid targets** â†’ Azure, K8s, self-hosted VMs.

---

## ðŸ“Œ 3. Real-World Example

Youâ€™re deploying an **e-commerce app**:

- **Environment: Staging** â†’ deploy to test VM, auto tests run.
- **Environment: Production** â†’ deploy to AKS cluster, requires approval by Team Lead.

ðŸ‘‰ The **same pipeline** handles both, but with **different checks**.

---

## ðŸ“Œ 4. Hands-On: Creating an Environment

### ðŸ”¹ Step 1: Create Environment

1. In **Azure DevOps â†’ Pipelines â†’ Environments**.
2. Click **New Environment**.
3. Give it a name (e.g., `Production`).
4. Add **resource type**:

   - Virtual machines
   - Kubernetes cluster
   - Azure Web App
   - None (just for approvals, no infra attached).

---

### ðŸ”¹ Step 2: Add Resources

- If **VMs**: Install the **agent** on target machines (like Deployment Groups).
- If **Kubernetes**: Connect cluster via **Service Connection**.
- If **Azure Web App**: Pick app from subscription via service connection.

---

### ðŸ”¹ Step 3: Add Approvals & Checks

- Click **Approvals & Checks** inside the environment.
- Examples:

  - Require **manual approval** before deployment.
  - Enforce **branch policy** (only `main` can deploy).
  - Require **work items linked** to commit.
  - Check for **Azure Policy compliance**.

---

## ðŸ“Œ 5. Using Environment in a YAML Pipeline

Example: Deploy a **.NET app** to a VM inside `Production` environment.

```yaml
trigger:
  - main

pool:
  vmImage: "ubuntu-latest"

stages:
  - stage: Build
    jobs:
      - job: BuildJob
        steps:
          - task: DotNetCoreCLI@2
            inputs:
              command: "build"
              projects: "**/*.csproj"

  - stage: Deploy
    jobs:
      - deployment: DeployWebApp
        environment: "Production" # âœ… Targets environment
        strategy:
          runOnce:
            deploy:
              steps:
                - task: CopyFilesOverSSH@0
                  inputs:
                    sshEndpoint: "prod-vm-ssh"
                    sourceFolder: "$(Build.SourcesDirectory)"
                    contents: "**"
                    targetFolder: "/var/www/myapp"
```

ðŸ‘‰ Here:

- **Environment = Production**.
- Pipeline deploys artifact to VM.
- If you set approval â†’ the pipeline **pauses** until approved.

---

## ðŸ“Œ 6. Environment Checks in Action

- You deploy to **Staging** â†’ auto deploy, auto test runs.
- You deploy to **Production** â†’ pipeline **pauses**:

  - Manager gets notification â†’ Approve/Reject.
  - If approved â†’ deploy continues.
  - If rejected â†’ pipeline stops.

This provides **governance and traceability** âœ….

---

## ðŸ“Š Visual Diagram

```mermaid
flowchart TD
    A[Build Stage] --> B[Staging Environment]
    B -->|Auto Tests Pass| C[Approval Gate?]
    C -->|Approved| D[Production Environment]
    C -->|Rejected| E[Stop Deployment]
```

---

## ðŸ“Œ 7. Environment vs Deployment Group

| Feature    | Deployment Group     | Environment                |
| ---------- | -------------------- | -------------------------- |
| Used In    | Classic Releases     | YAML Pipelines             |
| Targets    | VMs (on-prem, cloud) | VMs, K8s, Azure, approvals |
| Governance | None                 | Approvals + Checks         |
| Status     | Legacy               | Recommended âœ…             |

ðŸ‘‰ Exam Tip: If the question mentions **YAML + approvals + checks** â†’ Answer = **Environment**.

---

## âœ… TL;DR

- **Environment** = modern target for deployments in YAML pipelines.
- Supports **VMs, K8s, Azure resources**.
- Adds **Approvals & Checks** â†’ governance + compliance.
- Replaces **Deployment Groups**.
- Perfect for **multi-stage pipelines** (Dev â†’ QA â†’ Prod).
