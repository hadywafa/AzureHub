# ‚úçüèª Example 1: Step-by-Step Simulation: Git Internals with Real Objects

Let‚Äôs walk through a Git repo with this structure:

```ini
project/
‚îú‚îÄ‚îÄ file1.txt  ‚Üí "Hello"
‚îî‚îÄ‚îÄ dir1/
    ‚îî‚îÄ‚îÄ file2.txt ‚Üí "World"
```

---

## üîß 1. Initialize Git Repo

```bash
mkdir -p project/dir1
cd project
git init
```

This creates `.git/objects`, `.git/refs`, and other internals.

---

## üìÑ 2. Create Files and Hash Them

```bash
echo "Hello" > file1.txt
echo "World" > dir1/file2.txt
```

Hash each file manually:

```bash
git hash-object -w file1.txt
# e59ff97941044f85df5297e1c302d260b85e8b3e

git hash-object -w dir1/file2.txt
# 7d793037a0760186574b0282f2f435e7d4d3e9d4
```

Git stores these blobs in:

```bash
.git/objects/e5/9ff97941044f85df5297e1c302d260b85e8b3e
.git/objects/7d/793037a0760186574b0282f2f435e7d4d3e9d4
```

---

## üîç 3. Inspect the Blobs

```bash
git cat-file -t e59ff97941044f85df5297e1c302d260b85e8b3e  # blob
git cat-file -p e59ff97941044f85df5297e1c302d260b85e8b3e  # Hello

git cat-file -t 7d793037a0760186574b0282f2f435e7d4d3e9d4  # blob
git cat-file -p 7d793037a0760186574b0282f2f435e7d4d3e9d4  # World
```

---

## üå≥ 4. Add and Commit the Files

```bash
git add .
git commit -m "Initial snapshot"
```

Git creates:

- `Tree2` for `dir1/` ‚Üí maps `file2.txt` to Blob2
- `Tree1` for root ‚Üí maps `file1.txt` to Blob1, `dir1/` to Tree2
- `Commit1` ‚Üí points to Tree1

Inspect commit and tree:

```bash
git rev-parse HEAD
# a1b2c3d4...

git cat-file -p a1b2c3d4...  # Shows tree SHA and metadata

git cat-file -p <tree1-sha>
# 100644 blob e59ff9...file1.txt
# 040000 tree <tree2-sha> dir1/

git cat-file -p <tree2-sha>
# 100644 blob 7d7930... file2.txt
```

---

## ‚úèÔ∏è 5. Modify `file2.txt` and Commit Again

```bash
echo "World v2" > dir1/file2.txt
git add .
git commit -m "Update file2.txt"
```

Git creates:

- `Blob3` for `"World v2"` ‚Üí `c2e0b5c0e8e3f7e3f6e6e7e6e7e6e7e6e7e6e7e6` (simulated)
- `Tree3` for `dir1/` ‚Üí maps `file2.txt` to Blob3
- `Tree4` for root ‚Üí maps `file1.txt` to Blob1, `dir1/` to Tree3
- `Commit2` ‚Üí points to Tree4, parent is Commit1

Inspect:

```bash
git rev-parse HEAD
git cat-file -p <commit2-sha>
git cat-file -p <tree4-sha>
```

---

## üìÑ 6. Add `file3.txt` and Commit Again

```bash
echo "New file" > file3.txt
git add .
git commit -m "Add file3.txt"
```

Git creates:

- `Blob4` for `"New file"` ‚Üí `d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2` (simulated)
- `Tree5` for root ‚Üí maps:
  - `file1.txt` ‚Üí Blob1
  - `file3.txt` ‚Üí Blob4
  - `dir1/` ‚Üí Tree3
- `Commit3` ‚Üí points to Tree5, parent is Commit2

Inspect:

```bash
git rev-parse HEAD
git cat-file -p <commit3-sha>
git cat-file -p <tree5-sha>
```

---

## üß† Summary of Git‚Äôs Behavior

| Commit | Changed File(s) | New Objects                         | Reused Objects      |
| ------ | --------------- | ----------------------------------- | ------------------- |
| C1     | All             | Blob1, Blob2, Tree1, Tree2, Commit1 | ‚Äî                   |
| C2     | file2.txt       | Blob3, Tree3, Tree4, Commit2        | Blob1               |
| C3     | file3.txt       | Blob4, Tree5, Commit3               | Blob1, Blob3, Tree3 |
