# ğŸŒ¿ Git Branches Internals

> What is a branch? How does Git store it? Why is it so powerful?

---

## ğŸ§  1. What Is a Branch in Git?

> A **branch is just a movable pointer to a commit.** Thatâ€™s it. No magic. No mystery.

In the `.git/refs/heads/` folder (or in packed refs), each branch is a file that stores **the commit hash it points to**.

---

### ğŸ“¦ Example:

```ini
ğŸ“‚ .git/refs/heads/
    â”œâ”€â”€ main       # contains: 1a410e
    â”œâ”€â”€ feature-x  # contains: cac0ca
```

---

### ğŸ“ In Your Diagram:

- `main` points to commit `1a410e` (third commit)
- That commit points to:

  - Parent = `cac0ca` (second)
  - Parent of that = `fdf4fc` (first)

ğŸ“¸ So `main` represents a timeline of:

```ini
fdf4fc â†’ cac0ca â†’ 1a410e
             â†‘
          (main)
```

---

## ğŸ§ª 2. How Is a Branch Created?

When you run:

```bash
git branch dev
```

ğŸ’¥ Git simply creates a new pointer to the **current commit**.

```bash
.git/refs/heads/dev â†’ 1a410e
```

Nothing else changes! No checkout, no new files â€” just a new label pointing to the same commit.

---

## ğŸ”„ 3. How Do Branches Move?

When you **checkout a branch and commit**, Git updates the branch pointer to point to the new commit.

ğŸª„ Example:

```bash
git checkout dev
echo "new line" >> new.txt
git commit -am "dev work"
```

Internally:

```ini
dev (HEAD) â†’ ğŸ†• new commit
            â†‘ was: 1a410e
```

Now:

```ini
fdf4fc â†’ cac0ca â†’ 1a410e â†’ ğŸ’¥dev commit
                     â†‘
                    main
```

---

## ğŸ¯ 4. `HEAD` : Where Am I Now?

In Git, `HEAD` is a **special pointer** that tells you what branch or commit you're currently on.

```bash
.git/HEAD
# Contains: ref: refs/heads/main
```

If you're in detached mode:

```bash
.git/HEAD
# Contains: 1a410e (commit hash)
```

So:

| HEAD Mode              | Meaning                                              |
| ---------------------- | ---------------------------------------------------- |
| `ref: refs/heads/main` | You're on branch `main`                              |
| `1a410e`               | You're in **detached HEAD** mode (not on any branch) |

---

## ğŸ§¬ 5. How Git Uses Branches Under the Hood

```mermaid
graph TD
  A[Commit: fdf4fc] --> B[Commit: cac0ca]
  B --> C[Commit: 1a410e]

  C --> D[Your New Commit on dev]

  subgraph Branches
    E1(main --> 1a410e)
    E2(dev --> D)
  end

  H[HEAD] --> E2
```

- `main` stays at `1a410e`
- `dev` moves forward with the new commit
- `HEAD` tells Git which branch is active

---

## ğŸ§° 6. Real Git Files Behind the Scenes

ğŸ—‚ï¸ Youâ€™ll see:

```bash
.git/
â”œâ”€â”€ HEAD                    # current branch (ref)
â”œâ”€â”€ refs/
â”‚   â””â”€â”€ heads/
â”‚       â”œâ”€â”€ main            # contains commit hash 1a410e
â”‚       â””â”€â”€ dev             # contains commit hash of new commit
â””â”€â”€ objects/                # contains blobs, trees, commits
```

---

## ğŸª„ 7. What Happens on Checkout?

```bash
git checkout dev
```

Git will:

- Update `HEAD` to point to `refs/heads/dev`
- Load the commit `dev` points to
- Restore the tree (snapshot) from that commit into your working directory

No merge. No magic. Just moving HEAD and copying files.

---

## ğŸ§ª 8. Git Branch Commands Internally

| Command                     | What It Does Internally                                          |
| --------------------------- | ---------------------------------------------------------------- |
| `git branch <name>`         | Creates `.git/refs/heads/<name>` pointing to current commit      |
| `git checkout <branch>`     | Sets `HEAD` to point to branch ref and updates working directory |
| `git commit`                | Writes new commit and moves `HEAD` branch forward                |
| `git reset --hard <commit>` | Moves branch pointer and resets working directory                |
| `git branch -d <name>`      | Deletes the ref file under `.git/refs/heads/<name>`              |

---

## ğŸ”¥ 9. Branches vs Tags

| Branch                               | Tag                           |
| ------------------------------------ | ----------------------------- |
| **Movable pointer** to latest commit | **Fixed pointer** to a commit |
| Changes as you commit                | Never changes                 |
| Used for development                 | Used for releases/bookmarks   |
| Stored in `.git/refs/heads/`         | Stored in `.git/refs/tags/`   |

---

## âœ… Summary: Branches in Git

| Concept                 | Description                                                               |
| ----------------------- | ------------------------------------------------------------------------- |
| Branch = pointer        | A branch is just a pointer to a commit                                    |
| HEAD = current location | HEAD points to the current branch or commit                               |
| Branches move on commit | The branch youâ€™re on moves when you commit                                |
| Lightweight             | Git branches are just files with commit hashes â€” super cheap and fast     |
| Snapshots not diffs     | Branches donâ€™t store diffs â€” commits do, and they point to full snapshots |

---

## ğŸ’¡ Final Analogy

Imagine Git like a train track ğŸš‚:

- **Commits** = Train cars
- **Branches** = Colored labels stuck on a train car
- **HEAD** = Where you're currently standing
- When you **commit**, the train gets a new car, and your current branch label moves forward ğŸš€
