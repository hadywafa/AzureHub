# âœğŸ» Example 2 : The Lifecycle of a Commit (Step by Step)

Letâ€™s recreate the diagram from the bottom up ğŸ§—

---

<div align="center">
  <img src="images/git-commit.png" alt="Git Commit Lifecycle" style="width: 80%; border-radius: 10px;">
</div>

---

## âœ… First Commit (`fdf4fc`)

```ini
ğŸ“‚ Working Directory:
  test.txt = "version 1"

ğŸ§ª Command:
  git add test.txt
  git commit -m "first commit"
```

ğŸ”§ Internally:

- Git creates:

  - ğŸ§± Blob (`83baae`) for `test.txt`
  - ğŸŒ³ Tree (`d8329f`) linking `test.txt` to blob
  - ğŸ§¾ Commit (`fdf4fc`) pointing to the tree

ğŸ’¬ Summary:

> Git stores test.txt's content as a blob and builds a snapshot tree of the repo.

---

## âœ… Second Commit (`cac0ca`)

```ini
ğŸ“‚ Working Directory:
  test.txt = "version 2"   (edited)
  new.txt  = "new file"    (added)

ğŸ§ª Command:
  git add .
  git commit -m "second commit"
```

ğŸ”§ Internally:

- Git creates:

  - ğŸ§± New blob `1f7a7a` for `test.txt` ("version 2")
  - ğŸ§± New blob `fa49b0` for `new.txt`
  - ğŸŒ³ New tree `0155eb` linking:

    - `test.txt â†’ 1f7a7a`
    - `new.txt â†’ fa49b0`

  - ğŸ§¾ Commit `cac0ca` pointing to this tree, with parent = `fdf4fc`

ğŸ’¬ Summary:

> Git stores the new version of `test.txt` as a new blob, reuses nothing from previous commit.

---

## âœ… Third Commit (`1a410e`)

```ini
ğŸ“‚ Working Directory:
  mkdir bak
  cp test.txt bak/

ğŸ§ª Command:
  git add .
  git commit -m "third commit"
```

ğŸ”§ Internally:

- Git creates:

  - ğŸŒ³ A tree `3c4e9c` for the root folder:

    - `test.txt â†’ 1f7a7a` (same as before)
    - `new.txt â†’ fa49b0` (same as before)
    - `bak/` â†’ nested tree:

      - `test.txt â†’ 83baae` âœ… reused from first commit!

  - ğŸ§¾ Commit `1a410e` with:

    - parent = `cac0ca`
    - tree = `3c4e9c`

ğŸ’¬ Summary:

> Git reuses old blobs when content is identical, even if in a different folder.

---

## ğŸ§¬ Visualization of Commit Internals

```text
ğŸŸ¡ Commit 1 (fdf4fc)
 â””â”€â”€ tree: d8329f
     â””â”€â”€ test.txt â†’ blob "version 1"

ğŸŸ¡ Commit 2 (cac0ca)
 â””â”€â”€ tree: 0155eb
     â”œâ”€â”€ test.txt â†’ blob "version 2"
     â””â”€â”€ new.txt  â†’ blob "new file"

ğŸŸ¡ Commit 3 (1a410e)
 â””â”€â”€ tree: 3c4e9c
     â”œâ”€â”€ test.txt â†’ blob "version 2"
     â”œâ”€â”€ new.txt  â†’ blob "new file"
     â””â”€â”€ bak/
         â””â”€â”€ test.txt â†’ blob "version 1"
```

```mermaid
---
config:
  layout: elk
  elk:
    mergeEdges: false
    nodePlacementStrategy: LINEAR_SEGMENTS
---
graph TD
  subgraph Commit History
    A[Commit: 1a410e<br><b>Third Commit</b>] --> A1[Parent: cac0ca<br><b>Second Commit</b>]
    A1 --> A2[Parent: fdf4fc<br><b>First Commit</b>]
  end

  subgraph Trees and Objects
    A --> B[Tree: 3c4e9c<br><i>Snapshot of third commit</i>]
    B --> B1[test.txt<br><code>â†’ blob 1f7a7a</code>]
    B --> B2[new.txt<br><code>â†’ blob fa49b0</code>]
    B --> B3[bak/<br><code>â†’ tree d8329f</code>]
    B3 --> B4[test.txt<br><code>â†’ blob 83baae</code>]

    A1 --> C[Tree: 0155eb<br><i>Snapshot of second commit</i>]
    C --> C1[test.txt<br><code>â†’ blob 1f7a7a</code>]
    C --> C2[new.txt<br><code>â†’ blob fa49b0</code>]

    A2 --> D[Tree: d8329f<br><i>Snapshot of first commit</i>]
    D --> D1[test.txt<br><code>â†’ blob 83baae</code>]
  end
```
