# ğŸ—ï¸ **Azure Repos Branch Policies**

> ğŸ’¬ "How do you protect your `main`, `release`, and `feature` branches like a security guard with CI/CD powers?"  
> ğŸ‘‰ **Answer:** You use **Branch Policies** in Azure Repos.

---

## ğŸ§  What Are Branch Policies?

| Concept               | What It Means                                                              |
| --------------------- | -------------------------------------------------------------------------- |
| ğŸ”€ **Branch**         | A line of development (e.g. `main`, `feature/api`, `release/5`)            |
| ğŸ›¡ï¸ **Branch Policy**  | Rules enforced on pull requests before changes are merged into the branch  |
| ğŸ¢ **Project Policy** | Default/global rules applied to **all repos/branches** under a project/org |

---

## ğŸ“Œ Diagram Breakdown

<div align="center">
  <img src="images/azure-branch-policy.png" alt="Azure Repos Branch Policy Diagram" style="width: 100%; border-radius: 10px;border: solid">
</div>

---

### ğŸ¢ **Organization Layer**

- Your DevOps Org (like `ContosoDevOps`)
- Contains 1 or more **Projects**

---

### ğŸ“ **Project: Aus-E-Mart**

- Contains repositories (e.g., `Stores`)
- Inside `Stores`, we see 2 branches being worked on:

| Branch Type | Description                       |
| ----------- | --------------------------------- |
| `release/5` | Release branch (production track) |
| `feature`   | Feature branch (in development)   |

---

## ğŸ§© Policies You Can Apply

| Policy Type        | Description                                                            |
| ------------------ | ---------------------------------------------------------------------- |
| âœ… **Approvals**   | Require X reviewers to approve PR before merge                         |
| ğŸ§ª **Build Tests** | Enforce CI builds to pass before merge (e.g., Azure Pipelines)         |
| ğŸ”€ **Merge Types** | Allow/disallow specific merge strategies (`Squash`, `Merge`, `Rebase`) |

---

## ğŸ›¡ï¸ Example Use Case

| Branch      | Policy Example                                                                        |
| ----------- | ------------------------------------------------------------------------------------- |
| `release/*` | âœ… Require 2 reviewers<br>ğŸ§ª CI pipeline must pass<br>ğŸ”€ Only allow **merge commits** |
| `main`      | âœ… Require 1 reviewer<br>ğŸ§ª CI pass<br>ğŸ”€ Allow **semi-linear merge** only            |
| `feature/*` | No enforced policy (devs can push freely, no PR required)                             |

---

## ğŸ”§ Where to Set These?

- ğŸ”— Navigate to:
  **Azure DevOps â†’ Project Settings â†’ Repos â†’ Branches**
- Click `...` next to a branch â†’ **Branch Policies**
- Configure:

  - âœ… Required reviewers
  - ğŸ”„ Merge strategy allowed
  - ğŸ§ª Build validation (CI Pipelines)
  - ğŸš« Who can bypass policies

---

## âœ… Why It Matters

| Without Branch Policies ğŸ§¨        | With Branch Policies ğŸ”’            |
| --------------------------------- | ---------------------------------- |
| Anyone can merge anything anytime | Pull Requests enforce discipline   |
| Code can break builds             | CI must pass before merging        |
| No traceability                   | Reviews + history = traceable code |
| Hard to maintain release quality  | You gatekeep what enters `main`    |

---

## ğŸ§  TL;DR

> **Azure Repos Branch Policies** are your **PR guardians**:

- ğŸ”’ Enforce rules **before code hits protected branches**
- ğŸ’¬ Require **reviews**, ğŸ§ª **tests**, and restrict ğŸ”€ **merge methods**
- ğŸ¯ Help teams deliver safe, clean, and auditable code
