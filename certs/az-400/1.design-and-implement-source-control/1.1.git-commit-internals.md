# ğŸ§  Git Internals Explained: From Concept to Advanced

> Understand how `git commit` _really_ works under the hood, with snapshots, trees, and blobs (in your style ğŸ’¡ğŸ’¥)

---

## ğŸ“Œ 1. What is a Git Commit?

A **Git commit** is:

> ğŸ—ƒï¸ A _snapshot_ of your project at a point in time â€” not a diff.

Each commit contains:

- ğŸ”— A pointer to the **tree** (snapshot of your folder/files)
- ğŸ§‘ Author, timestamp, and commit message
- ğŸ§¬ A reference to the **parent commit** (except the first commit)

---

## ğŸ“¦ 2. Git's Building Blocks (Objects in `.git/objects`)

Git is like a content-addressable database.

| Git Object | What It Represents                      | Example                            |
| ---------- | --------------------------------------- | ---------------------------------- |
| **Blob**   | File content                            | `test.txt = "version 1"`           |
| **Tree**   | Folder structure (file list)            | `tree = {test.txt â†’ blob}`         |
| **Commit** | Full snapshot of the project + metadata | `commit = {tree, parent, message}` |

ğŸ§  All Git objects are stored using **SHA-1 hashes** as filenames.

---

## ğŸ”„ 3. The Lifecycle of a Commit (Step by Step)

Letâ€™s recreate the diagram from the bottom up ğŸ§—

---

![git-commit](images/git-commit.png)

---

### âœ… First Commit (`fdf4fc`)

```ini
ğŸ“‚ Working Directory:
  test.txt = "version 1"

ğŸ§ª Command:
  git add test.txt
  git commit -m "first commit"
```

ğŸ”§ Internally:

- Git creates:

  - ğŸ§± Blob (`83baae`) for `test.txt`
  - ğŸŒ³ Tree (`d8329f`) linking `test.txt` to blob
  - ğŸ§¾ Commit (`fdf4fc`) pointing to the tree

ğŸ’¬ Summary:

> Git stores test.txt's content as a blob and builds a snapshot tree of the repo.

---

### âœ… Second Commit (`cac0ca`)

```ini
ğŸ“‚ Working Directory:
  test.txt = "version 2"   (edited)
  new.txt  = "new file"    (added)

ğŸ§ª Command:
  git add .
  git commit -m "second commit"
```

ğŸ”§ Internally:

- Git creates:

  - ğŸ§± New blob `1f7a7a` for `test.txt` ("version 2")
  - ğŸ§± New blob `fa49b0` for `new.txt`
  - ğŸŒ³ New tree `0155eb` linking:

    - `test.txt â†’ 1f7a7a`
    - `new.txt â†’ fa49b0`

  - ğŸ§¾ Commit `cac0ca` pointing to this tree, with parent = `fdf4fc`

ğŸ’¬ Summary:

> Git stores the new version of `test.txt` as a new blob, reuses nothing from previous commit.

---

### âœ… Third Commit (`1a410e`)

```ini
ğŸ“‚ Working Directory:
  mkdir bak
  cp test.txt bak/

ğŸ§ª Command:
  git add .
  git commit -m "third commit"
```

ğŸ”§ Internally:

- Git creates:

  - ğŸŒ³ A tree `3c4e9c` for the root folder:

    - `test.txt â†’ 1f7a7a` (same as before)
    - `new.txt â†’ fa49b0` (same as before)
    - `bak/` â†’ nested tree:

      - `test.txt â†’ 83baae` âœ… reused from first commit!

  - ğŸ§¾ Commit `1a410e` with:

    - parent = `cac0ca`
    - tree = `3c4e9c`

ğŸ’¬ Summary:

> Git reuses old blobs when content is identical, even if in a different folder.

---

## ğŸ§¬ 4. Visualization of Commit Internals

```mermaid
graph TD
  A[Commit: 1a410e<br>Third Commit] --> B[Tree: 3c4e9c]
  A --> A1[Parent: cac0ca]

  B --> B1[test.txt â†’ blob 1f7a7a]
  B --> B2[new.txt â†’ blob fa49b0]
  B --> B3[bak/ â†’ tree d8329f]
  B3 --> B4[test.txt â†’ blob 83baae]

  A1 --> C[Tree: 0155eb]
  C --> C1[test.txt â†’ blob 1f7a7a]
  C --> C2[new.txt â†’ blob fa49b0]

  A1 --> A2[Parent: fdf4fc]
  A2 --> D[Tree: d8329f]
  D --> D1[test.txt â†’ blob 83baae]
```

---

## ğŸ§  5. Advanced Concepts Made Simple

| Concept                       | Easy Explanation                                                                                                                           |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| **Content-Addressed Storage** | All blobs/trees/commits are stored using SHA-1 of their content. If two files are _identical_, they get the same blob hash and are reused. |
| **Snapshot, not diff**        | Each commit is a full snapshot of the repo, not just the changed files. But unchanged files point to the same blob.                        |
| **Efficiency**                | Thanks to SHA-based deduplication, Git avoids duplicating data.                                                                            |
| **Immutable objects**         | Once a blob or tree or commit is written, it's never changed â€” only new objects are created.                                               |

---

## ğŸ” 6. What's Stored Inside Each Git Object?

### âœ… Blob: file content

```bash
git cat-file -p 83baae
# Output:
version 1
```

### âœ… Tree: directory structure

```bash
git cat-file -p d8329f
# Output:
100644 blob 83baae    test.txt
```

### âœ… Commit: snapshot + metadata

```bash
git cat-file -p fdf4fc
# Output:
tree d8329f
author You <you@example.com>
date ...

first commit
```

---

## ğŸ§ª Final Recap with Commit Chain

```text
ğŸŸ¡ Commit 1 (fdf4fc)
 â””â”€â”€ tree: d8329f
     â””â”€â”€ test.txt â†’ blob "version 1"

ğŸŸ¡ Commit 2 (cac0ca)
 â””â”€â”€ tree: 0155eb
     â”œâ”€â”€ test.txt â†’ blob "version 2"
     â””â”€â”€ new.txt  â†’ blob "new file"

ğŸŸ¡ Commit 3 (1a410e)
 â””â”€â”€ tree: 3c4e9c
     â”œâ”€â”€ test.txt â†’ blob "version 2"
     â”œâ”€â”€ new.txt  â†’ blob "new file"
     â””â”€â”€ bak/
         â””â”€â”€ test.txt â†’ blob "version 1"
```

---

## âœ… Summary Cheat Sheet

| Term         | Meaning                                                    |
| ------------ | ---------------------------------------------------------- |
| `git add`    | Creates blob (file content) and stage in index             |
| `git commit` | Creates tree and commit object                             |
| Tree         | Like a folder: list of file names and blob/tree references |
| Blob         | Stores file data                                           |
| Commit       | Points to a tree + parent commit                           |
| Reuse        | Git reuses blobs and trees if unchanged                    |
