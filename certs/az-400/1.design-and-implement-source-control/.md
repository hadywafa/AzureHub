# Git Internals

## üß± Initial Setup

```ini
project/
‚îú‚îÄ‚îÄ file1.txt  ‚Üí "Hello"
‚îî‚îÄ‚îÄ dir1/
    ‚îî‚îÄ‚îÄ file2.txt ‚Üí "World"
```

---

## üß® First Commit: Initial Snapshot

Git creates:

- `Blob1` for `"Hello"` (file1.txt)
- `Blob2` for `"World"` (file2.txt)
- `Tree2` for `dir1/` ‚Üí maps `file2.txt` to `Blob2`
- `Tree1` for root ‚Üí maps `file1.txt` to `Blob1`, `dir1/` to `Tree2`
- `Commit1` ‚Üí points to `Tree1`

<div align="center" style="background: #578198ff; border-radius: 20px">

```mermaid
---
config:
  look: handDrawn
  theme: dark # dark,neutral
title: "First Commit: Initial Snapshot"
---
flowchart TD
    C1[(**Commit1**)]
    C1 --> T1{"**Tree1** </br>(root)"}
    T1 --> B1(["**Blob1**"])
    B1 --> F1["file1.txt ‚Üí "Hello""]
    T1 --> T2{"**Tree2** </br>(dir1/)"}
    T2 --> B2([**Blob2**])
    B2 --> F2["file2.txt ‚Üí "World""]

    classDef orange color:#333,font-size:12pt,fill:#bcb350ff,stroke:#333,stroke-width:2px;
    classDef pink color:#333,font-size:12pt,fill:#f9f,stroke:#333,stroke-width:2px;
    classDef green color:#333,font-size:12pt,fill:#99ffa5ff,stroke:#333,stroke-width:2px;
    class C1 orange
    class T1,T2 pink
    class B1,B2 green

```

</div>

---

## ‚úèÔ∏è Second Commit: Update `file2.txt`

You change `file2.txt` to `"World v2"`.

Git creates:

- `Blob3` for `"World v2"`
- `Tree3` for `dir1/` ‚Üí maps `file2.txt` to `Blob3`
- `Tree4` for root ‚Üí maps `file1.txt` to **existing** `Blob1`, `dir1/` to `Tree3`
- `Commit2` ‚Üí points to `Tree4`, parent is `Commit1`

<div align="center" style="background: #578198ff; border-radius: 20px;">

```mermaid
---
config:
  look: handDrawn
  theme: dark # dark,neutral
title: "Second Commit: Initial Snapshot"
---
flowchart TD
    C1[(Commit1)]
    C2[(Commit2)]
    C2 --> T4{"Tree4 </br>(root)"}
    T4 --> B1(["Blob1"]) --> F1["file1.txt ‚Üí "Hello""]
    T4 --> T3{"Tree3 </br>(dir1/)"}
    T3 --> B3(["Blob3"]) --> F3["file2.txt ‚Üí "World v2""]
    C1 --> C2

    classDef orange color:#333,font-size:12pt,fill:#bcb350ff,stroke:#333,stroke-width:2px;
    classDef pink color:#333,font-size:12pt,fill:#f9f,stroke:#333,stroke-width:2px;
    classDef green color:#333,font-size:12pt,fill:#99ffa5ff,stroke:#333,stroke-width:2px;
    class C1,C2 orange
    class T3,T4 pink
    class B1,B3 green
```

</div>

> üß† Git reuses `Blob1` and doesn‚Äôt touch unchanged files.

---

## üìÑ Third Commit: Add `file3.txt`

You add `file3.txt` with `"New file"` at root.

Git creates:

- `Blob4` for `"New file"`
- `Tree5` for root ‚Üí maps:
  - `file1.txt` ‚Üí `Blob1`
  - `file3.txt` ‚Üí `Blob4`
  - `dir1/` ‚Üí `Tree3` (unchanged from previous commit)
- `Commit3` ‚Üí points to `Tree5`, parent is `Commit2`

<div align="center" style="background: #578198ff; border-radius: 20px;">

```mermaid
---
config:
  look: handDrawn
  theme: dark # dark,neutral
title: "Third Commit: Initial Snapshot"
---
flowchart TD
    C1[(Commit1)]
    C2[(Commit2)]
    C3[(Commit3)]
    C3 --> T5{"Tree5 </br>(root)"}
    T5 --> B1(["Blob1"]) --> F1["file1.txt ‚Üí "Hello""]
    T5 --> B4(["Blob4"]) --> F4["file3.txt ‚Üí "New file""]
    T5 --> T3{"Tree3 </br>(dir1/)"}
    T3 --> B3(["Blob3"]) --> F3["file2.txt ‚Üí "World v2""]
    C1 --> C2
    C2 --> C3

    classDef orange color:#333,font-size:12pt,fill:#bcb350ff,stroke:#333,stroke-width:2px;
    classDef pink color:#333,font-size:12pt,fill:#f9f,stroke:#333,stroke-width:2px;
    classDef green color:#333,font-size:12pt,fill:#99ffa5ff,stroke:#333,stroke-width:2px;
    class C1,C2,C3 orange
    class T3,T5 pink
    class B1,B3,B4 green
```

</div>

---

## üîç Summary of Git‚Äôs Behavior

| Commit | Changed File(s) | New Objects                         | Reused Objects      |
| ------ | --------------- | ----------------------------------- | ------------------- |
| C1     | All             | Blob1, Blob2, Tree1, Tree2, Commit1 | ‚Äî                   |
| C2     | file2.txt       | Blob3, Tree3, Tree4, Commit2        | Blob1               |
| C3     | file3.txt       | Blob4, Tree5, Commit3               | Blob1, Blob3, Tree3 |

---

## üîÅ Git‚Äôs Tree Behavior: Immutable by Design

- Git treats all objects ‚Äî blobs, trees, commits ‚Äî as **immutable**.
- When you change a file, Git creates a **new blob** for the content.
- Then it builds a **new tree** for the directory containing that file.
- If the root directory changes (e.g., new file added), Git builds a **new root tree**.
- Each commit points to a **new tree object**, even if most of it reuses previous blobs and subtrees.

---

## üß† Why Git Creates New Trees

Let‚Äôs revisit your example:

### ‚úÖ First Commit

- `file1.txt` ‚Üí Blob1
- `file2.txt` ‚Üí Blob2
- `dir1/` ‚Üí Tree2 (points to Blob2)
- Root ‚Üí Tree1 (points to Blob1 and Tree2)

### ‚úèÔ∏è Second Commit: Modify `file2.txt`

- New blob ‚Üí Blob3
- New tree ‚Üí Tree3 (for `dir1/`, now pointing to Blob3)
- New root ‚Üí Tree4 (points to Blob1 and Tree3)

Even though only one file changed, Git builds:

- A new blob for the content
- A new tree for the folder
- A new root tree for the project

---

### üß± Immutable Tree Chain

Here‚Äôs how the tree lineage evolves:

```mermaid
graph TD
    T1[Tree1: root (Commit1)] --> T2[Tree2: dir1 ‚Üí Blob2]
    T4[Tree4: root (Commit2)] --> T3[Tree3: dir1 ‚Üí Blob3]
    T4 --> B1[file1.txt ‚Üí Blob1]
    T1 --> B1
```

- `T1` and `T4` are **different root trees**, even though they both point to `file1.txt ‚Üí Blob1`.
- `T2` and `T3` are **different dir1 trees**, because `file2.txt` changed.

---

### üß† Architectural Insight

This design is why Git is:

- **Reliable**: Every commit is a full snapshot, not a diff.
- **Efficient**: Unchanged blobs and trees are reused.
- **Safe**: History is immutable ‚Äî no accidental edits.

This is why Git is blazing fast and reliable ‚Äî it builds **immutable snapshots** using **modular trees and blobs**, and reuses unchanged content across commits.

Want to simulate this with actual SHA hashes or explore how Git stores these in `.git/objects`?
