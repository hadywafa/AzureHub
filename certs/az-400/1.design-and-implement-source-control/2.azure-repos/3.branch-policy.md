# ğŸŒ³ **Azure Repos Branch Policies**

## ğŸ“– **What Are Branch Policies?**

Branch Policies in **Azure Repos Git** are **rules** you attach to branches (usually `main` or `release`) to **protect code quality and enforce governance** before code merges.

ğŸ‘‰ Think of them as **guard rails** for your teamâ€™s Git workflow.
They ensure:

- Only high-quality code reaches critical branches.
- The team follows consistent review and testing practices.
- Automated checks prevent â€œoops, I broke productionâ€ commits.

---

<div align="center">
  <img src="images/azure-branch-policy.png" alt="Azure Repos Branch Policy Diagram" style="width: 100%; border-radius: 10px;border: solid">
</div>

---

<div align="center">
  <img src="images/1757458793446.png" alt="Azure Repos Branch Policy Diagram" style="width: 100%; border-radius: 10px;border: solid">
</div>

---

## ğŸ¤” **Why Use Them?**

Without policies, anyone could just `git push` directly into `main` â†’ chaos.
With policies:

- Code must go through **Pull Requests (PRs)**.
- PRs must pass defined checks (reviews, builds, tests, etc.).
- You avoid technical debt sneaking into production.

---

## âš™ï¸ **Key Types of Branch Policies**

Letâ€™s go through **every policy** with practical examples ğŸ‘‡

---

### 1. âœ”ï¸ **Require a minimum number of reviewers**

- Enforces **peer reviews** before merge.
- Example: At least **2 reviewers** must approve the PR before it can be completed.

> **âš™ï¸ Options:**
>
> 1. **Minimum reviewers**:
>    - e.g., 2.
> 2. **Allow requestors to approve their own PR**:
>    - usually off (self-approval is cheating ğŸ¤­).
> 3. **Reset approvals when there are new changes**:
>    - ensures reviewers re-check after updates.

ğŸ‘‰ Use case: Ensure multiple eyes catch bugs before merging.

---

### 2. ğŸ§‘â€ğŸ’» **Check for linked work items**

- Requires the PR to be linked to a **work item** (bug, user story, task).
- Ensures traceability â†’ â€œWhy was this code change made?â€

ğŸ‘‰ Example: Developer fixing bug #123 must link the PR to Work Item #123.

---

### 3. ğŸ“‘ **Check for comment resolution**

- If someone leaves a **code review comment**, it must be marked **resolved** before merge.
- Prevents â€œwe ignored reviewer feedbackâ€ merges.

ğŸ‘‰ Example: A reviewer says, â€œFix null handling hereâ€ â†’ PR cannot merge until marked resolved.

---

### 4. ğŸ¤– **Build validation**

- Runs a **build pipeline (CI)** whenever a PR is created/updated.
- PR cannot merge unless the build succeeds âœ….
- Ensures code compiles, tests pass, and nothing is broken.

> âš™ï¸ **Options:**
>
> - **Path filters**: Run build only if certain files change.
> - **Manual queue**: Allow reviewers to re-run builds.

ğŸ‘‰ Example: A PR changes `*.cs` files â†’ triggers CI pipeline â†’ must pass before merge.

---

### 5. ğŸ§ª **Status checks**

- Requires PRs to pass **external services** (e.g., SonarQube, security scans).
- Azure DevOps waits for status = âœ… before allowing merge.

ğŸ‘‰ Example: Code must pass SonarQube analysis â†’ no major code smells.

---

### 6. ğŸ›¡ï¸ **Limit merge types**

- Controls **how PRs get merged**:

  - **Squash merge** â†’ combine into one commit.
  - **Rebase and fast-forward** â†’ clean history.
  - **Merge commit** â†’ preserve all commits.

ğŸ‘‰ Example: Team requires **squash merge** only â†’ keeps history clean.

---

### 7. ğŸ”’ **Automatically include code reviewers**

- Automatically adds specific people/groups as reviewers for PRs touching certain paths.

ğŸ‘‰ Example: If a PR changes `/infra/*`, auto-add **DevOps team** as reviewers.

---

### 8. â±ï¸ **Build expiration**

- Ensures the build used to validate a PR isnâ€™t too old.
- If PR is stale â†’ requires a **new build** before merge.

ğŸ‘‰ Example: Build older than 12 hours? Run fresh build.

---

### 9. ğŸ§­ **Bypass policies (admins only)**

- Project admins can bypass branch policies when needed (emergencies).
- Should be used **sparingly** âš ï¸.

---

## ğŸ”„ **Workflow with Branch Policies**

Hereâ€™s how it looks in practice:

<div align="center" style="background: #343739ff; border-radius: 20px">

```mermaid
---
config:
  look: handDrawn
  theme: dark
title: "ğŸ” Azure DevOps PR Flow: From Branch to Merge"
---

flowchart TD
    A["ğŸ§‘â€ğŸ’» Dev creates branch"]
    B["ğŸ“¤ Opens Pull Request â†’ main"]
    C("ğŸ›¡ï¸ Branch Policies Triggered")
    D{"â‰ï¸ is any Check Failed?"}
    E["ğŸ”€ PR Merged into main"]
    F["âŒ Blocked until fixed"]

    %% Branch Policy Checks
    C -->|ğŸ‘€ Reviewer approval| D
    C -->|ğŸ”§ Build validation| D
    C -->|ğŸ“Œ Work item linked| D
    C -->|ğŸ’¬ All comments resolved| D
    D -->|âœ… All Checks Passed| E
    D -->|ğŸš« Fail any check| F

    %% Flow
    A --> B
    B --> C

    %% Styling
    classDef dev color:#fff,fill:#4b8bbe,stroke:#333,stroke-width:2px,font-size:14px;
    classDef pr color:#fff,fill:#f9a825,stroke:#333,stroke-width:2px,font-size:14px;
    classDef policy color:#fff,fill:#00acc1,stroke:#333,stroke-width:2px,font-size:14px;
    classDef pass color:#fff,fill: #383f3fff,stroke:#333,stroke-width:2px,font-size:14px;
    classDef merge color:#fff,fill:#ab47bc,stroke:#333,stroke-width:2px,font-size:14px;
    classDef fail color:#fff,fill:#ef6c00,stroke:#333,stroke-width:2px,font-size:14px;

    class A dev
    class B pr
    class C policy
    class D pass
    class E merge
    class F fail
```

</div>

---

## ğŸ“‹ **Example Setup** (Best Practice for `main` branch)

- Require **2 reviewers**
- Require **linked work item**
- Require **comment resolution**
- Add **Build validation** pipeline
- Add **SonarQube status check**
- Allow only **squash merges**
- Auto-add **security team** for `/auth/*` changes

ğŸ‘‰ This ensures **quality + traceability + security**.

---

## ğŸ‘€ **Azure Repos Branch Policies vs GitHub Branch Protection**

| Feature            | Azure DevOps Branch Policies | GitHub Branch Protection            |
| ------------------ | ---------------------------- | ----------------------------------- |
| Min reviewers      | âœ…                           | âœ…                                  |
| Linked work items  | âœ… (Azure Boards)            | âŒ (no native work item link)       |
| Comment resolution | âœ…                           | âŒ                                  |
| Build validation   | âœ… (Azure Pipelines)         | âœ… (GitHub Actions required checks) |
| Status checks      | âœ…                           | âœ…                                  |
| Auto-reviewers     | âœ…                           | âœ…                                  |
| Merge strategies   | âœ…                           | Limited                             |

ğŸ‘‰ Azure DevOps gives **tighter integration** with work items and boards.

---

## âœ… **Summary**

- **Branch policies** = guardrails that enforce quality before merging.
- Cover **reviews, builds, work items, comments, and checks**.
- Configurable per-branch (commonly on `main`, `release`).
- Combined, they **prevent bad code from slipping into production**.
