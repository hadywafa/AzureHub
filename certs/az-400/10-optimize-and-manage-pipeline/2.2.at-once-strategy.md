# âš¡ Azure DevOps Deployment Strategy: `runOnce`

The **`runOnce`** strategy executes deployment **once per environment**, without parallelism or slicing. Itâ€™s ideal for:

- Single-instance deployments
- Testing environments
- Staging or production deployments where **parallel rollout isn't needed**
- Easy control flow and rollback handling

---

## ğŸ“¦ Official Definition

> The `runOnce` strategy executes the **entire deploy phase once** against the **target environment**. All deployment steps run in one shot on the environment, optionally with rollback and success conditions.

---

## ğŸ§  Core Structure

```yaml
jobs:
  - deployment: <job-name>
    environment: <env-name>
    strategy:
      runOnce:
        deploy:
          steps:
            - script: echo "Deploying..."
```

You can also add `on: failure`, `on: success`, and `on: always` to control flow.

---

## ğŸ§± Full Example â€“ Deploy Web App with RunOnce

```yaml
trigger:
  - main

variables:
  appName: "mywebapp"
  rg: "web-rg"
  location: "eastus"

jobs:
  - deployment: DeployToTest
    displayName: "ğŸš€ Deploy Web App to Test"
    environment: "test-env"
    strategy:
      runOnce:
        deploy:
          steps:
            - task: AzureCLI@2
              displayName: "Deploy App"
              inputs:
                azureSubscription: "MyAzureSub"
                scriptType: bash
                scriptLocation: inlineScript
                inlineScript: |
                  echo "Creating resource group..."
                  az group create --name $(rg) --location $(location)

                  echo "Creating Web App..."
                  az webapp create \
                    --name $(appName) \
                    --plan myAppServicePlan \
                    --resource-group $(rg) \
                    --runtime "DOTNETCORE|6.0"
```

---

## ğŸ’¡ You Can Add Lifecycle Conditions

```yaml
strategy:
  runOnce:
    deploy:
      steps:
        - script: echo "ğŸš€ Deploying"
      on:
        failure:
          steps:
            - script: echo "âŒ Something went wrong. Rollback logic here."
        success:
          steps:
            - script: echo "âœ… All good!"
```

---

## ğŸ“Œ Summary

| Feature                 | Supported in `runOnce`                    |
| ----------------------- | ----------------------------------------- |
| Sliced/Parallel Targets | âŒ No (use `rolling` or `canary`)         |
| Pre/Post Phases         | âŒ Only deploy steps supported            |
| Rollback Support        | âœ… via `on.failure`                       |
| Success Logic           | âœ… via `on.success`                       |
| Use with Approvals      | âœ… via environment-based approvals        |
| Simple Usage            | âœ… Best for staging/dev/test environments |

---

## ğŸ”§ When to Use `runOnce`

âœ… Single deployment target
âœ… Test/Dev environments
âœ… Simpler CD pipelines
âœ… Full control of logic with `on.failure`, `on.success`

âŒ Not suitable for parallel, staged, or partial rollouts

---

## ğŸ§© Real-World Use Case

If you're deploying to:

- A single Web App
- A test Kubernetes namespace
- A single VM or Azure Function

...then `runOnce` is perfect. It reduces complexity and keeps your YAML clean.
