# ğŸ“¦ **Variable Groups in Azure DevOps**

## ğŸ“Œ **What is a Variable Group?**

A **Variable Group (VG)** = a **shared bucket of variables** in Azure DevOps.

- Centralized store for environment settings, secrets, connection strings, etc.
- Can be **linked to multiple pipelines** (YAML or Classic).
- Optional integration with **Azure Key Vault** to pull secrets automatically.

ğŸ‘‰ Think of it like a **shared `.env` file** for your pipelines.

---

## ğŸ“Œ **Why Do We Need It?**

Without Variable Groups:

- Each pipeline defines its own vars â†’ duplication.
- If a secret changes (e.g., DB password) â†’ update in 10+ pipelines manually. âŒ

With Variable Groups:

- Update once â†’ all pipelines using it get updated. âœ…
- Separation of config from pipeline logic.
- Better governance (secure access control on variables).

---

## ğŸ“Œ **Where They Live**

- Azure DevOps â†’ **Pipelines â†’ Library â†’ Variable groups**.
- Each group has:

  - Name (`vg-prod-settings`)
  - Variables (key-value pairs)
  - Secret flags ğŸ”’ (mask values in logs)
  - Optional **link to Azure Key Vault**

---

## ğŸ“Œ **Types of Variable Groups**

### ğŸ”¹ **Unlinked Variable Group**

- Values stored directly in DevOps.
- Example:

```yaml
vg-prod-settings:
  SQL_SERVER: sql-prod.contoso.com
  DB_NAME: SalesDB
  API_KEY: (secret)
```

---

### ğŸ”¹ **Linked Variable Group (to Azure Key Vault)**

- Values **not stored in DevOps**.
- Instead, pulled dynamically from **Azure Key Vault** at runtime.
- Example:

```yaml
vg-prod-akv:
  SQL_PASSWORD: (from Key Vault secret)
  STORAGE_KEY: (from Key Vault secret)
```

ğŸ‘‰ If secret is rotated in Key Vault â†’ pipeline picks new value automatically.

---

## ğŸ“Œ **How to Use in YAML Pipelines**

### Step 1: Define a Variable Group

In portal â†’ Pipelines â†’ Library â†’ New variable group

- Name: `vg-prod`
- Vars:

  - `sqlServer = sql-prod.contoso.com`
  - `dbName = SalesDB`
  - `dbPassword = (secret)`

### Step 2: Reference in YAML

```yaml
trigger:
  - main

variables:
  - group: vg-prod # Attach variable group

pool:
  vmImage: ubuntu-latest

steps:
  - script: |
      echo "Connecting to $(sqlServer) / $(dbName)"
      # secret variable like $(dbPassword) will be masked in logs
```

---

## ğŸ“Œ **Access Control**

- You can restrict which pipelines can use a VG.
- Example: `vg-prod` only usable by Prod pipelines.
- Developers might have access to **staging VGs**, but not prod ones.

---

## ğŸ“Œ **Diagram**

<div align="center">

```mermaid
flowchart TD
    subgraph VG["Variable Group"]
        V1["sqlServer = sql-prod"]
        V2["dbName = SalesDB"]
        V3["dbPassword = *****"]
    end

    Pipeline1["Pipeline A (CI)"] --> VG
    Pipeline2["Pipeline B (CD)"] --> VG

    subgraph AKV["Azure Key Vault (Optional)"]
        S1["Secret: sqlPassword"]
        S2["Secret: storageKey"]
    end

    VG -->|Linked Mode| AKV
```

</div>

---

## ğŸ“Œ **Example Use Cases**

1. **Multi-pipeline shared config**

   - One `vg-shared-dev` with dev DB connection string â†’ used by 3 microservices pipelines.

2. **Secrets management**

   - Link `vg-prod-akv` to Key Vault with DB password, storage keys.

3. **Environment separation**

   - `vg-dev`, `vg-test`, `vg-prod` â†’ each holds environment-specific values.

---

## ğŸ“Œ **Best Practices**

- ğŸ” Use **linked AKV variable groups** for secrets.
- âœ… Use **naming conventions** (`vg-dev`, `vg-prod`) for clarity.
- ğŸ§‘â€ğŸ¤â€ğŸ§‘ Control access â†’ donâ€™t let devs use `vg-prod`.
- ğŸ“Œ Reference groups in YAML, not inline hardcoded values.
- âš¡ Rotate secrets in Key Vault â†’ pipelines automatically updated.

---

## ğŸ **TL;DR**

- **Variable Group = shared set of pipeline variables** (like `.env` in Git).
- **Two types**:

  - Unlinked (stored in DevOps)
  - Linked (to Azure Key Vault)

- Used in YAML via:

  ```yaml
  variables:
    - group: vg-name
  ```

- Helps centralize config, manage secrets securely, and reduce duplication.
