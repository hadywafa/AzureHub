# ‚ö° **Azure Functions Hosting Options**

## üõë **Problem: Why Hosting Plans Matter**

When you deploy an **Azure Function App**, you need to pick a **hosting plan**.
This choice decides:

- **How your app scales** (auto vs. fixed).
- **What resources you get** (CPU, memory).
- **How much you pay** (per execution vs. reserved instances).
- **Which advanced features** you can enable (VNet, longer execution, etc.).

If you pick the wrong one ‚Üí your app might be **too slow**, **too costly**, or **lacking key features**.

---

## ‚úÖ **Solution: Hosting Plan Options**

Azure Functions offers multiple plans. Let‚Äôs explore them one by one.

---

<div align="center">
  <img src="image/2.hosting-options/1758359745595.png" alt="Azure Functions Overview" style="border-radius: 10px; width: 100%; border: 2px solid white;">
</div>

<div align="center">
  <img src="image/2.hosting-options/1758304664547.png" alt="Azure Functions Overview" style="border-radius: 10px; width: 100%; border: 2px solid white;">
</div>

---

### 1Ô∏è‚É£ **Consumption Plan (Pay-per-Use)**

üí° **Best for:** Cost efficiency + unpredictable traffic

- Auto-scales based on demand.
- **Billed only for execution time + memory used**.
- Handles **bursty workloads** with no upfront costs.
- Execution timeout: **5 minutes by default, up to 10 mins** (can increase with Premium).

üìå **Example**

- A function that resizes images whenever a blob is uploaded.
- Runs 20 seconds ‚Üí you only pay for 20 seconds.

üëâ **Downside:** **Cold start delay** ‚è≥ (first request may be slow).

---

### 2Ô∏è‚É£ **Premium Plan (Always Warm)**

üí° **Best for:** **Low-latency** apps + enterprise features

- Fixes the **cold start issue** ‚Üí pre-warmed instances.
- Longer execution ‚Üí up to **60 minutes per function**.
- Advanced features:

  - **VNet integration**
  - **Dedicated hardware** options
  - **Scaling beyond 200 instances**

- Billed for **pre-warmed instances + execution time**.

üìå **Example**

- A financial API that must respond **instantly**, even if idle.
- Needs to call private databases in a VNet.

üëâ **Downside:** More expensive üí∞ than Consumption.

---

### 3Ô∏è‚É£ **App Service Plan (Dedicated Hosting)**

üí° **Best for:** Reusing existing App Service capacity

- Runs Functions on the same **dedicated VM pool** as your web apps.
- Good if you already have **underutilized App Service resources**.
- Can run **continuously** without execution limits.
- Useful for **long-running jobs**.

üìå **Example**

- You already run an **App Service Plan (S1)** hosting a website.
- Deploy a **Function App** in the same plan ‚Üí no extra cost.

üëâ **Downside:** No pay-per-use ‚Üí you pay for the VM whether functions run or not.

---

### 4Ô∏è‚É£ **App Service Environment (ASE ‚Äì Single Tenant)**

üí° **Best for:** **Compliance + isolation**

- Fully **isolated, single-tenant environment**.
- Runs inside your **own VNet**.
- Enterprise-grade security:

  - Internal load balancer
  - Compliance standards (e.g., PCI, HIPAA, GDPR)

- Expensive, but powerful.

üìå **Example**

- A healthcare provider app that processes patient data.
- Needs **regulatory compliance + private networking**.

üëâ **Downside:** High cost üí∏.

---

### 5Ô∏è‚É£ **Kubernetes (Custom Hosting)**

üí° **Best for:** Hybrid + multi-cloud scenarios

- Run Functions in **AKS (Azure Kubernetes Service)** or any **K8s cluster**.
- Full control: scaling, networking, hybrid setups.
- Use **KEDA (Kubernetes Event-driven Autoscaling)** to scale Functions on events.

üìå **Example**

- A global enterprise runs workloads across **Azure + on-prem + AWS**.
- Deploy the same Functions consistently in all environments.

üëâ **Downside:** You manage **Kubernetes complexity**.

---

## üñº Visual: Hosting Options

```mermaid
flowchart LR
    A[‚ö° Function App] --> B1[Consumption Plan - Pay per Execution]
    A --> B2[Premium Plan - Always Warm + VNet]
    A --> B3[App Service Plan - Dedicated VM]
    A --> B4[App Service Environment - Isolated]
    A --> B5[Kubernetes - Custom Control]
```

---

## üìä **Comparison Table**

| Plan                 | Cost Model        | Scaling            | Cold Start | Max Execution | Best For                     |
| -------------------- | ----------------- | ------------------ | ---------- | ------------- | ---------------------------- |
| **Consumption**      | Pay-per-execution | Auto, event-driven | Yes ‚ùÑÔ∏è     | 5‚Äì10 min      | Bursty, low-traffic apps     |
| **Premium**          | Pay + pre-warm    | Auto + VNet        | No üöÄ      | 60 min        | Low-latency, enterprise apps |
| **App Service Plan** | Fixed VM cost     | Manual scaling     | No üöÄ      | Unlimited     | Reuse existing capacity      |
| **App Service Env.** | High fixed cost   | Dedicated + VNet   | No üöÄ      | Unlimited     | Compliance, isolation        |
| **Kubernetes**       | Custom infra      | KEDA-driven        | Depends    | Custom        | Hybrid, multi-cloud control  |

---

## üéØ **Decision Guide**

- Pick **Consumption** if you want **cheapest, burst-friendly serverless**.
- Pick **Premium** if you need **instant response, VNet, long runs**.
- Pick **App Service Plan** if you already have App Service capacity.
- Pick **ASE** if you need **compliance, isolation, private hosting**.
- Pick **Kubernetes** if you want **hybrid/multi-cloud flexibility**.

---

## üèÉ Azure Functions Runtimes

### üíª The Core Runtime Versions

Azure Functions itself has a **host runtime** (v1, v2, v3, v4).

- **v1** (2016, .NET Framework 4.7) ‚Üí legacy, Windows-only, **deprecated**.
- **v2/v3** (.NET Core-based, cross-platform) ‚Üí also legacy, superseded.
- **v4** (current, GA) ‚Üí supports **.NET 6/7/8, Python 3.9‚Äì3.11, Node.js 18+, Java 11/17/21, PowerShell 7.2/7.4**.
- **v5** (in preview, 2025) ‚Üí built on **.NET Aspire/isolated improvements**.

üëâ Today, almost every new Function App is created with **Functions v4** runtime.

---

### ‚öôÔ∏è Supported Language Runtimes (as of 2025)

Here are the **stacks you can pick** when creating a Function App:

| **Language**             | **Versions Supported**                                                             | **Notes**                                                                                                             |
| ------------------------ | ---------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| **.NET**                 | .NET 6 (LTS), .NET 8 (LTS), .NET 7 (STS), .NET Framework 4.8 (Windows-only legacy) | Two models: **in-process** (tight binding with Functions host) and **isolated worker** (recommended, cross-platform). |
| **JavaScript / Node.js** | Node.js 18, Node.js 20                                                             | Uses function.json for bindings. Perfect for quick APIs or event-driven apps.                                         |
| **Python**               | 3.9, 3.10, 3.11                                                                    | Supports v1 (JSON model) and v2 (Python programming model) SDKs.                                                      |
| **Java**                 | Java 11, Java 17, Java 21                                                          | Uses Maven/Gradle. Annotations (`@FunctionName`, `@HttpTrigger`) define bindings.                                     |
| **PowerShell**           | 7.2 (LTS), 7.4                                                                     | Great for scripting/automation in IT/DevOps scenarios.                                                                |
| **Custom Handler**       | Any language via HTTP stdin/stdout                                                 | Write in **Go, Rust, PHP, etc.** ‚Äî you provide a ‚Äúcustom handler‚Äù binary that speaks JSON to the Functions host.      |

---

### üè∑Ô∏è Available `--runtime` Options

When you create a Function App with `az functionapp create`, these are valid:

| Runtime option        | Notes                                                                                                                      |
| --------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| `dotnet`              | Classic in-process model. Limited to **.NET 6 LTS**.                                                                       |
| `dotnet-isolated`     | Isolated worker model. Supports **.NET 7, .NET 8 (LTS)**. Recommended for new projects.                                    |
| `node`                | Node.js stack. You specify `--runtime-version 18` or `20`.                                                                 |
| `python`              | Python stack. Use `--runtime-version 3.9`, `3.10`, `3.11`.                                                                 |
| `java`                | Java worker. Specify `--runtime-version 11`, `17`, or `21`.                                                                |
| `powershell`          | PowerShell stack. Specify `--runtime-version 7.2` or `7.4`.                                                                |
| `custom` (via Docker) | Not passed as `--runtime`, but if you deploy a containerized app, you control the base image (can be Go, Rust, PHP, etc.). |

---

### ‚úçüèª Example CLI usage

#### .NET in-process (Functions v4 + .NET 6)

```bash
az functionapp create \
  -g myrg -n func-inprocess-demo \
  --storage-account mystg \
  --consumption-plan-location westeurope \
  --functions-version 4 \
  --runtime dotnet \
  --runtime-version 6
```

#### .NET isolated worker (Functions v4 + .NET 8)

```bash
az functionapp create \
  -g myrg -n func-isolated-demo \
  --storage-account mystg \
  --consumption-plan-location westeurope \
  --functions-version 4 \
  --runtime dotnet-isolated \
  --runtime-version 8
```

#### Python 3.11

```bash
az functionapp create \
  -g myrg -n func-python-demo \
  --storage-account mystg \
  --consumption-plan-location westeurope \
  --functions-version 4 \
  --runtime python \
  --runtime-version 3.11
```

---

### ‚úÖ Which Should You Pick?

- If you‚Äôre starting **fresh today** ‚Üí choose **`dotnet-isolated`** with **.NET 8**.
- If you must support **legacy .NET 6 projects** ‚Üí use **`dotnet`** (in-process).
- If you‚Äôre polyglot: pick `python`, `node`, `java`, `powershell`.
- If your language isn‚Äôt officially supported ‚Üí use a **custom handler** or **container image**.
