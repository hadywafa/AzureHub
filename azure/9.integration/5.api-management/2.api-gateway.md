# ğŸšª **API Gateway in Azure API Management**

## ğŸ“– **What is an API Gateway?**

An **API Gateway** is a **reverse proxy** that sits between **API clients (consumers)** and **backend services (providers)**.
Itâ€™s the **entry point for all traffic**, ensuring that **every request** goes through a **centralized policy and security layer** before touching your backend.

**Think of it as:**

- ğŸ”’ **Firewall for APIs** â†’ blocks bad traffic, enforces auth
- ğŸ•¹ï¸ **Traffic controller** â†’ routes to correct backend or multiple services
- ğŸ”„ **Protocol translator** â†’ makes APIs consumer-friendly (e.g., REST â†’ gRPC, SOAP â†’ REST, GraphQL â†’ REST)
- ğŸ“Š **Metrics collector** â†’ logs and monitors every API call

---

<div align="center" style="background-color: #ffffffff ;border-radius: 10px;border: 2px solid white">
  <img src="image/2.api-gateway/1758735885055.png" alt="Azure API Management" style="border-radius: 10px; width: 60%; border: 2px solid white;">
</div>

---

## âš¡ **Why do we need it?**

**ğŸ”¹ Without an API gateway:**

- Clients must **talk directly** to each microservice/backend.
- Each service must implement **its own auth, rate limiting, logging, SSL termination**.
- Client code becomes **tightly coupled** â†’ fragile when backends change.
- Security is inconsistent (one service may validate tokens differently than another).

> ğŸ‘‰ Result: A **fragile, unscalable, and insecure system**.

**ğŸ”¹ With a gateway:**

- **One entry point** to manage all cross-cutting concerns.
- **Backends stay simple** â†’ only focus on business logic.
- **Consumers get consistency** â†’ one auth model, one documentation set.

---

## ğŸ—ï¸ **API Gateway Core Functions**

1. **Routing**

   - Routes requests to the correct backend service (e.g., `/employee â†’ HR API`, `/flights â†’ Flight API`).
   - Supports **path-based, host-based, or header-based routing**.

2. **Authentication & Authorization**

   - Validate **OAuth2/JWT tokens**.
   - Enforce **subscription keys** (unique API keys per consumer).
   - Integrate with **Entra ID, GitHub, Google, Facebook** for federated auth.

3. **Rate Limiting & Quotas**

   - Prevent abuse by limiting requests per time window.
   - Example: `100 requests/min per IP`.

4. **Caching**

   - Cache frequent responses at the gateway â†’ reduces backend load.

5. **Transformation**

   - Modify requests/responses (headers, query params, or body).
   - Example: backend returns XML â†’ transform to JSON for clients.

6. **SSL Termination**

   - Gateway handles TLS/SSL â†’ backend can use plain HTTP internally.

7. **Analytics & Monitoring**

   - Captures request logs, response times, error rates.
   - Integrates with **Log Analytics, Application Insights, Defender for APIs**.

---

## ğŸ§© **Common API Gateway Design Patterns**

<div align="center" style="background-color: #ffffffff ;border-radius: 10px;border: 2px solid white">
  <img src="image/2.api-gateway/1758737421271.png" alt="Azure API Management" style="border-radius: 10px; width: 60%; border: 2px solid white;">
</div>

### 1ï¸âƒ£ **Gateway Routing** (Reverse Proxy)

- Each request is routed to one backend.
- Example: `/api/employees` â†’ Employee API, `/api/flights` â†’ Flight API.

### 2ï¸âƒ£ **Gateway Aggregation** (Backend-for-Frontend, BFF)

- Gateway **aggregates data from multiple services** into one response.
- Example: `/dashboard` â†’ fetches data from Employee API + Flight API, merges JSON â†’ sends single response.

### 3ï¸âƒ£ **Gateway Offloading**

- Gateway centralizes cross-cutting concerns:

  - **Auth** â†’ token validation at gateway, not in every service.
  - **SSL** â†’ handled once at gateway.
  - **Logging/Monitoring** â†’ done in one place.

This makes microservices **lighter, faster, and easier to maintain**.

---

## ğŸ›ï¸ **API Gateway in Azure APIM**

In **Azure API Management**, the **Gateway** is deployed as part of the APIM instance.

- **Managed gateway** â†’ Always included with APIM (cloud-hosted, public endpoint).
- **Self-hosted gateway** â†’ You can run the APIM gateway inside **AKS, ACA, VM, on-prem** â†’ useful for hybrid and private deployments.

ğŸ“Œ **Key Azure features:**

- **Policies**: XML-based rules for traffic management.
- **Integrations**: Connect to Azure Functions, Logic Apps, App Service, AKS/ACA, VMs, or even AWS/GCP services.
- **VNet integration**: Deploy gateway in **internal mode** (no public endpoint, only private IP).

---

## âœğŸ» **Example** â€“ API Gateway in Action

**Imagine we publish two APIs in APIM:**

- `Employee API` (App Service backend)
- `Flight Logs API` (App Service backend)

### ğŸ”¹ Routing

```yaml
Client â†’ https://mycompany-apim.azure-api.net/employee â†’ Employee App Service
Client â†’ https://mycompany-apim.azure-api.net/flights â†’ Flight Logs App Service
```

### ğŸ”¹ Security (JWT validation + rate limit policy)

```xml
<inbound>
  <validate-jwt header-name="Authorization" require-scheme="Bearer">
    <openid-config url="https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration" />
  </validate-jwt>
  <rate-limit-by-key calls="50" renewal-period="60" counter-key="@(context.Request.IpAddress)" />
  <base />
</inbound>
```

### ğŸ”¹ Transformation (XML â†’ JSON)

```xml
<outbound>
  <set-header name="Content-Type" exists-action="override">
    <value>application/json</value>
  </set-header>
  <xml-to-json apply="always" consider-accept-header="false" />
</outbound>
```

---

## ğŸ” Diagram â€“ API Gateway Role in APIM

```mermaid
flowchart LR
    subgraph Clients
        A[Mobile App]
        B[Web App]
    end

    subgraph APIM[Azure API Management]
        G[API Gateway]
        P[(Policies: Auth, Rate Limit, Transform)]
    end

    subgraph Backends
        E[Employee API]
        F[Flight Logs API]
    end

    Clients -->|REST/GraphQL/gRPC| G
    G --> E
    G --> F
```

---

## âš–ï¸ Summary

- The **API Gateway** is the **traffic cop** for your APIs.
- In **APIM**, it ensures all calls go through a **single policy & security layer**.
- Provides **routing, auth, rate-limiting, caching, SSL offloading, analytics, and transformations**.
- Supports both **Azure-managed** and **self-hosted** gateways.
- Without it, you end up with **spaghetti client-to-service calls** that are hard to scale or secure.
