# ğŸ“‘ Azure Event Grid â€“ **Event Schema**

## ğŸ“Œ **What Is the Event Schema?**

- The **event schema** defines the **shape (JSON format)** of the event that Event Grid delivers.
- Think of it as the **envelope**: who sent it, what happened, when, and details.
- Two main formats:

  1. **Event Grid Schema (default)** â€“ Azureâ€™s native schema.
  2. **CloudEvents Schema** â€“ CloudEvents is a **CNCF standard** for event formats (used across clouds).

---

## 1ï¸âƒ£ **Event Grid Schema** (Default)

### ğŸ› ï¸ Field Breakdown

| Field               | Description                                      | Example                                        |
| ------------------- | ------------------------------------------------ | ---------------------------------------------- |
| **id**              | Unique event identifier (used for deduplication) | `9e91dcd0-1234-4c93`                           |
| **topic**           | Resource path of the event source                | `/subscriptions/.../storageAccounts/mystorage` |
| **subject**         | Subject/resource that triggered event            | `/blobServices/.../photo1.jpg`                 |
| **eventType**       | What happened                                    | `Microsoft.Storage.BlobCreated`                |
| **eventTime**       | When it happened (UTC)                           | `2025-09-25T09:30:00Z`                         |
| **data**            | Event payload, source-specific                   | Blob details (URL, type, etc.)                 |
| **dataVersion**     | Version of data schema                           | `2`                                            |
| **metadataVersion** | Event Grid schema version                        | `1`                                            |

---

### âœğŸ» Example

Hereâ€™s a **typical Event Grid event**:

```json
[
  {
    "id": "9e91dcd0-1234-4c93-b000-5c7aaf123456",
    "topic": "/subscriptions/xxxx/resourceGroups/myRG/providers/Microsoft.Storage/storageAccounts/mystorage",
    "subject": "/blobServices/default/containers/images/blobs/photo1.jpg",
    "eventType": "Microsoft.Storage.BlobCreated",
    "eventTime": "2025-09-25T09:30:00.1234567Z",
    "data": {
      "api": "PutBlob",
      "clientRequestId": "e123-4567",
      "requestId": "abcd-efgh",
      "contentType": "image/jpeg",
      "blobType": "BlockBlob",
      "url": "https://mystorage.blob.core.windows.net/images/photo1.jpg",
      "sequencer": "00000000000000000000000000000123456789"
    },
    "dataVersion": "2",
    "metadataVersion": "1"
  }
]
```

---

## 2ï¸âƒ£ **CloudEvents Schema** (Standard Option)

Event Grid supports delivering events in this format too.

### ğŸ› ï¸ Field Breakdown

| Field               | Description             | Example                                        |
| ------------------- | ----------------------- | ---------------------------------------------- |
| **id**              | Unique ID               | `a1234-b567`                                   |
| **source**          | Event source            | `/subscriptions/.../storageAccounts/mystorage` |
| **subject**         | Subject (resource path) | `/blobServices/.../photo1.jpg`                 |
| **type**            | Event type              | `Microsoft.Storage.BlobCreated`                |
| **time**            | Event time (UTC)        | `2025-09-25T09:30:00Z`                         |
| **data**            | Actual event payload    | Blob details                                   |
| **datacontenttype** | Type of data payload    | `application/json`                             |
| **specversion**     | CloudEvents version     | `1.0`                                          |

---

### âœğŸ» Example

```json
{
  "specversion": "1.0",
  "type": "Microsoft.Storage.BlobCreated",
  "source": "/subscriptions/xxxx/resourceGroups/myRG/providers/Microsoft.Storage/storageAccounts/mystorage",
  "id": "a1234-b567-c890",
  "time": "2025-09-25T09:30:00Z",
  "subject": "/blobServices/default/containers/images/blobs/photo1.jpg",
  "datacontenttype": "application/json",
  "data": {
    "api": "PutBlob",
    "url": "https://mystorage.blob.core.windows.net/images/photo1.jpg",
    "contentType": "image/jpeg"
  }
}
```

---

## ğŸ“Š **Event Grid vs CloudEvents Schema**

| Feature           | Event Grid Schema                      | CloudEvents Schema                  |
| ----------------- | -------------------------------------- | ----------------------------------- |
| Default format    | âœ… Yes                                 | âŒ No (opt-in)                      |
| Industry standard | âŒ No (Azure-only)                     | âœ… Yes (CNCF)                       |
| Field names       | Azure-style (`eventType`, `eventTime`) | Standardized (`type`, `time`)       |
| Usage             | Best for Azure-native apps             | Best for cross-cloud, polyglot apps |

> ğŸ‘‰ If youâ€™re integrating **only with Azure services**, stick to **Event Grid Schema**.  
> ğŸ‘‰ If you need **multi-cloud or CNCF portability**, go with **CloudEvents**.

---

## ğŸ–¼ï¸ **Event Lifecycle**

<div align="center" style="background-color: #1c2529ff ;border-radius: 10px;border: 2px solid white">

```mermaid
sequenceDiagram
    participant S as Source (Blob Storage)
    participant EG as Event Grid
    participant Sub as Subscription Filter
    participant H as Handler (Function/Webhook)

    S->>EG: Publishes Event (BlobCreated)
    EG->>Sub: Matches Filters (.jpg files)
    Sub->>H: Push Event JSON (Schema)
    H->>EG: Responds 200 OK (ack)
```

</div>

---

## ğŸ¯ Key Takeaways

- Event Grid uses **two schemas**:

  - **Event Grid Schema (default)** â€“ Azure-native, simple.
  - **CloudEvents Schema** â€“ Standardized for cross-cloud.

- Both are **JSON-based**, carry metadata + payload.
- Fields: `id`, `eventType`, `subject`, `time`, `data`.
- **AWS analogy**: Event Grid event â‰ˆ **SNS message / EventBridge event**.

---

## ğŸ“¦ AWS Comparison

| Azure Event Grid | AWS Equivalent                        |
| ---------------- | ------------------------------------- |
| `id`             | `MessageId` (SNS)                     |
| `eventType`      | `Event` / `detail-type` (EventBridge) |
| `subject`        | `detail` or `resource` (EventBridge)  |
| `data`           | `detail` (EventBridge JSON)           |
| `eventTime`      | `time` (EventBridge)                  |

ğŸ‘‰ Basically: **Event Grid Schema â‰ˆ EventBridge JSON format**, just different field names.
