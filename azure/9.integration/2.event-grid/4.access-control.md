# üîê **Controlling Access to Events in Azure Event Grid**

Event Grid is powerful ‚Äî but without **proper access control**, anyone could create subscriptions, read events, or even inject fake events. To prevent this, Azure uses **Role-Based Access Control (RBAC)** with **Event Grid‚Äìspecific roles**.

---

## üìå **Built-in Roles for Event Grid**

Azure has pre-defined RBAC roles tailored for Event Grid.

| Role                                    | Permissions                                                            | Use Case                                                         |
| --------------------------------------- | ---------------------------------------------------------------------- | ---------------------------------------------------------------- |
| **Event Grid Contributor**              | üîë Full control over **topics and subscriptions** (system + custom).   | Admin role for Event Grid.                                       |
| **Event Grid Data Sender**              | üöÄ Only permission is to **send events to a custom topic**.            | Applications publishing events, but not allowed to manage infra. |
| **Event Grid Subscription Reader**      | üîç Read-only access to **event subscriptions** (can view, not change). | Monitoring, auditing, operations team.                           |
| **Event Grid Subscription Contributor** | ‚ûï Create, ‚úèÔ∏è modify, ‚ùå delete event subscriptions.                   | Developers or ops managing subscriptions lifecycle.              |

üëâ **AWS analogy**:

- Data Sender ‚âà `SNS:Publish` permission.
- Contributor ‚âà `SNS:FullAccess`.
- Subscription Reader ‚âà read-only CloudWatch access on subscriptions.

---

## üìå **Permissions for Event Subscriptions**

Event subscriptions deliver events to different destinations (webhooks, storage, Event Hubs, Service Bus, etc.).

- **Webhook handler** ‚Üí only Event Grid and the webhook endpoint need mutual trust.
- **Non-Webhook handlers** (e.g., Queue Storage, Event Hubs, Service Bus):

  - Event Grid must have **write access** to that resource.
  - Otherwise, anyone with Event Grid access could try to push events to your storage/queue.

üëâ Example:

- Delivering events to **Azure Queue Storage** requires:

  - Either **Storage access keys**, or
  - **Managed Identity + RBAC**.

‚ö†Ô∏è **Warning**: If you don‚Äôt secure Queue Storage, **unauthorized users could write arbitrary events**. Always lock down access.

---

## üìå **Managing Topics and Subscriptions**

### **System Topics**

- Auto-created when you use Azure services (e.g., Blob Storage, Key Vault).
- To manage them, you need **write permissions** on the **publishing resource**.

  - Example: To subscribe to Storage events ‚Üí need **Storage Account write access**.

### **Custom Topics**

- Created manually.
- To create/manage event subscriptions: need **write access** at the scope of the Event Grid **topic**.

üëâ **AWS analogy**:

- Creating a subscription to an SNS topic requires `sns:Subscribe`.
- Publishing to EventBridge requires `events:PutEvents`.

---

## üìå **Receiving Events Using Webhooks**

- Webhooks are common subscribers for Event Grid events.
- **Security best practices**:

  1. **Secure your endpoint** (HTTPS only).
  2. **Validate events** (Event Grid sends a handshake validation event).
  3. Use **authentication headers** or **Azure AD app registration** for extra protection.

üëâ This prevents attackers from spoofing events or overwhelming your subscriber.

---

## üìä **Access Control Overview**

```mermaid
flowchart LR
    A[Publisher App üöÄ] -->|Event Grid Data Sender| B[Custom Topic]
    B -->|Event Grid Contributor| C[Manage Subscriptions]
    C -->|Event Grid Subscription Contributor| D[Function/Webhook]
    D -->|Secured w/ HTTPS + Token| E[Process Events]
```

---

## ‚úÖ **Best Practices Summary**

- Use **least privilege**:

  - Publishers ‚Üí only need **Event Grid Data Sender**.
  - Operators ‚Üí only need **Subscription Reader**.
  - Admins ‚Üí only Event Grid Contributor.

- Always **secure non-webhook destinations** (Queue, Event Hubs) with RBAC or keys.
- Protect webhook endpoints with **authentication + event validation**.
- Require **write permissions** at the right scope for managing subscriptions (System vs Custom Topics).

## ‚ÅâÔ∏è **Questions**

<div align="center" style="background-color: #ffffffff ;border-radius: 10px;border: 2px solid white">
  <img src="image/4.access-control/1758828765881.png" alt="Azure Event Grid" style="border-radius: 10px; border: 2px solid white; width: 70%">
</div>

### üîê Why SAS Token or Client Certificate Is Required

- **Event Grid uses HTTPS to deliver events**, and when targeting custom endpoints (like a webhook), it needs to ensure the destination is secure.
- **SAS tokens (Shared Access Signatures)** and **client certificates** provide a way to authenticate and authorize access without exposing credentials.
- These methods are standard for securing communication between Azure services and external systems.

---

### ‚ùå Why the Other Options Are Incorrect

| Option                      | Why It‚Äôs Not Used                                                                                      |
| --------------------------- | ------------------------------------------------------------------------------------------------------ |
| **Subscription key**        | Used in services like Azure API Management, not Event Grid.                                            |
| **Managed identity**        | Works for Azure-to-Azure authentication, but **not for custom endpoints** in Event Grid subscriptions. |
| **Password authentication** | Not supported in Event Grid; it's insecure and not scalable for service-to-service communication.      |
