# ğŸ—‚ï¸ Azure Pipeline Retention Policy

## ğŸ“Œ 1. What is Pipeline Retention?

ğŸ‘‰ **Pipeline Retention Policy** = rules that control **how long build/run history, logs, and pipeline artifacts are kept** before Azure DevOps automatically deletes them.

ğŸ’¡ Without retention â†’ every build forever â†’ huge storage & \$\$\$ costs.
ğŸ’¡ With retention â†’ only recent & important builds stay.

---

## ğŸ“Œ 2. What is Retained in Pipelines?

- âœ… **Build/Run records** (success/failure history).
- âœ… **Logs** (job/task logs).
- âœ… **Test results**.
- âœ… **Pipeline artifacts** (outputs like binaries, packages, reports).

âš ï¸ **Not the same as Azure Artifacts (feeds)** â€” this is about _build outputs_, not NuGet/npm/Maven feeds.

---

## ğŸ“Œ 3. Retention Policy Options

You can configure retention **at 3 levels**:

| Level                             | Scope                            | Example                                          |
| --------------------------------- | -------------------------------- | ------------------------------------------------ |
| **Organization / Project policy** | Global default for all pipelines | Keep last 30 days                                |
| **Pipeline policy**               | Override per pipeline            | Keep last 10 successful runs                     |
| **Per-run**                       | Protect specific runs            | â€œRetain indefinitelyâ€ (e.g., release build v1.0) |

---

## ğŸ“Œ 4. Configurable Rules

- **Maximum days to retain** â†’ e.g., delete after 30 days.
- **Minimum # of successful runs** â†’ always keep last X runs.
- **Keep runs with associated releases** â†’ linked to release pipelines â†’ never auto-delete.
- **Keep runs with retention lock** â†’ marked â€œRetain Indefinitely.â€

---

<div align="center">
  <img src="images/4.azure-pipeline-retention-policy/1757456018306.png" alt="1757456018306" style="border-radius: 10px; border: 2px solid; width: 80%">
</div>

<div align="center">
  <img src="images/4.azure-pipeline-retention-policy/1757456024584.png" alt="1757456024584" style="border-radius: 10px; border: 2px solid; width: 80%">
</div>

---

## ğŸ“Œ 5. How to Configure

### ğŸ”¹ A) Via Portal (UI)

1. Go to **Project Settings â†’ Pipelines â†’ Settings â†’ Retention**.
2. Configure default policy (days + # of runs).
3. Or open a pipeline â†’ **Edit â†’ Retention** â†’ set custom rules.

### ğŸ”¹ B) YAML (per pipeline)

```yaml
name: $(Build.DefinitionName)_$(Date:yyyyMMdd)$(Rev:.r)

trigger:
  - main

retention:
  days: 30 # keep runs for 30 days
  minimumRuns: 10 # keep at least 10 successful runs
  artifacts: 5 # keep artifacts from last 5 runs
```

### ğŸ”¹ C) Per Run (Manual)

- In **Pipelines â†’ Runs â†’ Select run â†’ Retain â†’ Retain indefinitely**.
- Useful for â€œgolden buildsâ€ (e.g., release 1.0).

---

## ğŸ“Œ 6. Real-World Example

- Team runs **20 builds/day** â†’ \~600/month.
- Without retention â†’ thousands of builds stored.
- With retention:

  - Keep last **10 successful runs**.
  - Keep builds for **30 days max**.
  - Mark release builds as **retain indefinitely**.

Result â†’ Clean history, lower storage, but important runs preserved.

---

## ğŸ“Š Visual Flow

<div align="center">

```mermaid
flowchart TD
A[Pipeline Builds & Artifacts] --> B[Retention Policy]
B -->|Keep last N days| C[Recent Builds]
B -->|Keep last N runs| D[Successful Builds]
B -->|Retain manually| E[Golden Build v1.0]
B -->|Delete rest| F[Storage Cleanup]
```

</div>

---

## ğŸ“Œ 7. Exam / Interview Tips

- If the question says:

  - **â€œKeep build v1.0 foreverâ€** â†’ Retain Indefinitely (per-run).
  - **â€œClean old builds after 30 daysâ€** â†’ Retention policy.
  - **â€œArtifacts disappearing unexpectedlyâ€** â†’ Pipeline retention expired.
  - **â€œKeep last 3 successful runsâ€** â†’ Minimum Runs setting.

âš ï¸ Donâ€™t confuse:

- **Azure Artifacts Retention** = cleanup of package versions in feeds.
- **Azure Pipeline Retention** = cleanup of build/run history, logs, artifacts.

---

## âœ… TL;DR

- **Pipeline Retention** = auto cleanup of old builds/logs/artifacts.
- Configurable at **project, pipeline, or per-run** level.
- Rules = **days kept, # of runs kept, retain indefinitely**.
- Prevents storage bloat while keeping important builds safe.
