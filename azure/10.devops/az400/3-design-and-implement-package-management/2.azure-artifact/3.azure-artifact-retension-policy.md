# ğŸ“¦ Retention Policy in Azure Artifacts

## ğŸ“Œ 1. What is Azure Artifacts?

Azure Artifacts = the **package management service** in Azure DevOps.

- Supports **NuGet, npm, Maven, Python, Universal Packages**.
- Stores packages in **feeds** (private repos for your org).

ğŸ’¡ Just like GitHub Packages or JFrog Artifactory, but integrated into Azure DevOps.

---

## ğŸ“Œ 2. What is Retention Policy?

ğŸ‘‰ **Retention Policy** = a rule that **automatically deletes old/unused package versions** from a feed to:

- Save storage costs.
- Reduce clutter in feeds.
- Keep only relevant, recently used packages.

âš ï¸ Packages can pile up quickly in CI/CD â€” every build may publish a new version. Without retention, feeds grow huge.

---

## ğŸ“Œ 3. How Retention Policy Works

- Configured **per feed** (not global).
- Applies to **package versions**, not the feed itself.
- Keeps versions based on:

  - âœ… **Number of versions** â†’ e.g., keep last 10 versions.
  - âœ… **Days since last download** â†’ e.g., delete if unused for 30 days.
  - âœ… **Pinned versions** â†’ never deleted (e.g., LTS version).

---

## ğŸ“Œ 4. How to Configure Retention Policy

### ğŸ”¹ Method 1: Azure DevOps Portal (UI)

1. Go to **Azure DevOps â†’ Artifacts â†’ Select your Feed**.
2. Top-right: **âš™ Settings â†’ Retention**.
3. Configure:

   - **Keep the last N versions**.
   - **Unconsumed versions older than X days**.
   - Exclude **pinned versions**.

4. Save.

---

### ğŸ”¹ Method 2: YAML Pipeline (Artifact cleanup)

Retention can also be set for build artifacts via pipeline YAML:

```yaml
jobs:
  - job: Build
    steps:
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: "$(Build.ArtifactStagingDirectory)"
          artifact: "drop"
          publishLocation: "pipeline"

# Retention for pipeline artifacts
name: "$(Build.DefinitionName)_$(Date:yyyyMMdd)$(Rev:.r)"
retention:
  artifacts: 5 # keep last 5 runsâ€™ artifacts
```

ğŸ‘‰ For **feeds/packages** retention is via portal,
ğŸ‘‰ For **pipeline artifacts** retention is via YAML or pipeline settings.

---

## ğŸ“Œ 5. Example Scenario

- You publish a **NuGet package** on every build.
- Without retention: 500 builds = 500 versions in feed.
- With policy:

  - Keep **last 10 versions**.
  - Delete unused versions **older than 30 days**.
  - Pinned versions (like `v1.0-stable`) stay forever.

Result â†’ feed stays clean, fast, and cheap.

---

## ğŸ“Š Visual Flow

<div align="center">

```mermaid
flowchart TD
A[Feed publishes new packages] --> B[Retention Policy]
B -->|Keep last 10 versions| C[Active Packages]
B -->|Delete old unused versions| D[Cleaned Feed]
B -->|Pinned versions excluded| E[Safe Packages]
```

</div>

---

## ğŸ“Œ 6. Exam / Interview Tips

- â€œHow to **prevent feed from growing endlessly**?â€ â†’ Retention Policy.
- â€œHow to **keep LTS package safe**?â€ â†’ Pin version (excluded from cleanup).
- â€œRetention is configured at what level?â€ â†’ Feed level.
- â€œWhatâ€™s the difference?â€

  - **Artifacts Retention (pipelines)** â†’ cleanup old build outputs.
  - **Artifacts Retention (feeds)** â†’ cleanup old package versions.

---

## âœ… TL;DR

- **Retention Policy** in Azure Artifacts = auto cleanup of old/unused package versions.
- Set per feed â†’ by versions kept, age, and pinning.
- Prevents unlimited growth of feeds, reduces cost.
- Configured in **feed settings (UI)** or via **pipelines (for build artifacts)**.
- Exam keyword â†’ _â€œkeep feed clean, save storage, auto-delete old versionsâ€_.
