
# Azure Pipelines Logging Commands (`##vso`) – Complete Deep Dive

---

## 1. What Is `##vso`?

`##vso` is **Azure Pipelines’ special command protocol** used to **communicate from a running task (script) back to the pipeline agent**.

In simple terms:

> `##vso` is how your script **talks to Azure DevOps itself**, not just prints text.

Normal output:

```bash
echo "Hello"
```

Logging command:

```bash
echo "##vso[command properties]value"
```

The agent **intercepts** this line and **executes an action** instead of printing it.

---

## 2. Why Does `##vso` Exist?

Because:

- Scripts run in **isolated shells**
- Jobs may run on **different agents**
- Pipelines need a **structured way** to:

  - Set variables
  - Publish artifacts
  - Upload test results
  - Control task behavior
  - Mark warnings/errors
  - Pass data across jobs/stages

`##vso` is the **only supported bridge** from scripts → pipeline engine.

---

## 3. General Syntax (Very Important)

```text
##vso[area.command property1=value1;property2=value2;]message
```

### Breakdown

| Part         | Meaning                                        |
| ------------ | ---------------------------------------------- |
| `##vso`      | Azure DevOps command marker                    |
| `area`       | Feature category (task, artifact, build, etc.) |
| `command`    | Action to perform                              |
| `properties` | Optional key-value metadata                    |
| `message`    | Payload / value                                |

---

## 4. Most Common `##vso` Commands (Real Usage)

| Area       | Command       | Purpose                   |
| ---------- | ------------- | ------------------------- |
| `task`     | `setvariable` | Create / update variables |
| `task`     | `logissue`    | Log warning or error      |
| `task`     | `complete`    | Finish task with status   |
| `artifact` | `upload`      | Upload pipeline artifacts |
| `build`    | `addtag`      | Tag build                 |
| `results`  | `publish`     | Publish test results      |

---

## 5. `task.setvariable` (MOST IMPORTANT)

### 5.1 Basic Variable Creation

```bash
echo "##vso[task.setvariable variable=env]dev"
```

Result:

- Creates pipeline variable `env`
- Available in **later steps of the same job**

Usage:

```yaml
- script: echo $(env)
```

---

### 5.2 Variable Parameters (Critical)

```text
##vso[task.setvariable variable=name;isOutput=true;issecret=true;]value
```

| Parameter    | Description                            |
| ------------ | -------------------------------------- |
| `variable`   | Variable name (required)               |
| `isOutput`   | Makes variable available to other jobs |
| `issecret`   | Masks value in logs                    |
| `isreadonly` | Prevents overwriting                   |

---

### 5.3 `isOutput=true` (Cross-Job Communication)

Use **only when passing values between jobs/stages**.

```bash
echo "##vso[task.setvariable variable=version;isOutput=true]1.2.3"
```

Rules:

- Step **must have a name**
- Variable accessed via `dependencies` or `stageDependencies`
- Not available via `$(version)` directly

Correct usage:

```yaml
dependencies.Build.outputs['setStep.version']
```

---

### 5.4 `issecret=true` (Secrets)

```bash
echo "##vso[task.setvariable variable=token;issecret=true]abc123"
```

Behavior:

- Value is **masked**
- Cannot be echoed
- Not printed in debug logs

Use when:

- Tokens
- Passwords
- Connection strings
- API keys

---

## 6. `task.logissue` (Warnings & Errors)

### 6.1 Warning

```bash
echo "##vso[task.logissue type=warning]Low disk space"
```

Result:

- Yellow warning in logs
- Pipeline continues

---

### 6.2 Error

```bash
echo "##vso[task.logissue type=error]Build failed"
```

Result:

- Red error
- Pipeline may fail depending on context

Use this instead of `echo "ERROR"`.

---

## 7. `task.complete` (Force Task Status)

```bash
echo "##vso[task.complete result=Failed;]Stopping pipeline"
```

| Result                | Meaning            |
| --------------------- | ------------------ |
| `Succeeded`           | Success            |
| `SucceededWithIssues` | Warnings           |
| `Failed`              | Failure            |
| `Canceled`            | User/system cancel |

Used for:

- Custom validation logic
- Manual gate enforcement
- Early termination

---

## 8. Artifact Commands

### 8.1 Upload Artifact

```bash
echo "##vso[artifact.upload containerfolder=drop;artifactname=app]$(Build.ArtifactStagingDirectory)"
```

Used when:

- Not using `PublishPipelineArtifact` task
- Custom artifact logic

---

## 9. Build Commands

### 9.1 Add Build Tag

```bash
echo "##vso[build.addtag]release"
```

Use cases:

- Identify releases
- Filter builds
- Trigger downstream logic

---

## 10. Publishing Test Results

```bash
echo "##vso[results.publish type=JUnit;runTitle=Tests;]test-results.xml"
```

Used in:

- Custom test runners
- Non-standard frameworks

---

## 11. When Should You Use `##vso`?

### Use `##vso` When:

- You are inside **script/bash/powershell**
- Built-in tasks **do not exist**
- You need **dynamic runtime behavior**
- You need **cross-job communication**
- You want **precise control**

### Do NOT Use `##vso` When:

- A first-class Azure DevOps task exists
- You can use YAML variables directly
- You are setting static configuration

---

## 12. `##vso` vs YAML Variables (Decision Table)

| Scenario                 | Use                       |
| ------------------------ | ------------------------- |
| Static config            | YAML variables            |
| User input               | Parameters                |
| Runtime calculated value | `##vso[task.setvariable]` |
| Cross-job value          | `isOutput=true`           |
| Secret at runtime        | `issecret=true`           |
| Validation failure       | `task.complete`           |

---

## 13. Common Mistakes (Very Important)

| Mistake                     | Why It Fails             |
| --------------------------- | ------------------------ |
| Forgetting step `name:`     | Output variable unusable |
| Using `$(var)` for output   | Wrong scope              |
| Using `${{ }}` with `##vso` | Compile-time mismatch    |
| Echoing secret              | Masked / blocked         |
| Typos in command            | Ignored silently         |

---

## 14. Mental Model (Memorize This)

```
Scripts cannot change pipelines
##vso commands can
```

or:

```
YAML defines structure
##vso controls behavior at runtime
```

---

## 15. End-to-End Example

```yaml
- job: Build
  steps:
    - bash: |
        VERSION=1.0.$RANDOM
        echo "##vso[task.setvariable variable=version;isOutput=true]$VERSION"
      name: setVersion

- job: Deploy
  dependsOn: Build
  variables:
    version: $[ dependencies.Build.outputs['setVersion.version'] ]
  steps:
    - script: echo Deploying $(version)
```

---

## 16. Final Takeaway

`##vso` is:

- Low-level
- Powerful
- Dangerous if misused
- Essential for advanced pipelines

If you master `##vso`, you **fully understand Azure Pipelines internals**.

---

### Next Advanced Topics You May Want

1. `##vso` vs Azure DevOps REST API
2. Debugging broken output variables
3. Secure secret handling with Key Vault + `##vso`
4. Writing custom pipeline tasks
5. Azure Pipelines agent internals

Tell me which one you want next.
