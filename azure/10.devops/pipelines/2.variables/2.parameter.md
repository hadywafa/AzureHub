# ğŸ§  **Azure Pipelines Parameters**

> **Parameters are compile-time inputs.**
> They exist **only while the Pipeline Service is building the execution plan**.
> They are **immutable**, **strongly typed**, and **structural**.
> If you use parameters correctly, your pipelines become **clean, predictable, and scalable**.

---

![Image](https://learn.microsoft.com/en-us/azure/data-factory/media/pipeline-parameter-variable-definition/parameter-definition.png)

---

<div align="center" style="background-color: #2b3436ff; border-radius: 10px; border: 2px solid">

```mermaid
graph TD
    A@{ shape: hex, label: "ğŸ‘¤ User Input" }
    B@{ shape: hex, label: "ğŸ“„ Parameters" }
    C@{ shape: hex, label: "ğŸ§  Compile-Time Expansion" }
    D@{ shape: hex, label: "ğŸ“‹ Final Pipeline" }
    E@{ shape: processes, label: "ğŸ¤– Runtime Execution" }

    A --> B
    B --> C
    C --> D
    D --> E

    classDef animate stroke-dasharray: 9,5,stroke-dashoffset: 700,animation: dash 22s linear infinite;
    class A,B,C,D,E animate
```

</div>

---

## ğŸ”´ **Problem: Using Variables for Structure**

This is the **classic junior mistake**:

```yaml
variables:
  env: prod

stages:
  - ${{ if eq(variables.env, 'prod') }}:
      - stage: Deploy
```

âŒ This **will never work**

Why?

- Variables exist at runtime
- Structure is built at compile-time

---

## ğŸ§  **Parameters vs Variables**

| Feature            | Parameters   | Variables    |
| ------------------ | ------------ | ------------ |
| Evaluation time    | Compile-time | Runtime      |
| Can change         | âŒ No        | âœ… Yes       |
| Controls structure | âœ… Yes       | âŒ No        |
| Used in scripts    | âŒ No        | âœ… Yes       |
| User input         | âœ… Yes       | âš ï¸ Sometimes |

---

## ğŸ“ƒ 1. Defining Parameters

```yaml
parameters:
  - name: environment
    type: string
    default: dev
```

Usage:

```yaml
- script: echo "Env = ${{ parameters.environment }}"
```

ğŸ“Œ Notice:

- `${{ }}` syntax
- No `$()` allowed

---

## ğŸ¤¹ 2. Parameter Types

### ğŸ”¤ String Parameter

```yaml
parameters:
  - name: env
    type: string
    values:
      - dev
      - test
      - prod
```

```yaml
- script: echo Deploying to ${{ parameters.env }}
```

âœ” Dropdown in UI  
âœ” Validation enforced

---

### ğŸ”˜ Boolean Parameter

```yaml
parameters:
  - name: runTests
    type: boolean
    default: true
```

```yaml
- ${{ if eq(parameters.runTests, true) }}:
    - script: echo Running tests
```

---

### ğŸ”¢ Number Parameter

```yaml
parameters:
  - name: replicas
    type: number
    default: 3
```

```yaml
- script: echo Replicas = ${{ parameters.replicas }}
```

---

## ğŸ“ 3. Using Parameters to Control Pipeline Structure

### ğŸ§© Example: Conditional Stage

```yaml
parameters:
  - name: deploy
    type: boolean
    default: false

stages:
  - stage: Build

  - ${{ if eq(parameters.deploy, true) }}:
      - stage: Deploy
```

âœ” Deploy stage exists only when deploy = true  
âœ” Clean execution graph

---

### âŒ Broken Alternative (Do Not Use)

```yaml
condition: eq(variables.deploy, true)
```

âŒ Stage still exists  
âŒ Only skipped, not removed

---

## ğŸ“¦ Object Parameters (Most Powerful Feature)

> Object parameters enable **dynamic pipelines**.

---

### ğŸ§± Object Parameter Definition

```yaml
parameters:
  - name: services
    type: object
    default:
      - name: api
        port: 8080
      - name: web
        port: 3000
```

---

### ğŸ” Looping Over Objects

```yaml
stages:
  - stage: Build
    jobs:
      - ${{ each svc in parameters.services }}:
          - job: Build_${{ svc.name }}
            steps:
              - script: |
                  echo Building ${{ svc.name }}
                  echo Port ${{ svc.port }}
```

âœ” Dynamic jobs  
âœ” Zero duplication  
âœ” Enterprise-grade design

---

## ğŸ¤¹â€â™€ï¸ Array Parameters (Controlled Fan-Out)

```yaml
parameters:
  - name: regions
    type: object
    default: ["eastus", "westeurope"]
```

```yaml
- ${{ each region in parameters.regions }}:
    - script: echo Deploying to ${{ region }}
```

---

## ğŸ«´ Passing Parameters into Templates (Real World)

### ğŸ“„ `job-template.yml`

```yaml
parameters:
  - name: appName
    type: string

jobs:
  - job: Build_${{ parameters.appName }}
    steps:
      - script: echo Building ${{ parameters.appName }}
```

---

### ğŸ“„ Main Pipeline

```yaml
jobs:
  - template: job-template.yml
    parameters:
      appName: api
```

âœ” Template contract
âœ” Reusability
âœ” Predictable structure

---

## ğŸ”´ Parameters vs Runtime Values (Hard Rule)

### âŒ This Is Impossible

```yaml
parameters:
  - name: version
    type: string
    default: $(Build.BuildId)
```

Why?

- Parameters are resolved **before runtime**

---

### âœ… Correct Pattern

```yaml
variables:
  version: $(Build.BuildId)
```

or

```yaml
- script: |
    echo "##vso[task.setvariable variable=version]$(Build.BuildId)"
```

---

## ğŸŸ¢ Mixing Parameters & Variables (Correct Pattern)

```yaml
parameters:
  - name: env
    type: string
    default: dev

variables:
  envName: ${{ parameters.env }}

steps:
  - script: echo $(envName)
```

âœ” Parameter defines structure
âœ” Variable used at runtime

---

## ğŸ§  **Memorization Tips**

### ğŸ”‘ Mnemonic: **"PICS"**

| Letter | Meaning           |
| ------ | ----------------- |
| **P**  | Parameters = Plan |
| **I**  | Immutable         |
| **C**  | Compile-time      |
| **S**  | Structure         |

---

## âŒ Common Parameter Mistakes

| Mistake                       | Why                  |
| ----------------------------- | -------------------- |
| Using `$()` in parameters     | Runtime too late     |
| Using parameters in scripts   | Already resolved     |
| Using variables for structure | Wrong phase          |
| Overusing parameters          | Makes pipeline rigid |
