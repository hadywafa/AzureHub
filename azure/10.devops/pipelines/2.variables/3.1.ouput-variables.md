# ğŸ§  **Output Variables & Data Flow**

> **Jobs are isolated by design.**
> Output variables are the **only native, supported way** to move **calculated runtime data**
> across **jobs** and **stages**.
> If you donâ€™t master output variables, you cannot build real CI/CD pipelines.

---

![Image](https://static.wixstatic.com/media/33586b_6c277cd9829a4504b846b258501973f0~mv2.png/v1/fill/w_1000%2Ch_575%2Cal_c%2Cq_90%2Cusm_0.66_1.00_0.01/33586b_6c277cd9829a4504b846b258501973f0~mv2.png)

---

<div align="center" style="background-color: #2b3436ff; border-radius: 10px; border: 2px solid">

```mermaid
graph TD
    A@{ shape: hex, label: "ğŸ¤– Job A\n(Build)" }
    B@{ shape: rect, label: "##vso setvariable\nisOutput=true" }
    C@{ shape: hex, label: "ğŸ“¦ Pipeline Engine" }
    D@{ shape: hex, label: "ğŸ¤– Job B\n(Deploy)" }

    A --> B
    B --> C
    C --> D

    classDef animate stroke-dasharray: 9,5,stroke-dashoffset: 600,animation: dash 20s linear infinite;
    class A,B,C,D animate
```

</div>

---

## ğŸ”´ **Problem: â€œWhy Is My Variable Empty in the Next Job?â€**

This **always fails**:

```yaml
jobs:
  - job: Build
    steps:
      - script: |
          echo "##vso[task.setvariable variable=version]1.0.0"

  - job: Deploy
    steps:
      - script: echo $(version)
```

âŒ Output:

```ini
(empty)
```

### Why?

- Jobs run on **different agents**
- Normal variables **die with the job**

---

## ğŸ§  **Golden Rule of Data Flow**

> **If data must survive job or stage boundaries, it MUST be an output variable.**

---

## 1ï¸âƒ£ Creating an Output Variable (Correct Way)

### âœ… Minimal Correct Example

```yaml
- script: |
    echo "##vso[task.setvariable variable=version;isOutput=true]1.0.0"
  name: setVersion
```

### ğŸ”‘ Three Mandatory Rules

1. Use `##vso[task.setvariable]`
2. Set `isOutput=true`
3. The step **must have a name**

Miss any â†’ it fails silently.

---

## 2ï¸âƒ£ Consuming Output Variables (Cross-Job)

### ğŸ§± Full Working Example

```yaml
jobs:
  - job: Build
    steps:
      - script: |
          VERSION=1.0.$RANDOM
          echo "##vso[task.setvariable variable=version;isOutput=true]$VERSION"
        name: buildStep

  - job: Deploy
    dependsOn: Build
    variables:
      buildVersion: $[ dependencies.Build.outputs['buildStep.version'] ]
    steps:
      - script: echo Deploying version $(buildVersion)
```

### âœ… Output

```ini
Deploying version 1.0.4832
```

---

## 3ï¸âƒ£ Understanding the Output Variable Path (CRITICAL)

### Format (Memorize This)

```ini
dependencies.<JOB>.outputs['<STEP>.<VARIABLE>']
```

### Real Example

```yaml
dependencies.Build.outputs['buildStep.version']
```

| Part        | Meaning       |
| ----------- | ------------- |
| `Build`     | Job name      |
| `buildStep` | Step name     |
| `version`   | Variable name |

---

## 4ï¸âƒ£ `$[ ]` vs `$( )` (Where People Fail)

### âŒ Wrong

```yaml
variables:
  v: $(dependencies.Build.outputs['step.var'])
```

### âœ… Correct

```yaml
variables:
  v: $[ dependencies.Build.outputs['step.var'] ]
```

| Syntax | Why                             |
| ------ | ------------------------------- |
| `$[ ]` | Evaluated before job starts     |
| `$( )` | Evaluated during step execution |

---

## 5ï¸âƒ£ Output Variables Across **Stages**

### ğŸ§± Cross-Stage Example (Very Common in CD)

```yaml
stages:
  - stage: Build
    jobs:
      - job: BuildJob
        steps:
          - script: |
              echo "##vso[task.setvariable variable=artifact;isOutput=true]drop"
            name: publishStep

  - stage: Deploy
    dependsOn: Build
    variables:
      artifactName: $[ stageDependencies.Build.BuildJob.outputs['publishStep.artifact'] ]
    jobs:
      - job: DeployJob
        steps:
          - script: echo Deploying $(artifactName)
```

---

### ğŸ”‘ Cross-Stage Path Format

```ini
stageDependencies.<STAGE>.<JOB>.outputs['<STEP>.<VAR>']
```

---

## 6ï¸âƒ£ Real-World Pattern: Build â†’ Test â†’ Deploy

### ğŸ—ï¸ Build Stage (Calculate Version)

```yaml
- stage: Build
  jobs:
    - job: BuildJob
      steps:
        - script: |
            VERSION=1.2.$(Build.BuildId)
            echo "##vso[task.setvariable variable=version;isOutput=true]$VERSION"
          name: calcVersion
```

---

### ğŸ§ª Test Stage (Consume Version)

```yaml
- stage: Test
  dependsOn: Build
  variables:
    version: $[ stageDependencies.Build.BuildJob.outputs['calcVersion.version'] ]
  jobs:
    - job: TestJob
      steps:
        - script: echo Testing version $(version)
```

---

### ğŸš€ Deploy Stage (Reuse Version)

```yaml
- stage: Deploy
  dependsOn: Test
  variables:
    version: $[ stageDependencies.Build.BuildJob.outputs['calcVersion.version'] ]
  jobs:
    - job: DeployJob
      steps:
        - script: echo Deploying version $(version)
```

âœ” Same version  
âœ” Single source of truth  
âœ” No recomputation

---

## 7ï¸âƒ£ Output Variables vs Artifacts (Very Important)

| Use Case                         | Choose          |
| -------------------------------- | --------------- |
| Small values (id, version, flag) | Output variable |
| Files / binaries                 | Artifact        |
| Cross-platform data              | Artifact        |
| Pipeline logic                   | Output variable |

âŒ Do NOT pass files via variables
âŒ Do NOT pass versions via artifacts

---

## 8ï¸âƒ£ Debugging Output Variables (Senior Skill)

---

### ğŸ” Enable Debug

```yaml
variables:
  system.debug: true
```

---

### ğŸ§ª Print All Variables

```yaml
- script: printenv | sort
```

---

### Common Debug Questions

1. Is `isOutput=true` set?
2. Is step named?
3. Is job name correct?
4. Using `$[ ]`, not `$()`?
5. Correct dependency path?

---

## âŒ Top Output Variable Mistakes (With Fixes)

### âŒ Missing Step Name

```yaml
- script: echo "##vso[task.setvariable variable=x;isOutput=true]1"
```

âœ• Not accessible  
âœ” Fix:

```yaml
- script: ...
  name: setX
```

---

### âŒ Wrong Dependency Name

```yaml
dependencies.BuildJob.outputs['step.var']
```

âœ• Job name mismatch  
âœ” Job name â‰  displayName

---

### âŒ Expecting Output in Same Step

```yaml
echo "##vso[task.setvariable variable=x;isOutput=true]1"
echo $(x)
```

âœ• Output vars are **not** available immediately  
âœ” They exist **after job completes**

---

## ğŸ§  **Memorization Tips**

### ğŸ”‘ Mnemonic: **"JSV-O"**

| Letter | Meaning                 |
| ------ | ----------------------- |
| **J**  | Job isolation           |
| **S**  | Step must be named      |
| **V**  | Variable must be output |
| **O**  | `$[ ]` to consume       |
