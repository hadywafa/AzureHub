# üßëüèª‚Äçüíª **Azure Private Links Demos**

## ‚úçüèª **Azure Private Endpoint** ‚Äî Demo (Storage Account Example)

We‚Äôll create a **Private Endpoint** to connect a subnet **privately** to an Azure Storage Account.
This ensures that traffic to the storage account flows **over a private IP on your VNet** instead of the public internet.

---

### 1Ô∏è‚É£ **Start Creating a Private Endpoint**

- Navigate to the **Azure Portal**.
- Go to **Private Link Center** ‚Üí **Private Endpoints**.
- Click **+ Create**.

---

### 2Ô∏è‚É£ **Basics Configuration**

<div align="center">
  <img src="image/az-private-links-ex-step-1.png" alt="Azure Private Endpoint - Basics" style="width: 100%; border-radius: 10px;">
</div>

---

- **Subscription**: Choose the subscription (e.g., `Aus-E-Mart Prod Sub 1`).
- **Resource Group**: Pick an existing one or create a new one (e.g., `plink1-rg`).
- **Instance Details**:

  - **Name**: `gpstore2-plink`
  - **Network Interface Name**: `gpstore2-plink-nic`
  - **Region**: Must match the VNet‚Äôs region (e.g., `Australia East`).

Click **Next: Resource**.

---

### 3Ô∏è‚É£ **Resource Configuration**

<div align="center">
  <img src="image/az-private-links-ex-step-2.png" alt="Azure Private Endpoint - Resource" style="width: 100%; border-radius: 10px;">
</div>

---

- **Connection Method**: `Connect to an Azure resource in my directory`
- **Subscription**: Ensure it matches the earlier selection.
- **Resource Type**: `Microsoft.Storage/storageAccounts`
- **Resource**: Select `ausemartgpstore2`
- **Target Sub-Resource**:

  - `blob` for Blob Storage
  - `file` for File Shares (example: `file`)

Click **Next: Virtual Network**.

---

### 4Ô∏è‚É£ **Virtual Network Configuration**

<div align="center">
  <img src="image/az-private-links-ex-step-3.png" alt="Azure Private Endpoint - VNet" style="width: 100%; border-radius: 10px;">
</div>

---

- **Virtual Network**: `vnet1`
- **Subnet**: `subnet2`
- **Private IP Configuration**:

  - `Dynamic` (auto-assigned) or
  - `Static` (you choose)

- **Application Security Group**: Optional.

Click **Next: DNS**.

---

### 5Ô∏è‚É£ **DNS Configuration**

<div align="center">
  <img src="image/az-private-links-ex-step-4.png" alt="Azure Private Endpoint - DNS" style="width: 100%; border-radius: 10px;">
</div>

---

- Enable **Private DNS Zone** integration ‚Üí **Yes**.
- **Configuration Name**: `privatelink-file-core-windows`
- Create or select an existing **Private DNS Zone**.

  - Example for Azure Files: `privatelink.file.core.windows.net`

Click **Next: Tags**.

---

### 6Ô∏è‚É£ **Tags (Optional)**

- Example:

  - `Environment`: Production
  - `Owner`: Networking Team

Click **Next: Review + Create**.

---

### 7Ô∏è‚É£ **Review and Create**

- Double-check all settings.
- Click **Create**.

‚úÖ Your **Private Endpoint** now connects your VNet **privately** to the Azure Storage Account.
DNS resolution ensures that `ausemartgpstore2.file.core.windows.net` now resolves to the **private IP** (e.g., `10.0.2.4`) inside your subnet.

---

üí° **No UDR Needed** ‚Äî Once Private Endpoint + DNS is configured, VM1 in the subnet can access the storage account without additional routing changes.

---

## ‚úçüèª **Azure Private Link Service** ‚Äî Demo (Partner/Custom Service Example)

Now let‚Äôs create a **Private Link Service** so a **provider** can expose an internal service to other VNets (or tenants) privately.

---

### **Scenario**

- **Provider**: Runs an API on VM(s) behind a **Standard Load Balancer**.
- **Consumer**: Needs to access the API privately via a Private Endpoint.

---

### **Provider Steps**

#### 1Ô∏è‚É£ **Prepare Backend**

- Deploy VM(s) running your service in a VNet.
- Place them **behind a Standard Load Balancer** (Basic SKU not supported).
- The LB must have a **Frontend IP Configuration**.

---

#### 2Ô∏è‚É£ **Create Private Link Service**

- Go to **Private Link Center** ‚Üí **Private Link services** ‚Üí **+ Create**.
- **Basics**:

  - Subscription: Choose your subscription.
  - Resource Group: Example `provider-pls-rg`.
  - Name: `provider-api-pls`
  - Region: Same as Load Balancer.

- Click **Next: Configuration**.

---

#### 3Ô∏è‚É£ **Configuration**

- **Frontend IP Configuration**: Select the LB frontend.
- **Visibility**:

  - Restrict to specific subscriptions/tenants **or**
  - Allow all (not recommended for sensitive services).

- Enable **Auto-Approval** (optional).

Click **Review + Create** ‚Üí **Create**.

---

### **Consumer Steps**

#### 1Ô∏è‚É£ **Create Private Endpoint**

- Go to **Private Link Center** ‚Üí **Private Endpoints** ‚Üí **+ Create**.
- **Connection Method**: `Connect to an Azure resource by resource ID or alias`.
- Paste **Provider Alias** (given by the provider).
- Select your **VNet + Subnet**.
- Configure DNS (Private DNS Zone for the provider‚Äôs custom domain or FQDN).

---

#### 2Ô∏è‚É£ **Approval**

- Provider receives a connection request in the **Private Link Service** ‚Üí **Connections**.
- Provider **approves** the request.

---

#### 3Ô∏è‚É£ **Test Connectivity**

```bash
nslookup partnerapi.privatelink.azure.com
# Should resolve to a private IP from your subnet

curl https://partnerapi.privatelink.azure.com
# Response from provider API
```

---

## üìä **Key Differences in the Demos**

| Feature              | Private Endpoint   | Private Link Service    |
| -------------------- | ------------------ | ----------------------- |
| Target               | Azure-managed PaaS | Partner/custom services |
| Setup Owner          | Consumer           | Provider + Consumer     |
| Load Balancer Needed | ‚ùå No              | ‚úÖ Yes (Standard)       |
| Example              | Storage Account    | SaaS API                |
