# ğŸ›  Creating VNet Peering in Azure

<div align="center">
  <img src="image/vnet-peering-creation.png" alt="Azure VNet Peering Creation" style="width: 80%; border-radius: 10px;">
</div>

---

## ğŸ§ª Demo Architecture

<div align="center">

```mermaid
graph LR
    VM1[VM in VNet1]
    VM2[VM in VNet2]
    VM1 <--> VM2
```

</div>

> - **Before Peering:** VM1 â†” VM2 = âŒ (no route)
> - **After Peering:** VM1 â†” VM2 = âœ… (private IP, no public internet)

---

## ğŸ“ Steps to Create VNet Peering

### 1ï¸âƒ£ Navigate to Virtual Networks

- Go to the **[Azure Portal](https://portal.azure.com/)**.
- In the left-hand menu, select **"Virtual networks"**.
- Click on the **first VNet** you want to peer (e.g., `VNet1`).

---

### 2ï¸âƒ£ Initiate Peering

- In the **selected VNet's** menu, go to **"Peerings"** under **"Settings"**.
- Click **"+ Add"** to create a new peering.

---

### 3ï¸âƒ£ Configure Peering Settings

- **Peering Link Name (Local):** e.g., `VNet1-to-VNet2`.
- **Remote Virtual Network:** Choose `VNet2` from the dropdown.
- **Peering Link Name (Remote):** e.g., `VNet2-to-VNet1`.

---

### 4ï¸âƒ£ Set Peering Options

Hereâ€™s how each option works:

#### ğŸ”¹ **Traffic to Remote VNet**

- **What It Is:** Allows VNet1 resources to talk to VNet2 resources.
- **Options:**

  - **Enabled:** Full communication over **private IPs**.
  - **Disabled:** No connectivity.

- **Use Case:** Always enabled for typical VNet-to-VNet communication.

---

#### ğŸ”¹ **Traffic Forwarded from Remote VNet**

- **What It Is:** Lets traffic from the remote VNet **pass through** this VNet to reach somewhere else.
- **Options:**

  - **Enabled:** Supports **service chaining / transit** scenarios.
  - **Disabled:** Blocks transit routing.

- **Use Case:** Needed for **hub-and-spoke** where this VNet is the **hub**.

---

#### ğŸ”¹ **Virtual Network Gateway or Route Server**

- **Allow Gateway Transit:** Remote VNets can use **your** VPN Gateway or ExpressRoute Gateway.
- **Use Remote Gateway:** Your VNet uses **remote** VNetâ€™s Gateway.
- **Enable Forwarded Traffic:** Required for transit routing via NVAs/Firewalls.

ğŸ’¡ **AWS comparison:** This is something AWS VPC Peering **doesnâ€™t** natively do â€” youâ€™d need a **Transit Gateway** in AWS to share VPN/Direct Connect gateways.

---

## â“ Do You Need a UDR?

- **By Default:** **No** â†’ Once you create VNet Peering **and enable "Allow Virtual Network Access"**, Azure automatically adds **system routes** to each VNetâ€™s **effective routes** table, so VMs can talk instantly.
- **When UDR is Needed:**

  - You have a **custom route table** that overrides the system route.
  - You want to **force traffic** through an NVA/Firewall before it reaches the other VNet.

---

## ğŸ” Quick Verification Steps

1. **Ping Test:**

   - Enable ICMP on NSGs for both subnets.
   - Ping VM2â€™s private IP from VM1.

2. **Effective Routes Check:**

   - Go to the NIC of VM1 â†’ **Effective routes**.
   - Youâ€™ll see a **VNet peering route** with **next hop = Virtual network peering**.

---

## ğŸ“Œ Summary Table

| Setting                      | Default | Required for Basic VM â†” VM | Required for Hub-Spoke |
| ---------------------------- | ------- | -------------------------- | ---------------------- |
| Allow Virtual Network Access | âœ…      | âœ…                         | âœ…                     |
| Allow Forwarded Traffic      | âŒ      | âŒ                         | âœ…                     |
| Allow Gateway Transit        | âŒ      | âŒ                         | âœ…                     |
| Use Remote Gateway           | âŒ      | âŒ                         | âœ…                     |
