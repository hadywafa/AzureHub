# üîê **Azure VPN Gateway** ‚Äî Secure Hybrid Connectivity in Azure

> üìú Official Definition  
> **Azure VPN Gateway** is a **specific type of virtual network gateway** that provides **secure, encrypted connectivity** between your **Azure VNets** and:
>
> - **On-premises networks** (Site-to-Site VPN)
> - **Individual remote devices** (Point-to-Site VPN)
> - **Other Azure VNets** (VNet-to-VNet VPN)

---

<div align="center">
  <img src="image/az-vpn-gateway.png" alt="Azure VPN Gateway" style="width: 80%; border-radius: 10px;">
</div>

> It uses **IPSec/IKE** for encryption and **runs inside a dedicated subnet** in your VNet called `GatewaySubnet`.

---

## üß© **Core Components**

### 1Ô∏è‚É£ **Gateway Types**

- **VPN Gateway** ‚Üí IPSec/IKE-based encrypted tunnel over the Internet.
- **ExpressRoute Gateway** ‚Üí Connects VNets to ExpressRoute circuits (private MPLS-based).
- **Both** ‚Üí If you need hybrid scenarios.

---

### 2Ô∏è‚É£ **Connection Types**

| Connection Type         | Purpose                                                                | AWS Equivalent          |
| ----------------------- | ---------------------------------------------------------------------- | ----------------------- |
| **Site-to-Site (S2S)**  | Connects an entire on-prem network to Azure VNet                       | AWS Site-to-Site VPN    |
| **Point-to-Site (P2S)** | Connects individual remote devices (laptops, mobiles)                  | AWS Client VPN          |
| **VNet-to-VNet**        | Securely connect Azure VNets (same or different regions/subscriptions) | AWS VPC Peering + VPN   |
| **Multi-Site**          | Multiple S2S VPNs from different locations to one VNet                 | AWS TGW VPN attachments |

---

### 3Ô∏è‚É£ **Gateway SKUs & Performance**

- **Generation 1** ‚Üí Up to 1 Gbps aggregate throughput.
- **Generation 2** ‚Üí Up to 10 Gbps aggregate throughput.
- Features depend on SKU:

  - **Basic** ‚Üí Cheapest, fewer features (no BGP, no zone-redundancy).
  - **VpnGw1‚ÄìVpnGw5** ‚Üí Scale in throughput and tunnels.
  - **AZ SKUs** ‚Üí Zone-redundant for high availability.

---

### 4Ô∏è‚É£ **Protocols Supported**

- **IKEv2**
- **OpenVPN** (for P2S only)
- **SSTP** (legacy P2S option for Windows)

---

## ü§πüèª **Types of VPN Gateway Connections**

### 1Ô∏è‚É£ **Site-to-Site (S2S) VPN:**

<div align="center">
  <img src="image/az-vpn-s2s.png" alt="alt text" style="width: 100%; border-radius: 10px;">
</div>

- **Definition**: Connects an entire on-premises network to an Azure VNet. This type of connection extends your on-premises network to Azure over an IPsec/IKE VPN tunnel.
- **Use Case**: Suitable for scenarios where you need to connect two or more networks. For example, connecting your company's main office network to your Azure infrastructure.
- **Requirements**: Requires a VPN device (router or firewall) that supports IPsec/IKE.

### 2Ô∏è‚É£ **Point-to-Site (P2S) VPN:**

<div align="center">
  <img src="image/az-vpn-p2s.png" alt="Azure Point-to-Site VPN" style="width: 100%; border-radius: 10px;">
</div>

- **Definition**: Connects individual devices (clients) to an Azure VNet. This type of connection allows users to connect to Azure from anywhere using a secure connection.
- **Use Case**: Ideal for remote workers who need to securely connect to the Azure VNet from their laptops or mobile devices.
- **Requirements**: Only requires a client device with VPN client software. No need for a dedicated VPN device on the on-premises side.

---

## üí° **Example Scenarios**

### **Scenario 1 ‚Äî Site-to-Site VPN**

**Use case:** Corporate HQ needs to securely access Azure-hosted apps.

- On-premises firewall: Cisco ASA, Fortinet, Palo Alto, etc.
- Tunnel established over the Internet using IPsec/IKE.
- All traffic between networks is encrypted.

---

### **Scenario 2 ‚Äî Point-to-Site VPN**

**Use case:** Remote employees access Azure VNet securely.

- Employees install Azure VPN Client.
- Authenticate via:

  - Azure AD
  - Certificate-based
  - RADIUS server

- Useful for work-from-home or contractors.

---

### **Scenario 3 ‚Äî VNet-to-VNet VPN**

**Use case:** Two VNets in different Azure regions (or subscriptions) need encrypted connectivity without VNet Peering.

- Uses the Microsoft global backbone for transport.
- Can be combined with BGP for dynamic routing.

---

## ü™ú **Step-by-Step** ‚Äî Site-to-Site VPN Gateway Setup

### 1Ô∏è‚É£ **Create the GatewaySubnet**

```plaintext
Name: GatewaySubnet
CIDR: /27 or larger (e.g., 10.0.255.0/27)
```

üí° This subnet is **reserved** for the VPN Gateway VMs managed by Microsoft.

---

### 2Ô∏è‚É£ **Deploy the VPN Gateway**

- Azure Portal ‚Üí `+ Create Resource` ‚Üí Search **Virtual Network Gateway**.
- **Gateway type:** VPN
- **VPN type:** Route-based (recommended)
- **SKU:** VpnGw2AZ (for HA)
- **Public IP:** Create new
- **VNet:** Select your VNet with `GatewaySubnet`

---

### 3Ô∏è‚É£ **Configure the Local Network Gateway**

- Represents your on-premises VPN device.
- Provide:

  - Public IP of on-prem firewall
  - Local network address ranges (e.g., 192.168.0.0/16)

---

### 4Ô∏è‚É£ **Create the VPN Connection**

- Link **Virtual Network Gateway** to **Local Network Gateway**.
- Provide **shared key** (must match on both ends).
- Enable **BGP** if using dynamic routing.

---

## üìä **Routing Behavior**

- **Static routing** ‚Üí Manual prefix definition in Local Network Gateway.
- **Dynamic routing with BGP** ‚Üí Gateway exchanges routes automatically with on-prem router.

üí° AWS Comparison: Similar to **AWS VGW + Site-to-Site VPN**, but Azure‚Äôs VPN Gateway supports **multi-region hub-and-spoke with BGP** more seamlessly.

---

## ‚öîÔ∏è **Security Best Practices**

- Always use **Route-based VPN** (better for dynamic routing and multiple connections).
- Enable **Active-Active** mode for redundancy.
- Use **IKEv2** with strong encryption (`AES256`, `SHA256`).
- If using P2S, enforce Azure AD MFA for users.
- Monitor via **Azure Network Watcher** and **Connection Monitor**.
