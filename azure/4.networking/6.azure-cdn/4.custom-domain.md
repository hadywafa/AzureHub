# 🌍 Custom Domains in Azure CDN

## 🧐 What is a Custom Domain in Azure CDN?

By default, when you create an **Azure CDN endpoint**, it gets a URL like:

```ini
https://myapp.azureedge.net
```

This works fine technically, but for real-world apps you usually want your own branded domain:

```ini
https://cdn.mycompany.com
https://static.mysite.com
```

👉 That’s where **Custom Domains** come in.  
A **Custom Domain** lets you map your own DNS hostname to the Azure CDN endpoint, so your users interact with a friendly, trusted domain.

---

## ⚙️ How It Works

1. You create a **CDN endpoint** → `mycdn.azureedge.net`.
2. You configure a **Custom Domain** → e.g., `cdn.mysite.com`.
3. In your **DNS provider**, you add a **CNAME record** pointing:

   ```ini
   cdn.mysite.com → mycdn.azureedge.net
   ```

4. Azure CDN validates this mapping.
5. Once validated, requests to `cdn.mysite.com` are routed through Azure CDN edge nodes.

---

## 🔑 Features of Custom Domains in Azure CDN

- ✅ **Custom branding** → Use `cdn.myapp.com` instead of `azureedge.net`.
- ✅ **SSL/TLS support** → HTTPS with free managed certificates or your own cert.
- ✅ **Multiple domains per endpoint** → Attach multiple subdomains to the same CDN endpoint.
- ✅ **Global edge delivery** → Even though your DNS points to your CDN domain, the CDN routes to the **nearest edge node** for performance.
- ✅ **Custom rules** (optional) → Apply different caching or header rules based on hostname.

---

## 🛠️ Setup Steps in Azure Portal

### Example: Add `cdn.mysite.com` to Azure CDN

1. **Navigate to your CDN profile** in the Azure Portal.
2. Select your **endpoint**.
3. In the left pane, click **Custom domains** → **+ Add**.
4. Enter your domain (e.g., `cdn.mysite.com`).
5. Azure shows the CNAME you must create:

   ```ini
   cdn.mysite.com → mycdn.azureedge.net
   ```

6. Go to your DNS provider (Azure DNS, GoDaddy, Cloudflare, etc.).

   - Add a **CNAME record**:

     - Name: `cdn`
     - Value: `mycdn.azureedge.net`

7. Wait for DNS propagation.
8. Back in Azure Portal, click **Validate**.
9. Enable **HTTPS**:

   - Option 1: **Free managed certificate** (recommended).
   - Option 2: Upload your own cert from Azure Key Vault.

---

## 🔒 Custom Domain HTTPS

Azure CDN requires HTTPS for security. You have two options:

- **CDN Managed Certificate** (Free)

  - Issued automatically by DigiCert.
  - Auto-renewed before expiry.
  - Easiest choice.

- **Bring Your Own Certificate**

  - Store cert in **Azure Key Vault**.
  - More control, useful if you have corporate PKI.

---

## 🎯 Example Use Cases

1. **Static Website Assets**

   - Domain: `static.mysite.com`
   - CDN caches CSS, JS, images.

2. **Media Streaming**

   - Domain: `media.myapp.com`
   - CDN accelerates video delivery.

3. **Multi-Tenant SaaS**

   - Domains: `cdn.tenant1.com`, `cdn.tenant2.com`
   - All mapped to the same CDN endpoint.

---

## 🔄 Diagram: Flow of Custom Domain in Azure CDN

<div align="center">

```mermaid
flowchart LR
    U[User Browser: cdn.mysite.com] --> D[DNS CNAME Lookup]
    D --> E[Azure CDN Edge Node (azureedge.net)]
    E -->|Cache Hit| U
    E -->|Cache Miss| O[Origin Server]
    O --> E
    E --> U
```

</div>

---

## ✅ Key Notes & Best Practices

- Always use **CNAME**, not A records (CDN edges are dynamic).
- Enable **HTTPS** (managed cert is easiest).
- For **wildcard domains** (`*.mysite.com`), only supported with Azure Front Door (not classic CDN).
- If migrating from `azureedge.net` to your domain, keep both mapped for a while to avoid downtime.
- Test with:

  ```bash
  curl -I https://cdn.mysite.com
  ```

  to verify headers & HTTPS cert.

---

## 📌 Summary

- **Custom Domains** let you serve CDN content under your own hostname (`cdn.mysite.com`).
- Works via **CNAME mapping** to the CDN endpoint.
- Azure CDN supports **HTTPS with free or custom certificates**.
- Used for branding, trust, and flexible caching rules.
- Setup is simple: add domain → create DNS CNAME → validate → enable HTTPS.

---

👉 Do you want me to also show you **how custom domains differ in Azure CDN vs. Azure Front Door**, since both support them but with different rules (like wildcard support and certificate handling)?
