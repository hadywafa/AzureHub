# ðŸŒ Azure Front Door â€“ Global Entry Point for Your Apps

> ðŸ’¡ **Rule of Thumb:**  
> If you know AWS **CloudFront + Route 53 + ALB + WAF + Global Accelerator**,
> then **Azure Front Door is basically those rolled into one**, with management centralized and always global.

---

<div align="center">
  <img src="image/afd-features.png" alt="Azure Front Door Diagram" style="width: 100%; border-radius: 10px; border: 2px solid white;">
</div>

---

## ðŸ›‘ **Problem** â€“ The Need for a Global, Secure Entry

If your application serves users worldwide:

- Users far from your servers face **high latency**.
- Direct exposure to the internet makes you vulnerable to **DDoS and malicious traffic**.
- You want **one global URL** but need to route to **different backends** (multi-region, multi-cloud).
- You need **instant failover** if one backend goes down.

**Without AFD:**

- Users in Asia hitting a US data center â†’ **slow performance**.
- DNS-level load balancing is slow to update in failover.
- No unified WAF or TLS termination across all regions.

---

## âœ… **Solution:** Azure Front Door

**Azure Front Door** is a **global, scalable entry point** for web applications.
It provides:

- **Layer 7 load balancing** (HTTP/HTTPS).
- **Dynamic site acceleration** via Microsoftâ€™s global edge network.
- **Web Application Firewall (WAF)** integration.
- **Smart routing** to the fastest, healthiest backend.
- **Single global anycast IP** for your app.

---

## ðŸ§© **Core Components**

<div align="center">
  <img src="image/afd-components.png" alt="Azure Front Door" style="width: 100%; border-radius: 10px; border: 2px solid white;">
</div>

---

| Component             | Purpose                                           | Example                                     |
| --------------------- | ------------------------------------------------- | ------------------------------------------- |
| **Frontend Endpoint** | Public hostname users connect to.                 | `www.contoso.com`                           |
| **Backend Pool**      | Group of backends (Azure, on-prem, or external).  | West US App Service + East Asia App Service |
| **Routing Rules**     | How requests are matched and sent to backends.    | `/api` â†’ API backend, `/images` â†’ Storage   |
| **Health Probes**     | Periodic checks to ensure backend health.         | HTTP GET `/health` every 30s                |
| **Rules Engine**      | Modify requests/responses at the edge.            | Add security headers, rewrite URLs          |
| **WAF Policy**        | Protect from OWASP Top 10 threats.                | Block SQL injection attempts                |
| **Caching**           | Store static content at edge for faster delivery. | Cache images/CSS at POPs                    |

---

## ðŸš¦ **Traffic Flow**

```mermaid
flowchart LR
    User[User ðŸŒ] --> FE[Frontend Endpoint ðŸŒ]
    FE --> WAF[WAF Policy ðŸ”’]
    WAF --> Rule[Routing Rules ðŸ“œ]
    Rule --> Health{Healthy Backend?}
    Health -- Yes --> BE1[Backend 1 âœ…]
    Health -- No --> BE2[Backend 2 âœ…]
    BE1 & BE2 --> Response[Return Content âš¡]
    Response --> User
```

---

## Routing Flow

<div align="center">
  <img src="image/afd-routing-flow.png" alt="Azure Front Door Routing Flow" style="width: 100%; border-radius: 10px; border: 2px solid white;">
</div>

---

## ðŸ’¡ **Key Features**

### 1ï¸âƒ£ **Global Load Balancing**

- **Anycast IP** â€“ same IP worldwide.
- Uses **split TCP** and Microsoft backbone for acceleration.
- Supports **priority** (failover) and **weighted** (load share) routing.

---

### 2ï¸âƒ£ **Web Application Firewall (WAF)**

- Integrated into AFD.
- Rule sets: OWASP 3.x.
- Modes: **Detection** (log only) or **Prevention** (block).

Example â€“ Block SQL injection:

```plaintext
Condition: Request contains ' OR 1=1 --
Action: Block
```

---

### 3ï¸âƒ£ **Rules Engine**

- Modify headers.
- URL rewrites.
- Redirects (301/302).
- Conditional logic (Geo-based, device type).

Example â€“ Redirect mobile users:

```plaintext
If Request Header "User-Agent" contains "Mobile"
â†’ Redirect to m.contoso.com
```

---

### 4ï¸âƒ£ **Caching**

- Store static content at POPs (Point of Presence) for faster delivery.
- Cache key can include **query strings, headers, or cookies**.

Example â€“ Cache per language:

```plaintext
Cache-Key: URL + "Accept-Language" header
```

---

### 5ï¸âƒ£ **Session Affinity**

- Uses cookies to route a user to the same backend during their session.

---

## ðŸ›  **Step-by-Step Example**

### Scenario:

Serve a global e-commerce site with **primary in West US** and **secondary in East Asia**.

1. **Create AFD Profile**

   - Choose **Standard/Premium** SKU depending on features needed (Premium includes Private Link, Rules Engine at more depth).

2. **Add Frontend Endpoint**

   - Map `www.contoso.com` to AFD.

3. **Create Backend Pool**

   - Backend 1: `usapp.azurewebsites.net` (Priority 1)
   - Backend 2: `asiaapp.azurewebsites.net` (Priority 2)

4. **Configure Health Probes**

   - Path: `/health` every 30 seconds.

5. **Add Routing Rule**

   - Match: `/*` â†’ Backend Pool.
   - Enable caching for static content.

6. **Attach WAF Policy**

   - Enable OWASP rules.
   - Custom rule to block requests from certain countries.

7. **Test Failover**

   - Shut down Backend 1 â†’ Traffic instantly switches to Backend 2.

---

## ðŸŒ **Common Use Cases**

| Use Case                  | How AFD Helps                              |
| ------------------------- | ------------------------------------------ |
| **Multi-region failover** | Priority-based routing with health probes. |
| **Global performance**    | Dynamic site acceleration via edge POPs.   |
| **DDoS protection**       | Built-in + WAF.                            |
| **Single global URL**     | Anycast IP + global DNS integration.       |
| **Edge caching**          | Faster static content delivery.            |

---

## ðŸ” **Azure Front Door vs. Application Gateway vs. Azure Firewall**

| Feature                 | Front Door ðŸŒ | App Gateway ðŸšª | Azure Firewall ðŸ”¥ |
| ----------------------- | ------------- | -------------- | ----------------- |
| Layer                   | 7             | 7              | 3â€“7               |
| Scope                   | Global        | Regional       | Regional          |
| CDN Caching             | âœ…            | âŒ             | âŒ                |
| WAF                     | âœ…            | âœ…             | âŒ                |
| Multi-region routing    | âœ…            | âŒ             | âŒ                |
| Private Link to backend | âœ… (Premium)  | âœ… (v2)        | âŒ                |
| TLS Termination         | âœ…            | âœ…             | âŒ                |

---

## âš ï¸ **Important Considerations**

1. **Private Backends** â€“ Need Premium SKU with **Private Link**.
2. **WAF Costs** â€“ WAF policy is billed separately.
3. **Caching** â€“ Can save cost and improve speed but needs correct invalidation strategy.
4. **DNS TTL** â€“ Changes propagate instantly since itâ€™s edge-based, unlike traditional DNS failover.
5. **SSL Certs** â€“ Managed certificates are free; custom certs supported.

---

## ðŸ“Œ **Mini Real-World Example**

> **Company:** Contoso E-commerce
> **Goal:** Serve global users with <100ms latency.
> **Solution:**
>
> - Deploy App Service in **East US** + **West Europe**.
> - Place **Azure Front Door** in front with WAF.
> - Enable caching for product images.
> - Use rules engine to route `/api` â†’ East US only (API with region-specific logic).
> - If East US API fails health probe, instantly switch to West Europe.

---

## ðŸ’° Pricing Tiers

<div align="center">
  <img src="image/afd-sku.png" alt="Azure Front Door Pricing Tiers" style="width: 100%; border-radius: 10px; border: 2px solid white;">
</div>
