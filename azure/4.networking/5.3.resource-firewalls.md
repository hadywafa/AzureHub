# üîí **Azure Resource Firewall**

A **Resource Firewall** in Azure is a security feature applied **at the resource level** (e.g., Storage Account, SQL Database, Key Vault) to restrict access based on **IP ranges** or **virtual network rules**.

> üí° It **does not inspect traffic content** ‚Äî it simply decides **who can connect** based on network location. Think of it as a **door lock** at the resource level, while **Azure Firewall** is more like a **security guard with a metal detector** for your whole network.

---

<div align="center">
  <img src="images/az-resource-firewall.png" alt="Azure Resource Firewall" style="width: 80%; border-radius: 10px;">
</div>

---

## üß© **Key Components**

1Ô∏è‚É£ **Resource** The Azure service you want to protect:

- Storage Account
- SQL Database
- Key Vault
- Event Hub, etc.

2Ô∏è‚É£ **Network Rules** Rules that allow or deny traffic **based on source IP ranges, subnets, or VNets**.

- Works at **Layer 4 (TCP/UDP)** ‚Äî no application inspection.
- You can allow specific IPs or subnets.

3Ô∏è‚É£ **Exceptions** Azure services that may need **bypass access**, for example:

- Azure Backup
- Azure Monitor
- Azure Site Recovery
- Azure DevTest Labs
- Azure Event Grid
- Azure Networking
- Azure SQL Data Warehouse

<div align="center">
  <img src="images/az-resource-firewall-components.png" alt="Azure Resource Firewall Components" style="width: 100%; border-radius: 10px; border: 2px solid white;">
</div>

---

## ‚öôÔ∏è **How to Configure a Resource Firewall**

<div align="center">
  <img src="images/az-resource-firewalls-config.png" alt="Azure Resource Firewall Config" style="width: 100%; border-radius: 10px;">
</div>

### 1Ô∏è‚É£ **Firewalls and Virtual Networks** (Public Access)

In the resource‚Äôs **Networking** blade:

- **Public Network Access** Options:

  1. `Enabled from all networks` ‚Üí **Open** to the public internet.
  2. `Enabled from selected virtual networks and IP addresses` ‚Üí
     Restrict to specific VNets or IP ranges.
     **Note:** VNets must be linked via **Service Endpoint** or **Private Endpoint**.
  3. `Disabled` ‚Üí No public network access at all.

- **Example**:
  Allow only `203.0.113.0/24` and a specific VNet for storage account access.

---

### 2Ô∏è‚É£ **Private Endpoint Connections** (Private Access)

If you use a **Private Endpoint**:

- Traffic flows via **private IP** inside your VNet.
- Resource firewall **does not control private endpoint traffic** ‚Äî use:

  - **Network Security Groups (NSGs)** ‚Üí Inbound/Outbound rules.
  - **Route Tables** ‚Üí Direct traffic paths.

> üí° **Note:** For Private Endpoints, the resource firewall‚Äôs IP rules are irrelevant ‚Äî you control access **via NSG**.

---

## üìå **Important Notes**

- **Default Behavior**:
  If no firewall rules exist ‚Üí Resource is publicly accessible (unless private endpoint is enforced).
- **System Routes & Effective Routes** still determine if your VNet can reach the resource.
- Resource firewall is **per-resource**; it‚Äôs not shared between resources.
- If you block public access and don‚Äôt configure private endpoint ‚Üí The resource becomes unreachable.

---

## ü•ä **Resource-Level Firewall vs Azure Firewall**

| Feature   | Resource-Level Firewall    | Azure Firewall                                    |
| --------- | -------------------------- | ------------------------------------------------- |
| Scope     | Single resource            | Entire VNet or multiple VNets                     |
| OSI Layer | Layer 4 (TCP/UDP)          | Layers 3‚Äì7                                        |
| Filtering | Based on IP ranges / VNets | Stateful inspection, app rules, NAT, threat intel |
| Logs      | Resource diagnostics       | Centralized Azure Monitor logs                    |
| Example   | Storage Account firewall   | Hub-Spoke network firewall                        |

---

üí° **AWS Comparison**

- **Azure Resource Firewall** ‚âà **S3 Bucket Policy IP Restrictions** or **RDS Security Group**
- **Azure Firewall** ‚âà **AWS Network Firewall / NAT Gateway with rules**

---

## üîç **Real-World Example**

**Scenario:**
You have a **Storage Account** used only by:

- An App Service in `VNet-App1`
- Admin IP range `198.51.100.0/24`

**Configuration:**

1. In Storage Account ‚Üí **Networking**:

   - Public Network Access ‚Üí `Selected networks`
   - Add:

     - `VNet-App1` (via service endpoint)
     - IP range `198.51.100.0/24`

2. Disable ‚ÄúAllow Azure services on the trusted services list‚Äù unless needed.

**Result:**

- Access is denied from any other IP or VNet.
- Attempting from a random VM on the internet ‚Üí `403 Forbidden`.
