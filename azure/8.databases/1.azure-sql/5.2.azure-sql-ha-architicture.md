# ‚öôÔ∏è Azure SQL High Availability Architecture Models

Azure SQL offers **three main HA architecture models**, depending on the **service tier**:

| Model                       | Service Tiers                    | Storage Type                   | Replication                       | Read Replicas                              | Example               |
| --------------------------- | -------------------------------- | ------------------------------ | --------------------------------- | ------------------------------------------ | --------------------- |
| üõ∞Ô∏è **Remote Storage Model** | Basic, Standard, General Purpose | Azure Premium/Standard Storage | Remote (data/log stored remotely) | ‚ùå No read replicas                        | Lower-cost workloads  |
| üíæ **Local Storage Model**  | Premium, Business Critical       | Local SSD                      | AlwaysOn Availability Group       | ‚úÖ Yes (sync secondary for read scale-out) | Mission-critical OLTP |
| üß† **Hyperscale Model**     | Hyperscale tier only             | Distributed Page Servers       | Async replication via log service | ‚úÖ Yes (many read-only replicas)           | Very large databases  |

---

## 1Ô∏è‚É£ Remote Storage Model (General Purpose Tier)

üìç **Used by:** Basic, Standard, and General Purpose service tiers

<div align="center" style="background-color: #242A3A ;border-radius: 10px;border: 2px solid white">
  <img src="image/1759945475258.png" alt="Azure Cosmos DB" style="width: 80%">
</div>

### üß© Architecture Highlights

- **Compute and storage are separated.**
- The **primary replica** handles read/write requests.
- **Data/log files** are stored remotely on Azure Premium Storage.
- During a **failover**, a new compute replica attaches the **same remote storage**.

### üîÑ How Failover Works

- Stable

    <div align="left">
      <img src="image/1759945541761.png" alt="Azure Cosmos DB" style="border-radius: 10px; border: 2px solid white; width: 40%;margin: 0 30px">
    </div>

- Failure

    <div align="left">
      <img src="image/1759945560251.png" alt="Azure Cosmos DB" style="border-radius: 10px; border: 2px solid white; width: 40%;margin: 0 30px">
    </div>

| Step | Description                                               |
| ---- | --------------------------------------------------------- |
| 1Ô∏è‚É£   | Primary replica fails (e.g., due to host crash).          |
| 2Ô∏è‚É£   | Azure SQL automatically reassigns a standby compute node. |
| 3Ô∏è‚É£   | The new node **mounts the same remote data/log files**.   |
| 4Ô∏è‚É£   | Recovery occurs quickly (no data copy needed).            |

### ‚ö° Pros

- Low-cost architecture
- Fast restart using same storage
- Simpler to scale compute (independent of data layer)

### ‚ö†Ô∏è Cons

- Data I/O latency slightly higher (remote storage access)
- Failover causes **brief downtime** (no in-memory replica)
- **No read replicas** for scale-out

---

## 2Ô∏è‚É£ Local Storage Model (Business Critical Tier)

üìç **Used by:** Premium and Business Critical service tiers

<div align="center" style="background-color: #242A3A ;border-radius: 10px;border: 2px solid white">
  <img src="image/1759947567263.png" alt="Azure Cosmos DB" style="width: 80%">
</div>

<div align="center">

```mermaid
flowchart LR
    A[App] --> P1[Primary Replica]
    P1 -->|AlwaysOn Sync| S2[Secondary Replica 1]
    P1 -->|AlwaysOn Sync| S3[Secondary Replica 2]
    P1 -->|AlwaysOn Sync| S4[Secondary Replica 3]
    P1 -->|Backups| B["Azure Standard Storage (RA-GRS)"]
```

</div>

### üß© Architecture Highlights

- **Compute and data are co-located** (local SSD for data/log/tempdb).
- Uses **AlwaysOn Availability Groups** for synchronous replication.
- Provides **up to 4 replicas** (1 primary + 3 secondaries).
- One replica can be used for **read scale-out**.

### üîÑ Failover Flow

| Step | Description                                                 |
| ---- | ----------------------------------------------------------- |
| 1Ô∏è‚É£   | Primary node fails.                                         |
| 2Ô∏è‚É£   | Synchronous secondary immediately promoted (no data loss).  |
| 3Ô∏è‚É£   | DNS or connection string rerouted to new primary.           |
| 4Ô∏è‚É£   | New secondary automatically created to maintain redundancy. |

### ‚öôÔ∏è Characteristics

| Property      | Detail                            |
| ------------- | --------------------------------- |
| Write replica | Only one primary (write master)   |
| Read replicas | Up to 3 (sync secondary replicas) |
| Replication   | Synchronous (HA zone)             |
| Recovery      | Instant (<10s typical)            |
| Local storage | SSD ‚Äì provides high IOPS          |

### ‚ö° Pros

- Zero data loss (synchronous replication)
- Read-scale via secondary replica
- Excellent latency (local SSD)

### ‚ö†Ô∏è Cons

- More expensive
- Compute + data tied (harder to separate scaling)

---

## 3Ô∏è‚É£ Hyperscale Model

üìç **Used by:** Hyperscale tier only

<div align="center" style="background-color: #242A3A ;border-radius: 10px;border: 2px solid white">
  <img src="image/1759947971696.png" alt="Azure Cosmos DB" style="width: 80%">
</div>

---

<div align="center" style="background-color: #242A3A ;border-radius: 10px;border: 2px solid white">

```mermaid
---
config:
  look: handDrawn
  theme: dark
title: "Azure SQL Hyperscale: Component Breakdown"
---
flowchart LR
    subgraph Primary Region
        A[App] --> P1[Primary Replica]
        P1 -->|Logs| L[Log Service]
        L -->|Apply Logs| PS1[Page Server 1]
        L -->|Apply Logs| PS2[Page Server 2]
        P1 -->|Async| SR1[HA Replica]
        SR1 -->|Async| NR1[Named Replica 1]
    end

    subgraph Secondary Region
        GR1[Geo Replica]
        L -->|Replicated Logs| GR1
    end
```

</div>

### üß© Architecture Highlights

- **Fully distributed system** ‚Äî separates compute, log, and data.
- Each component (compute, log, page server) scales independently.
- Supports **multiple read-only replicas** (Named or Geo replicas).
- Storage backed by **page servers** holding database pages + snapshots.

### üß† Key Components

| Component                | Role                                        |
| ------------------------ | ------------------------------------------- |
| **Primary replica**      | Handles all writes and read/writes          |
| **HA secondary replica** | Hot standby for quick failover              |
| **Named replicas**       | Read-only replicas for scale-out            |
| **Page servers**         | Store 128MB data pages with local SSD cache |
| **Log service**          | Coordinates log commits and propagation     |

### üîÑ Failover Behavior

- HA replica promoted **instantly** if primary fails.
- Page servers already synced via log service.
- Read replicas continue serving queries with minimal disruption.

### ‚ö° Pros

- Horizontal scale to **100+ TB databases**
- Multiple read-only replicas
- Fast restore & backups using snapshots
- Ideal for **large analytical or hybrid workloads**

### ‚ö†Ô∏è Cons

- Slight write latency (due to distributed log coordination)
- Higher cost

---

## üß† Summary Table

| Model          | Tier              | Data Location          | Replication             | Read Replicas | Failover Type       | Use Case                      |
| -------------- | ----------------- | ---------------------- | ----------------------- | ------------- | ------------------- | ----------------------------- |
| Remote Storage | General Purpose   | Remote (Azure Storage) | None (single data copy) | ‚ùå            | Attach to same data | Cost-effective workloads      |
| Local Storage  | Business Critical | Local SSD              | Synchronous AlwaysOn    | ‚úÖ 1‚Äì3        | Instant             | Low-latency, mission-critical |
| Hyperscale     | Hyperscale        | Page Servers           | Asynchronous            | ‚úÖ Multiple   | Near-instant        | Massive DB, read-heavy        |

---

## üß≠ Key Takeaways

- Azure SQL **always has only one write replica** ‚Äî multi-write is **not supported**.
- **Read replicas** are:

  - Synchronous for **Business Critical**
  - Asynchronous for **Hyperscale**

- **Failover** is automatic and zone-redundant in Premium tiers.
- **Remote storage** model prioritizes **durability**, while **local storage** model prioritizes **performance**.
