# üñ•Ô∏è **SQL Server on Azure Virtual Machines (IaaS)**

> üí° _Full control like on-prem, with cloud-scale flexibility._

---

## üß† **Concept Summary**

**SQL Server on Azure Virtual Machines (IaaS)** =

- ‚úÖ A **Virtual Machine** running in Azure +
- ‚úÖ **SQL Server pre-installed** from the **Azure Marketplace**

You control the **OS, SQL settings, backups, performance tuning, and updates** ‚Äî
while Azure manages the **hardware, storage, and networking**.

---

<div align="center" style="background-color: #242A3A ;border-radius: 10px;border: 2px solid white">
  <img src="image/1759914082582.png" alt="Azure Cosmos DB" style="width: 80%">
</div>

### üìä Comparison Snapshot

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Aspect     | On-Prem SQL        | SQL on Azure VM           | Managed Instance | SQL Database |
| ---------- | ------------------ | ------------------------- | ---------------- | ------------ |
| OS Control | ‚úÖ Full            | ‚úÖ Full                   | ‚ùå               | ‚ùå           |
| Patching   | Manual             | You / Auto via IaaS Agent | Azure            | Azure        |
| Backup     | Manual             | You / Auto via IaaS Agent | Azure            | Azure        |
| HA/DR      | Manual             | You configure             | Built-in         | Built-in     |
| Cost Model | Hardware + License | Pay-as-you-go or BYOL     | PaaS pricing     | PaaS pricing |

</div>

---

## üß± **When to Choose SQL on Azure VM**

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Scenario                              | Why It Fits                                         |
| ------------------------------------- | --------------------------------------------------- |
| üß© **Lift-and-shift migration**       | You want same SQL environment in the cloud          |
| ‚öôÔ∏è **Full SQL feature control**       | You use Agent jobs, SSIS, SSRS, linked servers      |
| üß∞ **Custom SQL or OS configuration** | You manage OS, SQL version, and tuning              |
| üîÑ **Hybrid integration**             | You need VPN, AD domain join, or complex networking |
| üíæ **Large data workloads**           | You control disk layout, caching, and storage tiers |

</div>

---

## ‚öôÔ∏è **Step-by-Step**: Create SQL Server on Azure VM (Portal)

> üéØ _We‚Äôll deploy a VM with SQL Server preinstalled from the Marketplace._

---

### 1Ô∏è‚É£ Step ‚Äî Go to Azure Marketplace

- In **Azure Portal**, select **Create a Resource ‚Üí Compute ‚Üí See all**
- Search for:

  ```ini
  SQL Server 2022 on Windows Server 2022
  ```

  or choose your preferred edition/version:

  - SQL Server 2019 / 2022
  - Standard / Enterprise / Web
  - Windows / Linux

üí° _These images come with the SQL IaaS Agent Extension by default._

---

### 2Ô∏è‚É£ Step ‚Äî Basics Tab

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Setting                  | Description                                                            |
| ------------------------ | ---------------------------------------------------------------------- |
| **Subscription**         | Choose your Azure subscription                                         |
| **Resource Group**       | Existing or create new                                                 |
| **VM Name**              | e.g., `sql-prod-vm01`                                                  |
| **Region**               | Same as your other app resources                                       |
| **Availability Options** | Zone or Availability Set                                               |
| **Image**                | Choose SQL Server edition                                              |
| **VM Size**              | Choose CPU/RAM (e.g., D4s_v5 for mid workloads)                        |
| **Authentication Type**  | Password (Windows) or SSH (Linux)                                      |
| **Admin Credentials**    | Username & password                                                    |
| **Licensing**            | Pay-as-you-go or Azure Hybrid Benefit (if you already own SQL license) |

</div>

---

### 3Ô∏è‚É£ Step ‚Äî Disks

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Setting          | Description                                       |
| ---------------- | ------------------------------------------------- |
| **OS Disk**      | Premium SSD recommended                           |
| **Data Disks**   | Add for data/log/tempdb separation                |
| **Host Caching** | ReadOnly for data; None for logs                  |
| **Storage Type** | Premium SSD or Ultra Disk for I/O-heavy workloads |

</div>

üí° Best Practice:

- Use **separate disks** for:

  - `C:` ‚Üí OS
  - `F:` ‚Üí Data (`.mdf`)
  - `G:` ‚Üí Logs (`.ldf`)
  - `H:` ‚Üí TempDB

---

### 4Ô∏è‚É£ Step ‚Äî Networking

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Setting                | Description                                          |
| ---------------------- | ---------------------------------------------------- |
| **VNet/Subnet**        | Choose or create a new one                           |
| **Public IP**          | Optional (use Bastion for secure access)             |
| **NSG (Firewall)**     | Allow inbound port `1433` for SQL access if required |
| **NIC Security Group** | Restrict RDP (3389) to trusted IPs                   |

</div>

üí° _Use private IPs for internal access or Azure Bastion for secure RDP._

---

### 5Ô∏è‚É£ Step ‚Äî SQL Server Settings (‚ú® Special Section)

This section appears **only** for SQL images.

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Setting                         | Description                              |
| ------------------------------- | ---------------------------------------- |
| **SQL Connectivity**            | Local / Private / Public                 |
| **SQL Port**                    | Default 1433                             |
| **Authentication**              | SQL + Windows / Azure AD                 |
| **Azure Key Vault Integration** | For TDE key management                   |
| **Automatic Patching**          | Enable to auto-patch OS + SQL            |
| **Automated Backup**            | Enable to store backups to Azure Blob    |
| **Backup Retention**            | 1‚Äì30 days                                |
| **Monitoring**                  | Enable telemetry to Log Analytics        |
| **SQL IaaS Agent Extension**    | Auto-installed for management automation |

</div>

---

### 6Ô∏è‚É£ Step ‚Äî Management & Monitoring

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Feature           | Description                                    |
| ----------------- | ---------------------------------------------- |
| **Identity**      | Enable system-assigned managed identity        |
| **Diagnostics**   | Boot diagnostics and guest metrics             |
| **Auto-Shutdown** | Enable to save cost                            |
| **Tags**          | Apply consistent naming for billing visibility |

</div>

---

### 7Ô∏è‚É£ Step ‚Äî Review + Create

- Validate ‚Üí **Create**
- Deployment takes ~10 minutes ‚è≥
- VM is ready with SQL Server installed

---

<div align="center" style="background-color: #ffffffff ;border-radius: 10px;border: 2px solid white">
  <img src="image/1759920065764.png" alt="Azure Cosmos DB" style="border-radius: 10px; border: 2px solid white; width: 80%">
</div>

---

<div align="center" style="background-color: #ffffffff ;border-radius: 10px;border: 2px solid white">
  <img src="image/1759919976535.png" alt="Azure Cosmos DB" style="border-radius: 10px; border: 2px solid white; width: 80%">
</div>

---

<div align="center" style="background-color: #ffffffff ;border-radius: 10px;border: 2px solid white">
  <img src="image/1759920001361.png" alt="Azure Cosmos DB" style="border-radius: 10px; border: 2px solid white; width: 80%">
</div>

---

## üß™ **Post-Deployment Configuration**

### 1. Connect to VM

- Use **Azure Bastion** or **RDP**
- Login with admin credentials

### 2. Verify SQL

- Open **SQL Server Management Studio (SSMS)**
- Confirm connection to `localhost`
- Check SQL services (SQL Server, SQL Agent)

### 3. Configure Firewall

- Allow inbound traffic on **port 1433** (Windows Firewall + NSG)
- Or use private endpoint only

### 4. Install / Verify SQL IaaS Agent Extension

- Go to:
  `VM ‚Üí Extensions + Applications ‚Üí SQLIaaSExtension`
- If missing, add manually (Marketplace ‚Üí SQL IaaS Agent Extension)

---

## üéÅ **What Is the SQL IaaS Agent Extension?**

It‚Äôs a built-in agent that lets **Azure manage your SQL Server VM** more intelligently ‚Äî without taking control away from you.

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Feature                       | Description                                     |
| ----------------------------- | ----------------------------------------------- |
| üß© **Automated Backup**       | Schedule and store in Blob storage              |
| ‚öôÔ∏è **Patching Automation**    | Windows + SQL updates                           |
| üí∞ **License Management**     | Toggle between PAYG and AHB                     |
| üìà **Monitoring Integration** | Send SQL telemetry to Log Analytics             |
| üßÆ **Portal Management**      | View SQL configuration directly in Azure Portal |

</div>

---

## üìò **Architecture Diagram**

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

```mermaid
flowchart LR
    A["üßç‚Äç‚ôÇÔ∏è User / Admin"] -->|RDP / SSMS| B["üíª Azure VM<br>with SQL Server"]
    B --> C["üîß SQL IaaS Agent Extension"]
    C --> D["‚òÅÔ∏è Azure Backup / Log Analytics / Key Vault"]
    B --> E["üíæ Azure Disks<br>(Data + Logs + TempDB)"]
```

</div>

---

## üí° **Best Practices**

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Area           | Recommendation                                                        |
| -------------- | --------------------------------------------------------------------- |
| **Disks**      | Separate OS, Data, Log, TempDB disks                                  |
| **Backup**     | Use IaaS Agent with Blob Storage                                      |
| **Security**   | Use private IP + Azure Bastion (avoid public RDP)                     |
| **Patching**   | Enable automatic patching                                             |
| **HA/DR**      | Use Always On Availability Groups (AGs) or Failover Cluster Instances |
| **Monitoring** | Integrate with Azure Monitor or Log Analytics                         |

</div>

---

## üí¨ **Comparison to On-Prem SQL**

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Category       | On-Prem          | Azure SQL VM                     |
| -------------- | ---------------- | -------------------------------- |
| Infrastructure | You buy hardware | Azure provides                   |
| Maintenance    | Manual           | Partially automated              |
| Backup         | Local / tape     | Azure Blob Storage               |
| Cost           | CapEx (hardware) | OpEx (pay-as-you-go)             |
| HA             | Manual setup     | Built-in Azure zones, AG support |

</div>

---

## üìö **Summary**

<div align="center" style="background-color: #1b3f47ff; border-radius: 10px;">

| Concept                | Description                                          |
| ---------------------- | ---------------------------------------------------- |
| **What It Is**         | SQL Server running inside an Azure VM                |
| **Management Level**   | Full control (IaaS)                                  |
| **Key Differentiator** | SQL IaaS Agent for Azure integration                 |
| **Best For**           | Legacy apps, lift-and-shift workloads, full control  |
| **Next Step**          | Configure automatic backup, patching, and monitoring |

</div>
