# 🎯 Cosmos DB – Exam Tips & Case Studies (AZ-204)

This is the **practical battle guide**: the exact type of tricky scenarios Microsoft puts in the AZ-204 exam, and how to answer them fast.

---

## 🧩 Partition Key Choice

### **Scenario:** App queries often on `country` field. Should you choose `/country` as partition key?

✔️ **No** → low cardinality (only a few countries) → hot partitions.  
✔️ **Better** → `/userId` or `/orderId` (high cardinality, evenly distributed).

---

## ⚡ RU/s and Scaling

### **Scenario:** App has unpredictable spikes in traffic. You want to minimize cost but avoid throttling.

✔️ **Answer:** Use **Autoscale Throughput**.  
❌ Wrong answers: Provisioned (wastes RU), Serverless (good for low traffic, not spikes).

### **Scenario:** Container is throttling even though RU is high.

✔️ **Answer:** Bad partition key caused a **hot partition**. Choose a new partition key.

---

## ⚖️ Consistency Levels

### **Scenario:** Banking system → always latest data across regions.

✔️ **Answer:** **Strong Consistency**.

### **Scenario:** Social media app → user must see their own posts instantly, others may lag.

✔️ **Answer:** **Session Consistency**.

### **Scenario:** Leaderboard → data can lag but must not be older than 5 seconds.

✔️ **Answer:** **Bounded Staleness**.

### **Scenario:** Log processing → order of events must be preserved, freshness doesn’t matter.

✔️ **Answer:** **Consistent Prefix**.

### **Scenario:** Product recommendations → eventual convergence is fine.

✔️ **Answer:** **Eventual Consistency**.

---

## 🔐 Security

### **Scenario:** Azure Function needs to access Cosmos DB without storing secrets.

✔️ **Answer:** Use **Managed Identity + RBAC**.

### **Scenario:** Cosmos DB must be private (no public internet).

✔️ **Answer:** Use **Private Endpoint (Private Link)**.

### **Scenario:** Client app should only have read access to one container.

✔️ **Answer:** Use **Resource Tokens**.

---

## 🌍 Global Distribution & Failover

### **Scenario:** App must run in multiple regions with 99.999% availability.

✔️ **Answer:** **Multi-region writes + automatic failover**.

### **Scenario:** App in East US must continue working if West US fails.

✔️ **Answer:** Configure **failover priorities**.

---

## 🔎 Indexing & Querying

### **Scenario:** RU cost is too high because large text fields are indexed unnecessarily.

✔️ **Answer:** Exclude those fields in **indexing policy**.

### **Scenario:** Query often sorts by `category` and `price`.

✔️ **Answer:** Create **composite index** on (`category`, `price`).

### **Scenario:** App needs fast reads by `id` and `category`.

✔️ **Answer:** Use **point reads with partition key**.

---

## 📊 Monitoring & Reliability

### **Scenario:** Detect RU throttling and alert ops team.

✔️ **Answer:** Configure **Azure Monitor metric alerts** on `429 errors`.

### **Scenario:** App requires backup recovery to a point in time.

✔️ **Answer:** Use **Continuous Backup + PITR (Point-in-Time Restore)**.

---

## 🛠️ Developer Integrations

### **Scenario:** Process new orders automatically when inserted in Cosmos DB.

✔️ **Answer:** **Cosmos DB Trigger in Azure Functions** (requires lease collection).

### **Scenario:** Deploy Cosmos DB using code with default Session consistency.

✔️ **Answer:** Use **ARM/Bicep/Terraform** templates.

---

## 📚 Final Exam Strategy

👉 Remember the **Cosmos DB Exam Cheat Words**:

- **Partition Key** = scalability unit.
- **RU/s** = performance currency.
- **Autoscale** = unpredictable spikes.
- **Serverless** = dev/test, small workloads.
- **Session Consistency** = user sees own writes (default).
- **Strong Consistency** = banking, global correctness.
- **Private Endpoint** = block public internet.
- **Managed Identity** = best practice for apps.
- **Change Feed** = Functions trigger (with lease collection).
- **99.999% SLA** = multi-region + multi-write + auto failover.
