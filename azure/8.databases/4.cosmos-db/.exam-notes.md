# ğŸ¯ Cosmos DB â€“ Exam Tips & Case Studies (AZ-204)

This is the **practical battle guide**: the exact type of tricky scenarios Microsoft puts in the AZ-204 exam, and how to answer them fast.

---

## ğŸ§© Partition Key Choice

### **Scenario:** App queries often on `country` field. Should you choose `/country` as partition key?

âœ”ï¸ **No** â†’ low cardinality (only a few countries) â†’ hot partitions.  
âœ”ï¸ **Better** â†’ `/userId` or `/orderId` (high cardinality, evenly distributed).

---

## âš¡ RU/s and Scaling

### **Scenario:** App has unpredictable spikes in traffic. You want to minimize cost but avoid throttling.

âœ”ï¸ **Answer:** Use **Autoscale Throughput**.  
âŒ Wrong answers: Provisioned (wastes RU), Serverless (good for low traffic, not spikes).

### **Scenario:** Container is throttling even though RU is high.

âœ”ï¸ **Answer:** Bad partition key caused a **hot partition**. Choose a new partition key.

---

## âš–ï¸ Consistency Levels

### **Scenario:** Banking system â†’ always latest data across regions.

âœ”ï¸ **Answer:** **Strong Consistency**.

### **Scenario:** Social media app â†’ user must see their own posts instantly, others may lag.

âœ”ï¸ **Answer:** **Session Consistency**.

### **Scenario:** Leaderboard â†’ data can lag but must not be older than 5 seconds.

âœ”ï¸ **Answer:** **Bounded Staleness**.

### **Scenario:** Log processing â†’ order of events must be preserved, freshness doesnâ€™t matter.

âœ”ï¸ **Answer:** **Consistent Prefix**.

### **Scenario:** Product recommendations â†’ eventual convergence is fine.

âœ”ï¸ **Answer:** **Eventual Consistency**.

---

## ğŸ” Security

### **Scenario:** Azure Function needs to access Cosmos DB without storing secrets.

âœ”ï¸ **Answer:** Use **Managed Identity + RBAC**.

### **Scenario:** Cosmos DB must be private (no public internet).

âœ”ï¸ **Answer:** Use **Private Endpoint (Private Link)**.

### **Scenario:** Client app should only have read access to one container.

âœ”ï¸ **Answer:** Use **Resource Tokens**.

---

## ğŸŒ Global Distribution & Failover

### **Scenario:** App must run in multiple regions with 99.999% availability.

âœ”ï¸ **Answer:** **Multi-region writes + automatic failover**.

### **Scenario:** App in East US must continue working if West US fails.

âœ”ï¸ **Answer:** Configure **failover priorities**.

---

## ğŸ” Indexing & Querying

### **Scenario:** RU cost is too high because large text fields are indexed unnecessarily.

âœ”ï¸ **Answer:** Exclude those fields in **indexing policy**.

### **Scenario:** Query often sorts by `category` and `price`.

âœ”ï¸ **Answer:** Create **composite index** on (`category`, `price`).

### **Scenario:** App needs fast reads by `id` and `category`.

âœ”ï¸ **Answer:** Use **point reads with partition key**.

---

## ğŸ“Š Monitoring & Reliability

### **Scenario:** Detect RU throttling and alert ops team.

âœ”ï¸ **Answer:** Configure **Azure Monitor metric alerts** on `429 errors`.

### **Scenario:** App requires backup recovery to a point in time.

âœ”ï¸ **Answer:** Use **Continuous Backup + PITR (Point-in-Time Restore)**.

---

## ğŸ› ï¸ Developer Integrations

### **Scenario:** Process new orders automatically when inserted in Cosmos DB.

âœ”ï¸ **Answer:** **Cosmos DB Trigger in Azure Functions** (requires lease collection).

### **Scenario:** Deploy Cosmos DB using code with default Session consistency.

âœ”ï¸ **Answer:** Use **ARM/Bicep/Terraform** templates.

---

## ğŸ“š Final Exam Strategy

ğŸ‘‰ Remember the **Cosmos DB Exam Cheat Words**:

- **Partition Key** = scalability unit.
- **RU/s** = performance currency.
- **Autoscale** = unpredictable spikes.
- **Serverless** = dev/test, small workloads.
- **Session Consistency** = user sees own writes (default).
- **Strong Consistency** = banking, global correctness.
- **Private Endpoint** = block public internet.
- **Managed Identity** = best practice for apps.
- **Change Feed** = Functions trigger (with lease collection).
- **99.999% SLA** = multi-region + multi-write + auto failover.
