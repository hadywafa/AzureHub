# üë©‚Äçüíª Cosmos DB ‚Äì Developer Integrations

## 1Ô∏è‚É£ SDKs

Cosmos DB has official SDKs in multiple languages:

- **.NET / C#** (most common in AZ-204)
- **Java**
- **Python**
- **Node.js**
- **Go**

SDKs wrap authentication, partition routing, query execution, and retries.

### Example: .NET SDK ‚Äì Insert Item

```csharp
using Microsoft.Azure.Cosmos;

CosmosClient client = new CosmosClient("<endpoint>", "<key>");
Database db = await client.CreateDatabaseIfNotExistsAsync("store");
Container container = await db.CreateContainerIfNotExistsAsync("products", "/category");

var item = new { id = "p1", name = "Laptop", category = "Electronics", price = 1200 };
await container.CreateItemAsync(item, new PartitionKey("Electronics"));
```

üëâ Exam Tip: Always pass **partition key** when possible for efficiency.

---

## 2Ô∏è‚É£ REST API

Cosmos DB also exposes a **native REST API** (HTTP-based).

- Useful for custom integrations or when SDK isn‚Äôt available.
- Requires HMAC authentication (using account keys).

### Example: REST Query Request

```http
POST https://mycosmos.documents.azure.com/dbs/mydb/colls/products/docs
Authorization: <auth-token>
x-ms-version: 2018-12-31
Content-Type: application/json

{ "id": "p2", "name": "Phone", "category": "Electronics" }
```

üëâ SDKs handle signing automatically, so use REST API only if SDK isn‚Äôt supported.

---

## 3Ô∏è‚É£ Azure Functions Integration ‚ö°

Cosmos DB integrates natively with **Azure Functions**:

- **Input Binding** ‚Üí Read documents.
- **Output Binding** ‚Üí Write documents.
- **Trigger** ‚Üí Run a function when new items are added.

### Example: Function Trigger (C#)

```csharp
[FunctionName("ProcessOrders")]
public static void Run(
    [CosmosDBTrigger(
        databaseName: "store",
        collectionName: "orders",
        ConnectionStringSetting = "CosmosDBConnection",
        LeaseCollectionName = "leases")] IReadOnlyList<Document> input,
    ILogger log)
{
    foreach (var doc in input)
    {
        log.LogInformation($"Order processed: {doc.Id}");
    }
}
```

üëâ Exam Trap: **Lease collection** is required to track change feed progress.

---

## 4Ô∏è‚É£ App Service Integration

- Use **Managed Identity** to authenticate App Service ‚Üí Cosmos DB.
- No secrets stored in code.
- Ideal for **web APIs or portals** using Cosmos as backend.

Example:

```csharp
DefaultAzureCredential cred = new DefaultAzureCredential();
CosmosClient client = new CosmosClient("https://mycosmos.documents.azure.com/", cred);
```

---

## 5Ô∏è‚É£ Logic Apps & Power Platform

- Logic Apps has **Cosmos DB connector**.
- Supports CRUD operations + triggers.
- Great for **no-code workflows**.

üëâ Example: When new doc in Cosmos DB ‚Üí Send Teams notification.

---

## 6Ô∏è‚É£ Infrastructure as Code (IaC)

You can deploy Cosmos DB using **ARM, Bicep, Terraform**.

### a. ARM Template

```json
{
  "type": "Microsoft.DocumentDB/databaseAccounts",
  "name": "mycosmos",
  "apiVersion": "2021-04-15",
  "location": "East US",
  "properties": {
    "databaseAccountOfferType": "Standard",
    "consistencyPolicy": { "defaultConsistencyLevel": "Session" }
  }
}
```

### b. Bicep

```bicep
resource cosmos 'Microsoft.DocumentDB/databaseAccounts@2021-04-15' = {
  name: 'mycosmos'
  location: 'East US'
  properties: {
    databaseAccountOfferType: 'Standard'
    consistencyPolicy: {
      defaultConsistencyLevel: 'Session'
    }
  }
}
```

### c. Terraform

```hcl
resource "azurerm_cosmosdb_account" "example" {
  name                = "mycosmos"
  location            = "East US"
  resource_group_name = azurerm_resource_group.example.name
  offer_type          = "Standard"

  consistency_policy {
    consistency_level = "Session"
  }
}
```

üëâ Exam Tip: Cosmos DB resources can be provisioned at **account**, **database**, or **container** level.

---

## üÜö AWS Comparison

| Feature                 | Cosmos DB                     | DynamoDB                  |
| ----------------------- | ----------------------------- | ------------------------- |
| SDKs                    | .NET, Java, Python, Node, Go  | Similar SDKs              |
| REST API                | Yes                           | Yes                       |
| Triggers                | Azure Functions (Change Feed) | DynamoDB Streams + Lambda |
| IaC                     | ARM, Bicep, Terraform         | CloudFormation, Terraform |
| App Service Integration | Managed Identity              | IAM Roles                 |

üëâ Cosmos DB‚Äôs **Functions trigger + Managed Identity** is more developer-friendly than DynamoDB‚Äôs Streams setup.

---

## üéØ Exam Gotchas

- **Change Feed** triggers require a **lease collection**.
- **Managed Identity** = best practice for app authentication.
- **Session consistency** is default (unless overridden in IaC or SDK).
- **Bicep/Terraform** can define accounts, DBs, and containers.
- **Cosmos DB connector in Logic Apps** supports triggers & actions.

üëâ Example Exam Question:
_‚ÄúYou need to automatically process new orders when inserted into Cosmos DB. What should you use?‚Äù_
‚úîÔ∏è **Cosmos DB Trigger in Azure Functions with Lease Collection**.
