# ğŸ’¾ **Azure Managed Disk Snapshots (2025 Updated)**

Snapshots in Azure are **point-in-time backups** of managed disks.
Theyâ€™re **stored in Azure Storage**, are **incremental by default**, and can be used to **restore, clone, or migrate** VMs or disks.

---

## ğŸ“– **What Is a Snapshot?**

A **snapshot** is a **read-only image** of a managed disk at a specific moment.
You can take a snapshot of:

- OS disk
- Data disk

â€¦and use it later to:

- **Create a new managed disk**
- **Restore a VM**
- **Replicate to another region**
- **Export to Blob storage** for long-term backup

---

## ğŸª **Where Are Azure Snapshots Stored?**

> **Azure Managed Disk Snapshots** are stored in **Microsoft-managed Azure Storage**,You manage them as Azure resources, not as blobs â€” unless you explicitly export them.

---

### ğŸ”¹ What this means:

- When you create a snapshot using `az disk snapshot create` or via the portal, Azure stores it in **its own internal storage**, optimized for incremental tracking and performance.
- You **donâ€™t see it** in your blob containers â€” itâ€™s a **resource** in your subscription, not a blob.
- You can **export** a snapshot to a VHD in your blob container if needed (e.g., for backup, migration, or cross-cloud use).

---

### ğŸ”¹ Security & Access

- Snapshots are **isolated per subscription/resource group**.
- You control access via **RBAC** and **Azure Disk Snapshot permissions**.
- You can copy snapshots across regions or convert them to **read-only VHDs** in blob storage.

---

## ğŸ§© **Snapshot Types in Azure**

Azure technically supports **only one type of snapshot (incremental)**,
but functionally, there are two categories:

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

| Snapshot Type          | How It Works                                           | Description                                                      |
| ---------------------- | ------------------------------------------------------ | ---------------------------------------------------------------- |
| ğŸ§± **Full (Baseline)** | Captures _all blocks_ from the source disk             | The **first** snapshot of a disk is automatically a **full** one |
| ğŸ” **Incremental**     | Captures _only changed blocks_ since the last snapshot | Every subsequent snapshot is incremental, saving cost and time   |

</div>

ğŸ’¡ Azure **does not expose** a â€œfull snapshotâ€ option â€” but the **first** one is full by nature.

---

## âš™ï¸ Snapshot Storage and Retention

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

| Property                   | Details                                                                                             |
| -------------------------- | --------------------------------------------------------------------------------------------------- |
| ğŸ“¦ **Storage Type**        | Stored as **managed resources** in Azure Storage (not inside the VM)                                |
| ğŸ’° **Billing**             | You pay only for the **unique blocks** (incremental savings)                                        |
| ğŸ§¹ **Retention Policy**    | **No automatic deletion** â€“ you manage lifecycle manually (can automate via Azure Backup or Policy) |
| â™»ï¸ **Dependency Handling** | When older snapshots are deleted, Azure merges blocks automatically so newer ones remain valid      |

</div>

---

## ğŸ” Snapshot Encryption Options

Snapshots **inherit** encryption settings from their source disk, but you can **override or re-encrypt**:

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

| Encryption Type                    | Description                                                 | Key Source     |
| ---------------------------------- | ----------------------------------------------------------- | -------------- |
| ğŸŸ¦ **Platform-managed keys (PMK)** | Default; Microsoft manages encryption keys                  | Azure-managed  |
| ğŸŸ© **Customer-managed keys (CMK)** | You manage keys in **Azure Key Vault**                      | Your Key Vault |
| ğŸŸ¨ **Encryption at Host**          | If VM enabled it, temp + cache + disk I/O already encrypted | Host-level     |

</div>

ğŸ”§ Example:

```bash
az snapshot create \
  --name finance-snap \
  --resource-group RG1 \
  --source myManagedDisk \
  --encryption-type EncryptionAtRestWithCustomerKey \
  --encryption-set finance-encrypt-scope
```

---

## ğŸ§­ Snapshot Workflow (Step-by-Step)

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

```mermaid
---
config:
  look: handDrawn
  theme: dark
title: "Azure Disk Snapshot Workflow"
---
sequenceDiagram
    participant VM as ğŸ–¥ï¸ Azure VM
    participant Disk as ğŸ’½ Managed Disk
    participant Snapshot as ğŸ“¸ Snapshot
    participant Storage as â˜ï¸ Azure Storage

    VM->>Disk: Data written (OS/Data)
    Note over Disk: Disk in consistent state
    User->>Disk: Create Snapshot
    Disk->>Snapshot: Copy current block state
    Snapshot->>Storage: Save blocks (full or incremental)
    User->>Snapshot: Use snapshot to restore/create new disk
```

</div>

---

## ğŸŒ Cross-Region & Full Snapshot Scenarios

If you need a **completely independent full backup** (for DR or migration):

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

| Method                              | Description                                   | Result                                       |
| ----------------------------------- | --------------------------------------------- | -------------------------------------------- |
| ğŸ” **Copy Snapshot**                | `az snapshot create --source <snapshot>`      | Produces a **full**, self-contained snapshot |
| ğŸŒ **Cross-Region Copy**            | Copy snapshot to another region               | Full copy is made automatically              |
| ğŸ’¾ **Export to Blob (VHD)**         | Use `grant-access` to export                  | Independent full VHD backup                  |
| âš™ï¸ **Create Disk â†’ Snapshot Again** | Make disk from old snapshot, then re-snapshot | New baseline (full)                          |

</div>

ğŸ’¡ **Rule:**

> Every copied or exported snapshot is treated as a **full snapshot** (no delta references).

---

## ğŸ§¾ Cost and Performance Behavior

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

| Property             | Incremental         | Full Copy                   |
| -------------------- | ------------------- | --------------------------- |
| ğŸ§± Data Stored       | Changed blocks only | All blocks                  |
| ğŸ’° Cost              | Lower               | Higher                      |
| â±ï¸ Speed             | Faster              | Slower                      |
| ğŸ”— Dependency        | Yes                 | No                          |
| ğŸ“ Cross-Region Copy | Requires full       | Native full                 |
| ğŸ§© Use Case          | Regular backups     | Migration, DR, cold archive |

</div>

---

## ğŸ§° CLI & PowerShell Examples

### ğŸŸ¦ Create a Snapshot

```bash
az snapshot create \
  --name mySnap1 \
  --resource-group RG1 \
  --source myDisk \
  --incremental true
```

### ğŸŸ© Create Full Copy Snapshot

```bash
az snapshot create \
  --name myFullSnap \
  --resource-group RG1 \
  --source existingSnapshot
```

### ğŸŸ¨ Export Snapshot to Blob (Full VHD)

```bash
az snapshot grant-access \
  --name mySnap1 \
  --resource-group RG1 \
  --duration-in-seconds 3600
```

---

## ğŸ§© Snapshot Lifecycle Example

```mermaid
---
config:
  look: handDrawn
  theme: dark
title: "Incremental Snapshot Lifecycle"
---

flowchart LR
    D["ğŸ’½ Managed Disk"]
    S1["ğŸ“¸ Snapshot 1 (Full)"]
    S2["ğŸ“¸ Snapshot 2 (Incremental)"]
    S3["ğŸ“¸ Snapshot 3 (Incremental)"]
    F["ğŸ“¸ Full Copy Snapshot"]
    A["Cross-Region / Archive"]

    D --> S1 --> S2 --> S3
    S3 -. "Copy" .-> F
    F -. "Independent" .-> A
    A --> D
```

---

## ğŸ’¡ Key Takeaways

| Concept                     | Quick Summary                                                          |
| --------------------------- | ---------------------------------------------------------------------- |
| ğŸ§± **First Snapshot**       | Always full                                                            |
| ğŸ” **Subsequent Snapshots** | Incremental, store only changes                                        |
| ğŸ§© **Copy/Export**          | Produces full independent backup                                       |
| ğŸ” **Encryption**           | Inherited from source, or via encryption scope                         |
| ğŸŒ **Cross-Region Copy**    | Automatically becomes full                                             |
| ğŸ•’ **Retention**            | Manual â€” no default expiry                                             |
| ğŸ’° **Cost**                 | Pay for stored blocks only                                             |
| âš™ï¸ **Automation**           | Can be integrated with **Azure Backup**, **Policy**, or **Logic Apps** |

---

## ğŸ§­ AWS vs Azure Comparison

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

| Feature              | **AWS EBS Snapshot**            | **Azure Managed Disk Snapshot** |
| -------------------- | ------------------------------- | ------------------------------- |
| Default Type         | Incremental                     | Incremental                     |
| Full Snapshot Option | Yes (on demand)                 | Implicit (first or copy)        |
| Storage              | S3 (Managed)                    | Azure Storage                   |
| Retention            | Manual or via Lifecycle Manager | Manual or via Policy            |
| Cross-Region Copy    | Full snapshot                   | Full snapshot                   |
| Export               | As AMI or to S3                 | As VHD (Blob)                   |
| Encryption           | KMS (CMK/MMK)                   | Key Vault (CMK/MMK)             |
| Incremental Chain    | Yes                             | Yes                             |
| Restore              | Create new volume               | Create new disk                 |

</div>

---

## âœ… Summary Table

<div align="center" style="background-color: #1E1E1E; border-radius: 10px;">

| Category                 | Snapshot Behavior           |
| ------------------------ | --------------------------- |
| ğŸ“¸ Default Snapshot Type | Incremental                 |
| ğŸ§± First Snapshot        | Full baseline               |
| ğŸ§© Copy Snapshot         | Full                        |
| ğŸŒ Cross-region Copy     | Full                        |
| ğŸ” Encryption            | Inherited or via scope      |
| ğŸ•’ Retention             | Manual                      |
| ğŸ’¾ Export                | As VHD to Blob              |
| âš™ï¸ Creation Time         | Few seconds for incremental |
| ğŸ’° Billing               | Based on actual data stored |

</div>

---

## ğŸ§© Mnemonic Trick (to Remember Easily)

> ğŸ”¹ **â€œAzure Snapshots are smart â€” first full, rest small.â€**

- âœ… First = Full
- ğŸ” Next = Incremental
- ğŸŒ Copy = Full
- ğŸ” Inherit Encryption
- ğŸ•’ Retention = You manage it
