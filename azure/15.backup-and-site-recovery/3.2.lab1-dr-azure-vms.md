# ğŸ§ª Lab 1 â€“ Disaster Recovery for Azure VM (Region-to-Region DR)

This is the **most common** use case for ASR: replicating an **Azure VM** from one region (e.g., _East US_) to another (e.g., _Central US_).

---

## âš™ï¸ Step 1 â€“ Create Recovery Services Vault

**Portal:**

1. Go to [Azure Portal](https://portal.azure.com).
2. Search **Recovery Services vaults** â†’ _Create_.
3. Fill in:

   - **Name**: `MyRecoveryVault`
   - **Resource Group**: `MyRG`
   - **Region**: _East US_ (must be same as VMâ€™s region).

4. Click **Review + Create â†’ Create**.

**Azure CLI:**

```bash
az group create --name MyRG --location eastus

az backup vault create \
  --resource-group MyRG \
  --name MyRecoveryVault \
  --location eastus
```

**PowerShell:**

```powershell
New-AzRecoveryServicesVault `
   -Name "MyRecoveryVault" `
   -ResourceGroupName "MyRG" `
   -Location "EastUS"
```

---

## âš™ï¸ Step 2 â€“ Enable Replication for VM

**Portal:**

1. Go to your vault â†’ **Site Recovery** â†’ _Replicate_.
2. Source: **Azure**.
3. Target: Select _Central US_.
4. Choose the VM(s) to protect (example: `MyAppVM`).
5. Configure **Target Resource Group**, **Target VNet/Subnet**, **Storage Account** for replicated disks.
6. Define **Replication Policy** (default = RPO 15 min).

**Azure CLI:**

```bash
az site-recovery protection-container-mapping create \
  --resource-group MyRG \
  --vault-name MyRecoveryVault \
  --fabric-name Azure \
  --protection-container MyProtectionContainer \
  --policy-name DefaultPolicy \
  --name MyProtectionMapping
```

---

## âš™ï¸ Step 3 â€“ Test Failover

**Portal:**

1. Vault â†’ **Replicated Items** â†’ Select VM â†’ _Test Failover_.
2. Choose Recovery Point (Latest processed / Latest app-consistent).
3. Pick a test network (donâ€™t use production VNet).
4. VM will spin up in Central US.
5. Verify it boots, check app functionality.

ğŸ‘‰ No downtime in production.

---

## âš™ï¸ Step 4 â€“ Planned Failover (Real Disaster)

1. Vault â†’ **Replicated Items â†’ Failover**.
2. Choose recovery point.
3. VM starts in _Central US_.
4. Update DNS or Azure Traffic Manager â†’ users routed to DR VM.

---

## âš™ï¸ Step 5 â€“ Failback

Once East US is back:

1. Vault â†’ _Replicated Items_ â†’ _Failback_.
2. Azure syncs data back â†’ workloads run again in East US.

---

### ğŸ” Visual Workflow

```mermaid
flowchart TD
    A[Primary VM - East US] -->|Replication| B[(Recovery Services Vault)]
    B --> C[Replica VM - Central US]
    C -->|Failover| D[App Running in DR Region]
    D -->|Failback| A
```

---

## ğŸ“ Final Summary

- **Lab 1 (Azure VM â†’ Azure Region)**:

  - Create Vault â†’ Enable Replication â†’ Test Failover â†’ Failover â†’ Failback.
  - Ideal for cloud-native workloads.
